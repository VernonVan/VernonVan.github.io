<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
<meta property="og:type" content="website">
<meta property="og:title" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
<meta property="og:description" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
<meta name="twitter:description" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/06/ç¿»è¯‘ç”¨LLDBè°ƒè¯•Swiftä»£ç /">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/06/ç¿»è¯‘ç”¨LLDBè°ƒè¯•Swiftä»£ç /" itemprop="url">
                  (ç¿»è¯‘)ç”¨ LLDB è°ƒè¯• Swift ä»£ç 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-06T14:41:38+08:00">
                2018-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/06/ç¿»è¯‘ç”¨LLDBè°ƒè¯•Swiftä»£ç /#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/02/06/ç¿»è¯‘ç”¨LLDBè°ƒè¯•Swiftä»£ç /" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/02/06/ç¿»è¯‘ç”¨LLDBè°ƒè¯•Swiftä»£ç /" class="leancloud_visitors" data-flag-title="(ç¿»è¯‘)ç”¨ LLDB è°ƒè¯• Swift ä»£ç ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<ul>
<li>åŸæ–‡åœ°å€ï¼š<a href="https://medium.com/flawless-app-stories/debugging-swift-code-with-lldb-b30c5cf2fd49" target="_blank" rel="external">Debugging Swift code with LLDB</a></li>
<li>åŸæ–‡ä½œè€…ï¼š<a href="https://medium.com/@ahmedsulaiman?source=post_header_lockup" target="_blank" rel="external">Ahmed Sulaiman</a></li>
</ul>
</blockquote>
<h1 id="ç”¨-LLDB-è°ƒè¯•-Swift-ä»£ç "><a href="#ç”¨-LLDB-è°ƒè¯•-Swift-ä»£ç " class="headerlink" title="ç”¨ LLDB è°ƒè¯• Swift ä»£ç "></a>ç”¨ LLDB è°ƒè¯• Swift ä»£ç </h1><p><img src="http://upload-images.jianshu.io/upload_images/698554-035b0df85ea54d32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½œä¸ºå·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬èŠ±äº†å·®ä¸å¤š 70% çš„æ—¶é—´åœ¨è°ƒè¯•ä¸Šï¼Œå‰©ä¸‹çš„ 20% ç”¨æ¥æ€è€ƒæ¶æ„ä»¥åŠå’Œç»„å‘˜æ²Ÿé€šï¼Œä»…ä»…åªæœ‰ 10% çš„æ—¶é—´æ˜¯çœŸçš„åœ¨å†™ä»£ç çš„ã€‚</p>
<blockquote>
<p>è°ƒè¯•å°±åƒæ˜¯åœ¨çŠ¯ç½ªç”µå½±ä¸­åšä¾¦æ¢ä¸€æ ·ï¼ŒåŒæ—¶ä½ ä¹Ÿæ˜¯å‡¶æ‰‹ã€‚</p>
<p>â€” <a href="https://twitter.com/fortes" target="_blank" rel="external">Filipe Fortes</a> æ¥è‡ª Twitter</p>
</blockquote>
<p>æ‰€ä»¥è®©æˆ‘ä»¬åœ¨è¿™70%çš„æ—¶é—´å°½å¯èƒ½æ„‰æ‚¦æ˜¯ç›¸å½“é‡è¦çš„ã€‚LLDB å°±æ˜¯æ¥æ‰“æ•‘æˆ‘ä»¬çš„ã€‚å¥‡å¦™çš„ Xcode Debugger UI å±•ç¤ºäº†æ‰€æœ‰ä½ å¯ç”¨çš„ä¿¡æ¯ï¼Œè€Œä¸ç”¨æ•²å…¥ä»»ä½•ä¸€ä¸ª LLDB å‘½ä»¤ã€‚ç„¶è€Œï¼Œæ§åˆ¶å°åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­åŒæ ·ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ†æä¸€äº›æœ€æœ‰ç”¨çš„ LLDB æŠ€å·§ã€‚æˆ‘è‡ªå·±æ¯å¤©éƒ½åœ¨ç”¨å®ƒä»¬è¿›è¡Œè°ƒè¯•ã€‚</p>
<h3 id="ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿ"><a href="#ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿ" class="headerlink" title="ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿ"></a>ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿ</h3><p>LLDB æ˜¯ä¸€ä¸ªåºå¤§çš„å·¥å…·ï¼Œå†…ç½®äº†å¾ˆå¤šæœ‰ç”¨çš„å‘½ä»¤ã€‚æˆ‘ä¸ä¼šå…¨éƒ¨è®²è§£ï¼Œè€Œæ˜¯å¸¦ä½ æµè§ˆæœ€æœ‰ç”¨çš„å‘½ä»¤ã€‚è¿™æ˜¯æˆ‘ä»¬çš„è®¡åˆ’ï¼š</p>
<ol>
<li>è·å–å˜é‡å€¼ï¼š <code>expression</code>, <code>e</code>, <code>print</code>, <code>po</code>, <code>p</code></li>
<li>è·å–æ•´ä¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€ä»¥åŠç‰¹å®šè¯­è¨€çš„å‘½ä»¤ï¼š<code>bugreport</code>, <code>frame</code>, <code>language</code></li>
<li>æ§åˆ¶åº”ç”¨çš„æ‰§è¡Œæµç¨‹ï¼š<code>process</code>, <code>breakpoint</code>, <code>thread</code>, <code>watchpoint</code></li>
<li>è£èª‰å¥–ï¼š<code>command</code>, <code>platform</code>, <code>gui</code></li>
</ol>
<p>æˆ‘è¿˜å‡†å¤‡å¥½äº†æœ‰ç”¨çš„ LLDB å‘½ä»¤è¯´æ˜å’Œå®ä¾‹çš„è¡¨æ ¼ï¼Œæœ‰éœ€è¦çš„å¯ä»¥æŠŠå®ƒè´´åœ¨ Mac ä¸Šé¢è®°ä½è¿™äº›å‘½ä»¤ ğŸ™‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-4425e8ad483d1e91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é€šè¿‡è¿™æ¡é“¾æ¥ä¸‹è½½å…¨å°ºå¯¸çš„ç‰ˆæœ¬ â€” â€Š<a href="https://www.dropbox.com/s/9sv67e7f2repbpb/lldb-commands-map.png?dl=0" target="_blank" rel="external">https://www.dropbox.com/s/9sv67e7f2repbpb/lldb-commands-map.png?dl=0</a></p>
<h3 id="1-è·å–å˜é‡å€¼å’ŒçŠ¶æ€"><a href="#1-è·å–å˜é‡å€¼å’ŒçŠ¶æ€" class="headerlink" title="1. è·å–å˜é‡å€¼å’ŒçŠ¶æ€"></a>1. è·å–å˜é‡å€¼å’ŒçŠ¶æ€</h3><p>å‘½ä»¤ï¼š<code>expression</code>, <code>e</code>, <code>print</code>, <code>po</code>, <code>p</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-28e3583bcef761ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è°ƒè¯•å™¨çš„ä¸€ä¸ªåŸºç¡€åŠŸèƒ½å°±æ˜¯è·å–å’Œä¿®æ”¹å˜é‡çš„å€¼ã€‚è¿™å°±æ˜¯ <code>expression</code> æˆ–è€… <code>e</code> è¢«åˆ›é€ çš„åŸå› ï¼ˆå½“ç„¶ä»–ä»¬è¿˜æœ‰æ›´é«˜çº§çš„åŠŸèƒ½ï¼‰ã€‚æ‚¨å¯ä»¥ç®€å•çš„åœ¨è¿è¡Œæ—¶æ‰§è¡Œä»»ä½•è¡¨è¾¾å¼æˆ–å‘½ä»¤ã€‚</p>
<p>å‡è®¾ä½ ç°åœ¨æ­£åœ¨è°ƒè¯•æ–¹æ³• <code>valueOfLifeWithoutSumOf()</code> ï¼šå¯¹ä¸¤ä¸ªæ•°æ±‚å’Œï¼Œå†ç”¨42å»å‡å¾—åˆ°ç»“æœã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-f788753308492216.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç»§ç»­å‡è®¾ä½ ä¸€ç›´å¾—åˆ°é”™è¯¯çš„ç»“æœå¹¶ä¸”ä½ å¹¶ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ã€‚æ‰€ä»¥ä½ å¯ä»¥åšä»¥ä¸‹çš„äº‹æ¥æ‰¾åˆ°é—®é¢˜ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-ca27db839bd80a19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ–è€…ã€‚ã€‚ã€‚ä½¿ç”¨ LLDB è¡¨è¾¾å¼åœ¨è¿è¡Œæ—¶ä¿®æ”¹å€¼æ‰æ˜¯æ›´å¥½çš„æ–¹æ³•ï¼ŒåŒæ—¶å¯ä»¥æ‰¾å‡ºé—®é¢˜æ˜¯åœ¨å“ªé‡Œå‡ºç°çš„ã€‚é¦–å…ˆï¼Œåœ¨ä½ æ„Ÿå…´è¶£çš„åœ°æ–¹è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åè¿è¡Œä½ çš„åº”ç”¨ã€‚</p>
<p>ä¸ºäº†ç”¨ LLDB æ ¼å¼æ‰“å°æŒ‡å®šçš„å˜é‡ä½ åº”è¯¥è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) e &lt;variable&gt;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤æ¥æ‰§è¡Œä¸€äº›è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) e &lt;expression&gt;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-42790260c5498fe3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(lldb) e sum </div><div class="line">(Int) $R0 = 6 // ä¸‹é¢ä½ ä¹Ÿå¯ä»¥ç”¨ $R0 æ¥å¼•ç”¨è¿™ä¸ªå˜é‡ï¼ˆåœ¨æœ¬æ¬¡è°ƒè¯•è¿‡ç¨‹ä¸­ï¼‰</div><div class="line"></div><div class="line">(lldb) e sum = 4 // ä¿®æ”¹å˜é‡ sum çš„å€¼</div><div class="line"></div><div class="line">(lldb) e sum </div><div class="line">(Int) $R2 = 4 // ç›´åˆ°æœ¬æ¬¡è°ƒè¯•ç»“æŸå˜é‡ sum éƒ½ä¼šæ˜¯ &quot;4&quot;</div></pre></td></tr></table></figure>
<p><code>expression</code> å‘½ä»¤ä¹Ÿæœ‰ä¸€äº›æ ‡å¿—ã€‚åœ¨ <code>expression</code> åé¢ç”¨åŒç ´æŠ˜å· <code>--</code> å°†æ ‡å¿—å’Œå®é™…çš„è¡¨è¾¾å¼åˆ†éš”å¼€ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) expression &lt;some flags&gt; -- &lt;variable&gt;</div></pre></td></tr></table></figure>
<p><code>expression</code> å‘½ä»¤å·®ä¸å¤šæœ‰30ç§ä¸åŒçš„æ ‡å¿—ã€‚æˆ‘é¼“åŠ±ä½ å¤šå»æ¢ç´¢å®ƒä»¬ã€‚åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°å®Œæ•´çš„æ–‡æ¡£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; lldb</div><div class="line">&gt; (lldb) help # è·å–æ‰€æœ‰å˜é‡çš„å‘½ä»¤</div><div class="line">&gt; (lldb) help expression # è·å–æ‰€æœ‰è¡¨è¾¾å¼çš„å­å‘½ä»¤</div></pre></td></tr></table></figure>
<p>æˆ‘ä¼šåœ¨ä¸‹åˆ— <code>expression</code> çš„æ ‡å¿—ä¸Šå¤šåœç•™ä¸€ä¼šå„¿ï¼š</p>
<ul>
<li><code>-D &lt;count&gt;</code> (<code>--depth &lt;count&gt;</code>)â€Š â€” è®¾ç½®åœ¨è½¬å‚¨èšåˆç±»å‹æ—¶çš„æœ€å¤§é€’å½’æ·±åº¦ï¼ˆé»˜è®¤ä¸ºæ— ç©·å¤§ï¼‰ã€‚</li>
<li><code>-O</code> (<code>--object-description</code>)â€Š â€” å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨æŒ‡å®šè¯­è¨€çš„æè¿°APIæ¥æ˜¾ç¤ºã€‚</li>
<li><code>-T</code> (<code>--show-types</code>)â€Š â€” åœ¨è½¬å‚¨å€¼çš„æ—¶å€™æ˜¾ç¤ºå˜é‡ç±»å‹ã€‚</li>
<li><code>-f &lt;format&gt;</code> (<code>--format &lt;format&gt;</code>) â€” æŒ‡å®šä¸€ç§ç”¨äºæ˜¾ç¤ºçš„æ ¼å¼ã€‚</li>
<li><code>-i &lt;boolean&gt;</code> (<code>--ignore-breakpoints &lt;boolean&gt;</code>)â€Šâ€” åœ¨è¿è¡Œè¡¨è¾¾å¼æ—¶å¿½ç•¥æ–­ç‚¹ã€‚</li>
</ul>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå« <code>logger</code> çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ä¸€äº›å­—ç¬¦ä¸²å’Œç»“æ„ä½“ç±»å‹çš„å±æ€§ã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯èƒ½åªæ˜¯æƒ³çŸ¥é“ç¬¬ä¸€å±‚çš„å±æ€§ï¼Œé‚£åªéœ€è¦ç”¨ <code>-D</code> æ ‡å¿—ä»¥åŠæ°å½“çš„å±‚çº§æ·±åº¦å€¼ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(lldb) e -D 1 -- logger</div><div class="line"></div><div class="line">(LLDB_Debugger_Exploration.Logger) $R5 = 0x0000608000087e90 &#123;</div><div class="line">  currentClassName = &quot;ViewController&quot;</div><div class="line">  debuggerStruct =&#123;...&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLLDB ä¼šæ— é™åœ°éå†è¯¥å¯¹è±¡å¹¶ä¸”ç»™ä½ å±•ç¤ºæ¯ä¸ªåµŒå¥—çš„å¯¹è±¡çš„å®Œæ•´æè¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(lldb) e -- logger</div><div class="line"></div><div class="line">(LLDB_Debugger_Exploration.Logger) $R6 = 0x0000608000087e90 &#123;</div><div class="line">  currentClassName = &quot;ViewController&quot;</div><div class="line">  debuggerStruct = (methodName = &quot;name&quot;, lineNumber = 2, commandCounter = 23)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ç”¨ <code>e -O --</code> è·å–å¯¹è±¡çš„æè¿°æˆ–è€…æ›´ç®€å•åœ°ç”¨åˆ«å <code>po</code>ï¼Œå°±åƒä¸‹é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) po logger</div><div class="line"></div><div class="line">&lt;Logger: 0x608000087e90&gt;</div></pre></td></tr></table></figure>
<p>å¹¶ä¸æ˜¯å¾ˆæœ‰æè¿°æ€§ï¼Œä¸æ˜¯å—ï¼Ÿä¸ºäº†è·å–æ›´åŠ å¯é˜…è¯»çš„æè¿°ï¼Œä½ è‡ªå®šä¹‰çš„ç±»å¿…é¡»éµå¾ª <code>CustomStringConvertible</code> åè®®ï¼ŒåŒæ—¶å®ç° <code>var description: String { return ...}</code> å±æ€§ã€‚æ¥ä¸‹æ¥åªéœ€è¦ç”¨ <code>po</code> å°±èƒ½è¿”å›å¯è¯»çš„æè¿°ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-67b11fbfba92f9c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨æœ¬èŠ‚çš„å¼€å§‹ï¼Œæˆ‘ä¹Ÿæåˆ°äº† <code>print</code> å‘½ä»¤ã€‚åŸºæœ¬ä¸Š <code>print &lt;expression/variable&gt;</code> å°±ç­‰åŒäº <code>expression -- &lt;expression/variable&gt;</code>ã€‚ä½†æ˜¯ <code>print</code> å‘½ä»¤ä¸èƒ½å¸¦ä»»ä½•æ ‡å¿—æˆ–è€…é¢å¤–çš„å‚æ•°ã€‚</p>
<h3 id="2-è·å–æ•´ä¸ª-APP-çš„çŠ¶æ€å’ŒæŒ‡å®šè¯­è¨€çš„å‘½ä»¤"><a href="#2-è·å–æ•´ä¸ª-APP-çš„çŠ¶æ€å’ŒæŒ‡å®šè¯­è¨€çš„å‘½ä»¤" class="headerlink" title="2. è·å–æ•´ä¸ª APP çš„çŠ¶æ€å’ŒæŒ‡å®šè¯­è¨€çš„å‘½ä»¤"></a>2. è·å–æ•´ä¸ª APP çš„çŠ¶æ€å’ŒæŒ‡å®šè¯­è¨€çš„å‘½ä»¤</h3><p><code>bugreport</code>, <code>frame</code>, <code>language</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-b6780919d5f067a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½ æ˜¯å¦ç»å¸¸å¤åˆ¶ç²˜è´´å´©æºƒæ—¥å¿—åˆ°ä»»åŠ¡ç®¡ç†å™¨ä¸­æ–¹ä¾¿ç¨åèƒ½è€ƒè™‘è¿™ä¸ªé—®é¢˜å—ï¼ŸLLDB æä¾›äº†ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å‘½ä»¤å« <code>bugreport</code>ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½ç”Ÿæˆå½“å‰åº”ç”¨çŠ¶æ€çš„å®Œæ•´æŠ¥å‘Šã€‚åœ¨ä½ å¶ç„¶è§¦å‘æŸäº›é—®é¢˜ä½†æ˜¯æƒ³åœ¨ç¨åå†è§£å†³å®ƒæ—¶è¿™ä¸ªå‘½ä»¤å°±ä¼šå¾ˆæœ‰å¸®åŠ©äº†ã€‚ä¸ºäº†èƒ½æ¢å¤åº”ç”¨çš„çŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>bugreport</code> ç”ŸæˆæŠ¥å‘Šã€‚ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) bugreport unwind --outfile &lt;path to output file&gt;</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆçš„æŠ¥å‘Šçœ‹èµ·æ¥å°±åƒä¸‹é¢æˆªå›¾ä¸­çš„ä¾‹å­ä¸€æ ·ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-f8a7604c35151d5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><code>bugreport</code> å‘½ä»¤è¾“å‡ºçš„ç¤ºä¾‹ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-2179c17fefec7742.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‡è®¾ä½ æƒ³è¦è·å–å½“å‰çº¿ç¨‹çš„å½“å‰æ ˆå¸§çš„æ¦‚è¿°ï¼Œ<code>frame</code> å‘½ä»¤å¯ä»¥å¸®ä½ å®Œæˆï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-5207a680ff245ddf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¥å¿«é€Ÿè·å–å½“å‰åœ°å€ä»¥åŠå½“å‰çš„ç¯å¢ƒæ¡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) frame info</div><div class="line"></div><div class="line">frame #0: 0x000000010bbe4b4d LLDB-Debugger-Exploration`ViewController.valueOfLifeWithoutSumOf(a=2, b=2, self=0x00007fa0c1406900) -&gt; Int at ViewController.swift:96</div></pre></td></tr></table></figure>
<p>è¿™äº›ä¿¡æ¯åœ¨æœ¬æ–‡åé¢å°†è¦è¯´åˆ°çš„æ–­ç‚¹ç®¡ç†ä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-2b16ad60aed4e6af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>LLDB æœ‰å‡ ä¸ªæŒ‡å®šè¯­è¨€çš„å‘½ä»¤ï¼ŒåŒ…æ‹¬C++ï¼ŒObjective-Cï¼ŒSwift å’Œ RenderScriptã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ Swiftã€‚è¿™æ˜¯ä¸¤ä¸ªå‘½ä»¤ï¼š<code>demangle</code> å’Œ <code>refcount</code>ã€‚</p>
<p><code>demangle</code> æ­£å¦‚å…¶åå­—è€Œè¨€ï¼Œå°±æ˜¯ç”¨æ¥é‡ç»„ Swift ç±»å‹åçš„ï¼ˆå› ä¸º Swift åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç”Ÿæˆç±»å‹åæ¥é¿å…å‘½åç©ºé—´çš„é—®é¢˜ï¼‰ã€‚å¦‚æœä½ æƒ³äº†è§£å¤šä¸€ç‚¹çš„è¯ï¼Œæˆ‘å»ºè®®ä½ çœ‹ WWDC14 çš„è¿™ä¸ªåˆ†äº«ä¼š â€” â€Š<a href="https://developer.apple.com/videos/play/wwdc2014/410/" target="_blank" rel="external">â€œAdvanced Swift Debugging in LLDBâ€</a>ã€‚</p>
<p><code>refcount</code> åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å½“ç›´è§‚çš„å‘½ä»¤ï¼Œèƒ½è·å¾—æŒ‡å®šå¯¹è±¡çš„å¼•ç”¨æ•°é‡ã€‚ä¸€èµ·æ¥çœ‹ä¸€ä¸‹å¯¹è±¡è¾“å‡ºçš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬ç”¨äº†ä¸Šä¸€èŠ‚è®²åˆ°çš„å¯¹è±¡ â€” <code>logger</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) language swift refcount logger</div><div class="line"></div><div class="line">refcount data: (strong = 4, weak = 0)</div></pre></td></tr></table></figure>
<p>å½“ç„¶äº†ï¼Œåœ¨ä½ è°ƒè¯•æŸäº›å†…å­˜æ³„éœ²é—®é¢˜æ—¶ï¼Œè¿™ä¸ªå‘½ä»¤å°±ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>
<h3 id="3-æ§åˆ¶åº”ç”¨çš„æ‰§è¡Œæµç¨‹"><a href="#3-æ§åˆ¶åº”ç”¨çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="3. æ§åˆ¶åº”ç”¨çš„æ‰§è¡Œæµç¨‹"></a>3. æ§åˆ¶åº”ç”¨çš„æ‰§è¡Œæµç¨‹</h3><p><code>process</code>, <code>breakpoint</code>, <code>thread</code></p>
<p>è¿™èŠ‚æ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸€èŠ‚ï¼Œå› ä¸ºåœ¨ LLDB ä½¿ç”¨è¿™å‡ ä¸ªå‘½ä»¤ï¼ˆå°¤å…¶æ˜¯ <code>breakpoint</code> å‘½ä»¤ï¼‰ï¼Œä½ å¯ä»¥åœ¨è°ƒè¯•çš„æ—¶å€™ä½¿å¾ˆå¤šå¸¸è§„ä»»åŠ¡å˜å¾—è‡ªåŠ¨åŒ–ï¼Œè¿™æ ·å°±èƒ½å¤§å¤§åŠ å¿«ä½ çš„è°ƒè¯•å·¥ä½œã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-190d8c7f7600ae0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é€šè¿‡ <code>process</code> åŸºæœ¬ä¸Šä½ å°±å¯ä»¥æ§åˆ¶è°ƒè¯•çš„è¿‡ç¨‹äº†ï¼Œè¿˜èƒ½é“¾æ¥åˆ°ç‰¹å®šçš„ target æˆ–è€…åœæ­¢è°ƒè¯•å™¨ã€‚ ä½†æ˜¯å› ä¸º Xcode å·²ç»è‡ªåŠ¨åœ°å¸®æˆ‘ä»¬åšå¥½äº†è¿™ä¸ªå·¥ä½œäº†ï¼ˆXcode åœ¨ä»»ä½•æ—¶å€™è¿è¡Œä¸€ä¸ª target æ—¶éƒ½ä¼šè¿æ¥ LLDBï¼‰ã€‚æˆ‘ä¸ä¼šåœ¨è¿™å„¿è®²å¤ªå¤šï¼Œä½ å¯ä»¥åœ¨è¿™ç¯‡ Apple çš„æŒ‡å—ä¸­é˜…è¯»ä¸€ä¸‹å¦‚ä½•ç”¨ç»ˆç«¯è¿æ¥åˆ°ä¸€ä¸ª target â€” <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/lldb-terminal-workflow-tutorial.html" target="_blank" rel="external">â€œUsing LLDB as a Standalone Debuggerâ€</a>ã€‚</p>
<p>ä½¿ç”¨ <code>process status</code> çš„è¯ï¼Œä½ å¯ä»¥çŸ¥é“å½“å‰è°ƒè¯•å™¨åœä½çš„åœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">(lldb) process status</div><div class="line"></div><div class="line">Process 27408 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = step over</div><div class="line">frame #0: 0x000000010bbe4889 LLDB-Debugger-Exploration`ViewController.viewDidLoad(self=0x00007fa0c1406900) -&gt; () at ViewController.swift:69</div><div class="line">66</div><div class="line">67           let a = 2, b = 2</div><div class="line">68           let result = valueOfLifeWithoutSumOf(a, and: b)</div><div class="line">-&gt; 69           print(result)</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td></tr></table></figure>
<p>æƒ³è¦ç»§ç»­ target çš„æ‰§è¡Œè¿‡ç¨‹ç›´åˆ°é‡åˆ°ä¸‹æ¬¡æ–­ç‚¹çš„è¯ï¼Œè¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) process continue</div><div class="line"></div><div class="line">(lldb) c // æˆ–è€…åªé”®å…¥ &quot;c&quot;ï¼Œè¿™è·Ÿä¸Šä¸€æ¡å‘½ä»¤æ˜¯ä¸€æ ·çš„</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‘½ä»¤ç­‰åŒäº Xcode è°ƒè¯•å™¨å·¥å…·æ ä¸Šçš„â€continueâ€œæŒ‰é’®ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-8d3a7affc384f574.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-779f316d847a475c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><code>breakpoint</code> å‘½ä»¤å…è®¸ä½ ç”¨ä»»ä½•å¯èƒ½çš„æ–¹å¼æ“ä½œæ–­ç‚¹ã€‚æˆ‘ä»¬è·³è¿‡æœ€æ˜¾è€Œæ˜“è§çš„å‘½ä»¤ï¼š<code>breakpoint enable</code>, <code>breakpoint disable</code> å’Œ <code>breakpoint delete</code>ã€‚</p>
<p>é¦–å…ˆï¼ŒæŸ¥çœ‹ä½ æ‰€æœ‰æ–­ç‚¹çš„è¯å¯ä»¥ç”¨å¦‚ä¸‹ç¤ºä¾‹ä¸­çš„ <code>list</code> å­å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint list</div><div class="line"></div><div class="line">Current breakpoints:</div><div class="line">1: file = &apos;/Users/Ahmed/Desktop/Recent/LLDB-Debugger-Exploration/LLDB-Debugger-Exploration/ViewController.swift&apos;, line = 95, exact_match = 0, locations = 1, resolved = 1, hit count = 1</div><div class="line"></div><div class="line">1.1: where = LLDB-Debugger-Exploration`LLDB_Debugger_Exploration.ViewController.valueOfLifeWithoutSumOf (Swift.Int, and : Swift.Int) -&gt; Swift.Int + 27 at ViewController.swift:95, address = 0x0000000107f3eb3b, resolved, hit count = 1</div><div class="line"></div><div class="line">2: file = &apos;/Users/Ahmed/Desktop/Recent/LLDB-Debugger-Exploration/LLDB-Debugger-Exploration/ViewController.swift&apos;, line = 60, exact_match = 0, locations = 1, resolved = 1, hit count = 1</div><div class="line"></div><div class="line">2.1: where = LLDB-Debugger-Exploration`LLDB_Debugger_Exploration.ViewController.viewDidLoad () -&gt; () + 521 at ViewController.swift:60, address = 0x0000000107f3e609, resolved, hit count = 1</div></pre></td></tr></table></figure>
<p>åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯æ˜¯æ–­ç‚¹çš„ IDï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ª ID å¼•ç”¨åˆ°æŒ‡å®šçš„æ–­ç‚¹ã€‚ç°åœ¨è®©æˆ‘ä»¬åœ¨æ§åˆ¶å°ä¸­è®¾ç½®ä¸€äº›æ–°çš„æ–­ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint set -f ViewController.swift -l 96</div><div class="line"></div><div class="line">Breakpoint 3: where = LLDB-Debugger-Exploration`LLDB_Debugger_Exploration.ViewController.valueOfLifeWithoutSumOf (Swift.Int, and : Swift.Int) -&gt; Swift.Int + 45 at ViewController.swift:96, address = 0x0000000107f3eb4d</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­çš„ <code>-f</code> æ˜¯ä½ æƒ³è¦æ”¾ç½®æ–­ç‚¹å¤„çš„æ–‡ä»¶åï¼Œ<code>-l</code> æ˜¯æ–°æ–­ç‚¹çš„è¡Œæ•°ã€‚è¿˜æœ‰ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼è®¾ç½®åŒæ ·çš„æ–­ç‚¹ï¼Œå°±æ˜¯ç”¨å¿«æ·æ–¹å¼ <code>b</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) b ViewController.swift:96</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ°ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨æŒ‡å®šçš„æ­£åˆ™ï¼ˆæ¯”å¦‚å‡½æ•°åï¼‰æ¥è®¾ç½®æ–­ç‚¹ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint set --func-regex valueOfLifeWithoutSumOf</div><div class="line"></div><div class="line">(lldb) b -r valueOfLifeWithoutSumOf // ä¸Šä¸€æ¡å‘½ä»¤çš„ç®€åŒ–ç‰ˆæœ¬</div></pre></td></tr></table></figure>
<p>æœ‰äº›æ—¶å€™è®¾ç½®æ–­ç‚¹åªå‘½ä¸­ä¸€æ¬¡ä¹Ÿæ˜¯æœ‰ç”¨çš„ï¼Œç„¶åæŒ‡ç¤ºè¿™ä¸ªæ–­ç‚¹ç«‹å³åˆ é™¤è‡ªå·±ï¼Œå½“ç„¶å•¦ï¼Œæœ‰ä¸€ä¸ªå‘½ä»¤æ¥å¤„ç†è¿™ä»¶äº‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint set --one-shot -f ViewController.swift -l 90</div><div class="line"></div><div class="line">(lldb) br s -o -f ViewController.swift -l 91 // ä¸Šä¸€æ¡å‘½ä»¤çš„ç®€åŒ–ç‰ˆæœ¬</div></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬æ¥åˆ°äº†æœ€æœ‰è¶£çš„éƒ¨åˆ† â€” è‡ªåŠ¨åŒ–æ–­ç‚¹ã€‚ä½ çŸ¥é“ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„åŠ¨ä½œä½¿å®ƒåœ¨æ–­ç‚¹åœä½çš„æ—¶å€™æ‰§è¡Œå—ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥ï¼ä½ æ˜¯å¦ä¼šåœ¨ä»£ç ä¸­ç”¨ <code>print()</code> æ¥åœ¨è°ƒè¯•çš„æ—¶å€™å¾—åˆ°ä½ æ„Ÿå…´è¶£çš„å€¼ï¼Ÿè¯·ä¸è¦å†è¿™æ ·åšäº†ï¼Œè¿™é‡Œæœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ã€‚ğŸ™‚</p>
<p>é€šè¿‡ <code>breakpoint</code> å‘½ä»¤ï¼Œä½ å¯ä»¥è®¾ç½®å¥½å‘½ä»¤ï¼Œä½¿å…¶åœ¨æ–­ç‚¹å‘½ä¸­æ—¶å¯ä»¥æ­£ç¡®æ‰§è¡Œã€‚ä½ ç”šè‡³å¯ä»¥è®¾ç½®â€ä¸å¯è§â€œçš„æ–­ç‚¹ï¼Œè¿™ç§æ–­ç‚¹å¹¶ä¸ä¼šæ‰“æ–­è¿è¡Œè¿‡ç¨‹ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›â€œä¸å¯è§çš„â€æ–­ç‚¹å…¶å®æ˜¯ä¼šä¸­æ–­æ‰§è¡Œçš„ï¼Œä½†å¦‚æœåœ¨å‘½ä»¤é“¾çš„æœ«å°¾æ·»ä¸Šâ€œcontinueâ€å‘½ä»¤çš„è¯ï¼Œä½ å°±ä¸ä¼šæ³¨æ„åˆ°å®ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(lldb) b ViewController.swift:96 // Let&apos;s add a breakpoint first</div><div class="line"></div><div class="line">Breakpoint 2: where = LLDB-Debugger-Exploration`LLDB_Debugger_Exploration.ViewController.valueOfLifeWithoutSumOf (Swift.Int, and : Swift.Int) -&gt; Swift.Int + 45 at ViewController.swift:96, address = 0x000000010c555b4d</div><div class="line"></div><div class="line">(lldb) breakpoint command add 2 // å‡†å¤‡æŸäº›å‘½ä»¤</div><div class="line"></div><div class="line">Enter your debugger command(s).  Type &apos;DONE&apos; to end.</div><div class="line">&gt; p sum // æ‰“å°å˜é‡ &quot;sum&quot; çš„å€¼</div><div class="line">&gt; p a + b // è¿è¡Œ a + b</div><div class="line">&gt; DONE</div></pre></td></tr></table></figure>
<p>ä¸ºäº†ç¡®ä¿ä½ æ·»åŠ çš„å‘½ä»¤æ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥ä½¿ç”¨  <code>breakpoint command list &lt;breakpoint id&gt;</code> å­å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint command list 2</div><div class="line"></div><div class="line">Breakpoint 2:</div><div class="line">Breakpoint commands:</div><div class="line">p sum</div><div class="line">p a + b</div></pre></td></tr></table></figure>
<p>å½“ä¸‹æ¬¡æ–­ç‚¹å‘½ä¸­æ—¶æˆ‘ä»¬å°±ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Process 36612 resuming</div><div class="line">p sum</div><div class="line">(Int) $R0 = 6</div><div class="line"></div><div class="line">p a + b</div><div class="line">(Int) $R1 = 4</div></pre></td></tr></table></figure>
<p>å¤ªæ£’äº†ï¼è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤é“¾çš„æœ«å°¾æ·»åŠ  <code>continue</code> å‘½ä»¤è®©æ‰§è¡Œè¿‡ç¨‹æ›´åŠ é¡ºç•…ï¼Œè¿™æ ·ä½ å°±ä¸ä¼šåœåœ¨è¿™ä¸ªæ–­ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(lldb) breakpoint command add 2 // å‡†å¤‡æŸäº›å‘½ä»¤</div><div class="line"></div><div class="line">Enter your debugger command(s).  Type &apos;DONE&apos; to end.</div><div class="line">&gt; p sum // æ‰“å°å˜é‡ &quot;sum&quot; çš„å€¼</div><div class="line">&gt; p a + b // è¿è¡Œ a + b</div><div class="line">&gt; continue // ç¬¬ä¸€æ¬¡å‘½ä¸­æ–­ç‚¹åç›´æ¥æ¢å¤</div><div class="line">&gt; DONE</div></pre></td></tr></table></figure>
<p>ç»“æœä¼šæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">p sum</div><div class="line">(Int) $R0 = 6</div><div class="line"></div><div class="line">p a + b</div><div class="line">(Int) $R1 = 4</div><div class="line"></div><div class="line">continue</div><div class="line">Process 36863 resuming</div><div class="line">Command #3 &apos;continue&apos; continued the target.</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-a1c3ec912e68ba8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é€šè¿‡ <code>thread</code> å‘½ä»¤å’Œå®ƒçš„å­å‘½ä»¤ï¼Œä½ å¯ä»¥å®Œå…¨æ“æ§æ‰§è¡Œæµç¨‹ï¼š<code>step-over</code>, <code>step-in</code>, <code>step-out</code> å’Œ <code>continue</code>ã€‚è¿™äº›å‘½ä»¤ç­‰åŒäº Xcode è°ƒè¯•å™¨å·¥å…·æ ä¸Šçš„æµç¨‹æ§åˆ¶æŒ‰é’®ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-0dfdf39bff20db4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>LLDB åŒæ ·ä¹Ÿå¯¹è¿™äº›ç‰¹æ®Šçš„å‘½ä»¤é¢„å…ˆå®šä¹‰å¥½äº†å¿«æ·æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(lldb) thread step-over</div><div class="line">(lldb) next // å’Œ &quot;thread step-over&quot; å‘½ä»¤æ•ˆæœä¸€æ ·</div><div class="line">(lldb) n // å’Œ &quot;next&quot; å‘½ä»¤æ•ˆæœä¸€æ ·</div><div class="line"></div><div class="line">(lldb) thread step-in</div><div class="line">(lldb) step // å’Œ &quot;thread step-in&quot; å‘½ä»¤æ•ˆæœä¸€æ ·</div><div class="line">(lldb) s // å’Œ &quot;step&quot; å‘½ä»¤æ•ˆæœä¸€æ ·</div></pre></td></tr></table></figure>
<p>ä¸ºäº†è·å–å½“å‰çº¿ç¨‹çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ <code>info</code> å­å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) thread info </div><div class="line"></div><div class="line">thread #1: tid = 0x17de17, 0x0000000109429a90 LLDB-Debugger-Exploration`ViewController.sumOf(a=2, b=2, self=0x00007fe775507390) -&gt; Int at ViewController.swift:90, queue = &apos;com.apple.main-thread&apos;, stop reason = step in</div></pre></td></tr></table></figure>
<p>æƒ³è¦çœ‹åˆ°å½“å‰æ‰€æœ‰çš„æ´»åŠ¨çº¿ç¨‹çš„è¯ä½¿ç”¨ <code>list</code> å­å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(lldb) thread list</div><div class="line"></div><div class="line">Process 50693 stopped</div><div class="line"></div><div class="line">* thread #1: tid = 0x17de17, 0x0000000109429a90 LLDB-Debugger-Exploration`ViewController.sumOf(a=2, b=2, self=0x00007fe775507390) -&gt; Int at ViewController.swift:90, queue = &apos;com.apple.main-thread&apos;, stop reason = step in</div><div class="line"></div><div class="line">  thread #2: tid = 0x17df4a, 0x000000010daa4dc6  libsystem_kernel.dylib`kevent_qos + 10, queue = &apos;com.apple.libdispatch-manager&apos;</div><div class="line">  </div><div class="line">  thread #3: tid = 0x17df4b, 0x000000010daa444e libsystem_kernel.dylib`__workq_kernreturn + 10</div><div class="line"></div><div class="line">  thread #5: tid = 0x17df4e, 0x000000010da9c34a libsystem_kernel.dylib`mach_msg_trap + 10, name = &apos;com.apple.uikit.eventfetch-thread&apos;</div></pre></td></tr></table></figure>
<h3 id="è£èª‰å¥–"><a href="#è£èª‰å¥–" class="headerlink" title="è£èª‰å¥–"></a>è£èª‰å¥–</h3><p><code>command</code>, <code>platform</code>, <code>gui</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-93fdf48e5daca771.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ LLDB ä¸­ä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå‘½ä»¤ç®¡ç†å…¶ä»–çš„å‘½ä»¤ï¼Œå¬èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯éå¸¸æœ‰ç”¨çš„å°å·¥å…·ã€‚é¦–å…ˆï¼Œå®ƒå…è®¸ä½ ä»æ–‡ä»¶ä¸­æ‰§è¡Œä¸€äº› LLDB å‘½ä»¤ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå‚¨å­˜ç€ä¸€äº›å®ç”¨å‘½ä»¤çš„æ–‡ä»¶ï¼Œç„¶åå°±èƒ½ç«‹åˆ»å…è®¸è¿™äº›å‘½ä»¤ï¼Œå°±åƒæ˜¯å•ä¸ªå‘½ä»¤é‚£æ ·ã€‚è¿™æ˜¯æ‰€è¯´çš„æ–‡ä»¶çš„ç®€å•ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">thread info // æ˜¾ç¤ºå½“å‰çº¿ç¨‹çš„ä¿¡æ¯</div><div class="line">br list // æ˜¾ç¤ºæ‰€æœ‰çš„æ–­ç‚¹</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å®é™…å‘½ä»¤çš„æ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(lldb) command source /Users/Ahmed/Desktop/lldb-test-script</div><div class="line"></div><div class="line">Executing commands in &apos;/Users/Ahmed/Desktop/lldb-test-script&apos;.</div><div class="line"></div><div class="line">thread info</div><div class="line">thread #1: tid = 0x17de17, 0x0000000109429a90 LLDB-Debugger-Exploration`ViewController.sumOf(a=2, b=2, self=0x00007fe775507390) -&gt; Int at ViewController.swift:90, queue = &apos;com.apple.main-thread&apos;, stop reason = step in</div><div class="line"></div><div class="line">br list</div><div class="line">Current breakpoints:</div><div class="line">1: file = &apos;/Users/Ahmed/Desktop/Recent/LLDB-Debugger-Exploration/LLDB-Debugger-Exploration/ViewController.swift&apos;, line = 60, exact_match = 0, locations = 1, resolved = 1, hit count = 0</div><div class="line">1.1: where = LLDB-Debugger-Exploration`LLDB_Debugger_Exploration.ViewController.viewDidLoad () -&gt; () + 521 at ViewController.swift:60, address = 0x0000000109429609, resolved, hit count = 0</div></pre></td></tr></table></figure>
<p>é—æ†¾çš„æ˜¯è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œä½ ä¸èƒ½ä¼ é€’ä»»ä½•å‚æ•°ç»™è¿™ä¸ªæºæ–‡ä»¶ï¼ˆé™¤éä½ åœ¨è„šæœ¬æ–‡ä»¶æœ¬èº«ä¸­åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡ï¼‰ã€‚</p>
<p>å¦‚æœä½ éœ€è¦æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>script</code> å­å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å…è®¸ä½ ç”¨è‡ªå®šä¹‰çš„ Python è„šæœ¬ ç®¡ç†(<code>add</code>, <code>delete</code>, <code>import</code> å’Œ <code>list</code>)ï¼Œé€šè¿‡ <code>script</code> å‘½ä»¤èƒ½å®ç°çœŸæ­£çš„è‡ªåŠ¨åŒ–ã€‚è¯·é˜…è¯»è¿™ä¸ªä¼˜ç§€çš„æ•™ç¨‹ <a href="http://www.fabianguerra.com/ios/introduction-to-lldb-python-scripting/" target="_blank" rel="external">Python scripting for LLDB</a>ã€‚ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ script.pyï¼Œç„¶åå†™ä¸€ä¸ªç®€å•çš„å‘½ä»¤ <strong>print_hello()</strong>ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ºâ€œHello Debugger!â€œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import lldb</div><div class="line"></div><div class="line">def print_hello(debugger, command, result, internal_dict):</div><div class="line">	print &quot;Hello Debugger!&quot;</div><div class="line">    </div><div class="line">def __lldb_init_module(debugger, internal_dict):</div><div class="line">	debugger.HandleCommand(&apos;command script add -f script.print_hello print_hello&apos;) // æ§åˆ¶è„šæœ¬çš„åˆå§‹åŒ–åŒæ—¶ä»è¿™ä¸ªæ¨¡å—ä¸­æ·»åŠ å‘½ä»¤</div><div class="line">	print &apos;The &quot;print_hello&quot; python command has been installed and is ready for use.&apos; // æ‰“å°ç¡®è®¤ä¸€åˆ‡æ­£å¸¸</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸€ä¸ª Python æ¨¡å—ï¼Œå°±èƒ½å¼€å§‹æ­£å¸¸åœ°ä½¿ç”¨æˆ‘ä»¬çš„è„šæœ¬å‘½ä»¤äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(lldb) command import ~/Desktop/script.py</div><div class="line"></div><div class="line">The &quot;print_hello&quot; python command has been installed and is ready for use.</div><div class="line"></div><div class="line">(lldb) print_hello</div><div class="line"></div><div class="line">Hello Debugger!</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-463b54c539c5eb64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>status</code> å­å‘½ä»¤æ¥å¿«é€Ÿæ£€æŸ¥å½“å‰çš„ç¯å¢ƒä¿¡æ¯ï¼Œ<code>status</code> ä¼šå‘Šè¯‰ä½ ï¼šSDK è·¯å¾„ã€å¤„ç†å™¨çš„æ¶æ„ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç”šè‡³æ˜¯è¯¥ SDK å¯æ”¯æŒçš„è®¾å¤‡çš„åˆ—è¡¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">(lldb) platform status</div><div class="line"></div><div class="line">Platform: ios-simulator</div><div class="line">Triple: x86_64-apple-macosx</div><div class="line">OS Version: 10.12.5 (16F73)</div><div class="line">Kernel: Darwin Kernel Version 16.6.0: Fri Apr 14 16:21:16 PDT 2017; root:xnu-3789.60.24~6/RELEASE_X86_64</div><div class="line">Hostname: 127.0.0.1</div><div class="line">WorkingDir: /</div><div class="line">SDK Path: &quot;/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk&quot;</div><div class="line"></div><div class="line">Available devices:</div><div class="line">614F8701-3D93-4B43-AE86-46A42FEB905A: iPhone 4s</div><div class="line">CD516CF7-2AE7-4127-92DF-F536FE56BA22: iPhone 5</div><div class="line">0D76F30F-2332-4E0C-9F00-B86F009D59A3: iPhone 5s</div><div class="line">3084003F-7626-462A-825B-193E6E5B9AA7: iPhone 6</div><div class="line">...</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-7ac0c7f2bf73cecd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½ ä¸èƒ½åœ¨ Xcode ä¸­ä½¿ç”¨ LLDB GUI æ¨¡å¼ï¼Œä½†ä½ æ€»æ˜¯å¯ä»¥ä»ç»ˆç«¯ä½¿ç”¨ï¼ˆLLDB GUI æ¨¡å¼ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(lldb) gui</div><div class="line"></div><div class="line">// å¦‚æœä½ è¯•ç€åœ¨ Xcode ä¸­æ‰§è¡Œè¿™ä¸ª gui å‘½ä»¤çš„è¯ï¼Œä½ å°†ä¼šçœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼šthe gui command requires an interactive terminalã€‚</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-5d99e8dfc0af41df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™å°±æ˜¯ LLDB GUI æ¨¡å¼çœ‹èµ·æ¥çš„æ ·å­ã€‚</p>
<h3 id="ç»“è®ºï¼š"><a href="#ç»“è®ºï¼š" class="headerlink" title="ç»“è®ºï¼š"></a>ç»“è®ºï¼š</h3><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘åªæ˜¯æµ…æäº† LLDB çš„çš®æ¯›çŸ¥è¯†è€Œå·²ï¼Œå³ä½¿ LLDB å·²ç»æœ‰å¥½äº›å¹´å¤´äº†ï¼Œä½†æ˜¯ä»ç„¶æœ‰è®¸å¤šäººå¹¶æ²¡æœ‰å®Œå…¨å‘æŒ¥å‡ºå®ƒçš„æ½œèƒ½ã€‚æˆ‘åªæ˜¯å¯¹åŸºæœ¬çš„æ–¹æ³•åšäº†ä¸€ä¸ªæ¦‚è¿°ï¼Œä»¥åŠè°ˆäº† LLDB å¦‚ä½•è‡ªåŠ¨åŒ–è°ƒè¯•æ­¥éª¤ã€‚æˆ‘å¸Œæœ›è¿™ä¼šæ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>
<p>è¿˜æœ‰å¾ˆå¤š LLDB çš„æ–¹æ³•å¹¶æ²¡æœ‰å†™åˆ°ï¼Œç„¶åè¿˜æœ‰ä¸€äº›è§†å›¾è°ƒè¯•æŠ€æœ¯æˆ‘æ²¡æœ‰æåŠã€‚å¦‚æœä½ å¯¹è¿™äº›è¯é¢˜æ„Ÿå…´è¶£çš„è¯ï¼Œè¯·åœ¨ä¸‹é¢ç•™ä¸‹ä½ çš„è¯„è®ºï¼Œæˆ‘ä¼šæ›´åŠ ä¹äºå†™è¿™äº›è¯é¢˜ã€‚</p>
<p>æˆ‘å¼ºçƒˆå»ºè®®ä½ æ‰“å¼€ç»ˆç«¯ï¼Œå¯åŠ¨ LLDBï¼Œåªéœ€è¦æ•²å…¥ <code>help</code>ï¼Œå°±ä¼šå‘ä½ å±•ç¤ºå®Œæ•´çš„æ–‡æ¡£ã€‚ä½ å¯ä»¥èŠ±è´¹æ•°å°æ—¶å»é˜…è¯»ï¼Œä½†æ˜¯æˆ‘ä¿è¯è¿™å°†æ˜¯ä¸€ä¸ªåˆç†çš„æ—¶é—´æŠ•èµ„ã€‚å› ä¸ºäº†è§£ä½ çš„å·¥å…·æ˜¯å·¥ç¨‹å¸ˆçœŸæ­£äº§å‡ºçš„å”¯ä¸€é€”å¾„ã€‚</p>
<hr>
<ul>
<li><a href="http://lldb.llvm.org" target="_blank" rel="external">LLDB å®˜æ–¹ç½‘ç«™</a> â€” â€Šä½ ä¼šåœ¨è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰ä¸ LLDB ç›¸å…³çš„ææ–™ã€‚æ–‡æ¡£ã€æŒ‡å—ã€æ•™ç¨‹ã€æºæ–‡ä»¶ä»¥åŠæ›´å¤šã€‚</li>
<li><a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/Introduction.html#//apple_ref/doc/uid/TP40012917-CH1-SW1" target="_blank" rel="external">LLDB Quick Start Guide by Apple</a> â€” åŒæ ·åœ°ï¼ŒApple æä¾›äº†å¾ˆå¥½çš„æ–‡æ¡£ã€‚è¿™ç¯‡æŒ‡å—èƒ½å¸®ä½ å¿«é€Ÿä¸Šæ‰‹ LLDBï¼Œå½“ç„¶ï¼Œä»–ä»¬ä¹Ÿå™è¿°äº†æ€æ ·ä¸é€šè¿‡ Xcode åœ°ç”¨ LLDB è°ƒè¯•ã€‚</li>
<li><a href="http://eli.thegreenplace.net/2011/01/23/how-debuggers-work-part-1" title="Permalink to How debuggers work: Part 1 - Basics" target="_blank" rel="external">How debuggers work: Part 1â€Šâ€”â€ŠBasics</a> â€” æˆ‘éå¸¸å–œæ¬¢è¿™ä¸ªç³»åˆ—çš„æ–‡ç« ï¼Œè¿™æ˜¯å¯¹è°ƒè¯•å™¨å®é™…å·¥ä½œæ–¹å¼å¾ˆå¥½çš„æ¦‚è¿°ã€‚æ–‡ç« ä»‹ç»äº†ç”¨ C è¯­è¨€æ‰‹å·¥ç¼–å†™çš„è°ƒè¯•å™¨ä»£ç è¦éµå¾ªçš„æ‰€æœ‰åŸºæœ¬åŸç†ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ å»é˜…è¯»è¿™ä¸ªä¼˜ç§€ç³»åˆ—çš„æ‰€æœ‰éƒ¨åˆ†ï¼ˆ<a href="http://eli.thegreenplace.net/2011/01/27/how-debuggers-work-part-2-breakpoints" target="_blank" rel="external">ç¬¬2éƒ¨åˆ†</a>, <a href="http://eli.thegreenplace.net/2011/02/07/how-debuggers-work-part-3-debugging-information" target="_blank" rel="external">ç¬¬3éƒ¨åˆ†</a>ï¼‰ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2014/410/" target="_blank" rel="external">WWDC14 Advanced Swift Debugging in LLDB</a> â€” å…³äºåœ¨ LLDB ä¸­ç”¨ Swift è°ƒè¯•çš„ä¸€ç¯‡ä¸é”™çš„æ¦‚è¿°ï¼Œä¹Ÿè®²äº† LLDB å¦‚ä½•é€šè¿‡å†…å»ºçš„æ–¹æ³•å’Œç‰¹æ€§å®ç°å®Œæ•´çš„è°ƒè¯•æ“ä½œï¼Œæ¥å¸®ä½ å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</li>
<li><a href="http://www.fabianguerra.com/ios/introduction-to-lldb-python-scripting/" target="_blank" rel="external">Introduction To LLDB Python Scripting</a> â€” è¿™ç¯‡ä»‹ç» LLDB Python è„šæœ¬çš„æŒ‡å—èƒ½è®©ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚</li>
<li><a href="https://www.objc.io/issues/19-debugging/lldb-debugging" target="_blank" rel="external">Dancing in the Debugger. A Waltz with LLDB</a>â€Š â€” å¯¹ LLDB ä¸€äº›åŸºç¡€çŸ¥è¯†çš„ä»‹ç»ï¼Œæœ‰äº›çŸ¥è¯†æœ‰ç‚¹è¿‡æ—¶äº†ï¼ˆæ¯”å¦‚è¯´ <code>(lldb) thread return</code> å‘½ä»¤ï¼‰ã€‚é—æ†¾çš„æ˜¯ï¼Œå®ƒä¸èƒ½ç›´æ¥ç”¨äº Swiftï¼Œå› ä¸ºå®ƒä¼šå¯¹å¼•ç”¨è®¡æ•°å¸¦äº†ä¸€äº›æ½œåœ¨çš„éšæ‚£ã€‚ä½†æ˜¯ï¼Œè¿™ä»ç„¶æ˜¯ä½ å¼€å§‹ LLDB ä¹‹æ—…ä¸é”™çš„æ–‡ç« ã€‚</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/æ ¼å¼åŒ–Import/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/01/æ ¼å¼åŒ–Import/" itemprop="url">
                  Source Editor Extension â€” Xcode æ ¼å¼åŒ– Import çš„æ’ä»¶
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-01T17:06:35+08:00">
                2018-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/01/æ ¼å¼åŒ–Import/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/02/01/æ ¼å¼åŒ–Import/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/02/01/æ ¼å¼åŒ–Import/" class="leancloud_visitors" data-flag-title="Source Editor Extension â€” Xcode æ ¼å¼åŒ– Import çš„æ’ä»¶">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>Xcode ç§‰æ‰¿äº† Apple å°é—­çš„ä¼ ç»Ÿï¼Œæä¾›çš„å¯è‡ªå®šä¹‰çš„é€‰é¡¹æ¯”èµ·å…¶ä»– IDE æ¥è¯´æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œä¸è¿‡åœ¨ Xcode 7 ä¹‹å‰ï¼ˆåŒ…å« Xcode 7ï¼‰æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ’ä»¶å®ç° Xcode çš„è‡ªå®šä¹‰ï¼Œç”šè‡³è¿˜å‡ºç°äº†åƒ  <a href="https://github.com/alcatraz/Alcatraz" target="_blank" rel="external">Alcatraz</a> çš„ä¸“é—¨çš„æ’ä»¶ç®¡ç†å·¥å…·ï¼Œå¼€æºç¤¾åŒºä¸­ä¹Ÿæœ‰è¯¸å¦‚ <a href="https://link.jianshu.com/?t=https://github.com/onevcat/VVDocumenter-Xcode" target="_blank" rel="external">VVDocumenter-Xcode</a>ã€<a href="https://github.com/CocoaPods/CocoaPods" target="_blank" rel="external">CocoaPods</a> ç­‰çŸ¥åçš„æ’ä»¶ï¼Œä¸è¿‡è¿™äº›ä¾¿åˆ©éšç€ Xcode 8 çš„å‘å¸ƒæˆä¸ºäº†è¿‡å»å¼ã€‚<br>å‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼ˆæ¯”å¦‚è¯´ Xcode ghost äº‹ä»¶ï¼‰ï¼ŒApple ä» Xcode 8 å¼€å§‹ä¸å†æ”¯æŒç¬¬ä¸‰æ–¹çš„æ’ä»¶ã€‚Apple æ–¹é¢æä¾›äº†åŸºäº App Extension çš„è§£å†³æ–¹æ¡ˆ â€“ Xcode Source Editor Extensionï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ–¹æ¡ˆï¼Œèƒ½ä¸”ä»…èƒ½å®Œæˆæœ‰é™çš„æ–‡æœ¬ç¼–è¾‘è¾…åŠ©ï¼Œå¾ˆå¤§éƒ¨åˆ†ä¹‹å‰ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½å®Œæˆçš„ä»»åŠ¡éƒ½æ²¡åŠæ³•å®ç°äº†ã€‚èŠèƒœäºæ— å§ ğŸ˜‘<br>ï¼ˆæœ¬æ–‡ä¼šä»‹ç» Source Editor Extension çš„å¼€å‘ä»¥åŠåˆ†å‘ç›¸å…³çš„çŸ¥è¯†ï¼Œæœ¬æ–‡å¯¹åº”çš„ Demo åœ¨ï¼š<a href="https://github.com/VernonVan/PPImportArrangerExtensionï¼‰" target="_blank" rel="external">https://github.com/VernonVan/PPImportArrangerExtensionï¼‰</a></p>
<h2 id="åˆ›å»ºæ’ä»¶"><a href="#åˆ›å»ºæ’ä»¶" class="headerlink" title="åˆ›å»ºæ’ä»¶"></a>åˆ›å»ºæ’ä»¶</h2><ol>
<li><p>åˆ›å»ºä¸€ä¸ª Cocoa Appï¼šSource Editor Extension ä¸èƒ½ç‹¬ç«‹å­˜åœ¨ï¼Œå¿…é¡»ä¾é™„äº Cocoa Appã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-a00fabcbca0f7353.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Cocoa App"></p>
<p>â€‹</p>
</li>
<li><p>File -&gt; New -&gt; Target -&gt; Xcode Source Editor Extension æ·»åŠ ä¸€ä¸ª Targetï¼Œå¹¶æ¿€æ´»è¿™ä¸ª Targetã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-0c32ca262d291557.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Xcode Source Editor Extension"><br><img src="http://upload-images.jianshu.io/upload_images/698554-b6a7d64355a372d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¿€æ´» target"></p>
</li>
</ol>
<p>è¿™æ ·å°±åˆ›å»ºå¥½äº†ä¸€ä¸ªå¯è¿è¡Œçš„ Source Editor Extensionï¼Œç›¸å½“çš„ç®€å•ã€‚ğŸ§</p>
<h2 id="å…³é”®æ¦‚å¿µ"><a href="#å…³é”®æ¦‚å¿µ" class="headerlink" title="å…³é”®æ¦‚å¿µ"></a>å…³é”®æ¦‚å¿µ</h2><p><img src="http://upload-images.jianshu.io/upload_images/698554-0e6f169643d8a20f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡ä»¶ç»“æ„"></p>
<ul>
<li>SourceEditorExtension ç±»ï¼šéµå¾ª XCSourceEditorExtension åè®®çš„ç±»ï¼ŒXCSourceEditorExtension åè®®çš„å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@protocol XCSourceEditorExtension &lt;NSObject&gt;</div><div class="line"></div><div class="line">@optional</div><div class="line"></div><div class="line">- (void)extensionDidFinishLaunching;</div><div class="line"></div><div class="line">@property (readonly, copy) NSArray &lt;NSDictionary &lt;XCSourceEditorCommandDefinitionKey, id&gt; *&gt; *commandDefinitions;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>XCSourceEditorExtension åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•å’Œä¸€ä¸ªå±æ€§ï¼ŒextensionDidFinishLaunching æ–¹æ³•æ˜¯ç”¨æ¥åœ¨æ’ä»¶åŠ è½½å¥½åæ˜¯å¯¹æ’ä»¶è¿›è¡Œä¸€äº›å‡†å¤‡å·¥ä½œçš„ï¼Œæ ¹æ® <a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">WWDC</a> çš„è¯´æ³•ï¼Œå„ä¸ªæ’ä»¶ä¸ Xcode æœ¬èº«çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯åœ¨ä¸åŒè¿›ç¨‹ä¸Šè¿›è¡Œçš„ï¼ŒåŒæ ·åœ°ï¼Œæ’ä»¶çš„å´©æºƒå¹¶ä¸ä¼šå¼•èµ· Xcode çš„å´©æºƒã€‚commandDefinitions å±æ€§åˆ™å¯ä»¥åŠ¨æ€è¿”å›æ’ä»¶çš„èœå•é¡¹ã€‚</p>
<p>SourceEditorCommand ç±»ï¼šéµå¾ª XCSourceEditorCommand åè®®çš„ç±»ï¼Œå®ç°æ’ä»¶åŠŸèƒ½çš„æ ¸å¿ƒç±»ï¼Œå¯¹åº”åˆ°æ’ä»¶çš„èœå•é¡¹ï¼Œå¯ä»¥ä¸€ä¸ªèœå•é¡¹å¯¹åº”åˆ°ä¸€ä¸ª Command ç±»ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªèœå•é¡¹å¯¹åº”åˆ°ä¸€ä¸ª Command ç±»ï¼ŒXCSourceEditorCommand åè®®å¤´æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@protocol XCSourceEditorCommand &lt;NSObject&gt;</div><div class="line"></div><div class="line">@required</div><div class="line"></div><div class="line">- (void)performCommandWithInvocation:(XCSourceEditorCommandInvocation *)invocation completionHandler:(void (^)(NSError * _Nullable nilOrError))completionHandler;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>XCSourceEditorCommandInvocation ç±»å‹çš„å‚æ•° invocation ä¸»è¦æ˜¯ç‚¹å‡»çš„èœå•é¡¹çš„æ ‡è¯†ã€å½“å‰æ–‡æœ¬ä¿¡æ¯ï¼ˆæ–‡æœ¬å­—ç¬¦ä¸²æ•°ç»„ã€é€‰ä¸­åŒºé—´ç­‰ï¼‰ä»¥åŠç‚¹å‡»å–æ¶ˆæŒ‰é’®çš„å›è°ƒäº‹ä»¶ï¼ŒcompletionHandler å‚æ•°åˆ™æ˜¯ç”¨æ¥é€šçŸ¥ Xcode æœ¬æ’ä»¶å·²ç»å®Œæˆäº†è‡ªå·±çš„æ“ä½œï¼Œéœ€è¦ä¿è¯ä¸€å®šè¦è°ƒç”¨ completionHandlerï¼å¦åˆ™ä¼šå‡ºç°ä¸‹å›¾æ‰€ç¤ºçš„æç¤ºï¼Œç„¶åèœå•é¡¹å°±ä¼šå˜ç°ä¸èƒ½å†ç‚¹å‡»ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-f57b5a31a603f5f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ’ä»¶ busy"><br><img src="http://upload-images.jianshu.io/upload_images/698554-8e6d0b4a636883f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="èœå•é¡¹å˜ç°"></p>
<ul>
<li>Info.plistï¼šInfo.plist æ–‡ä»¶ç”¨äºé™æ€é…ç½®æ’ä»¶å¯¹åº”çš„èœå•é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒXCSourceEditorExtensionPrincipalClass å¯¹åº”åˆ°ä¸Šæ–‡è¯´çš„ XCSourceEditorExtension ç±»ï¼ŒXCSourceEditorCommandDefinitions æŒ‡å®šèœå•é¡¹ï¼ŒXCSourceEditorCommandClassName å¯¹åº”åˆ°ä¸Šæ–‡è¯´çš„ SourceEditorCommand ç±»ï¼ŒXCSourceEditorCommandIdentifier æ˜¯æ¯ä¸ªå…·ä½“èœå•é¡¹çš„æ ‡è¯†ï¼ŒXCSourceEditorCommandName æ˜¯èœå•é¡¹çš„æè¿°ã€‚</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-54682412d2c5b04a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Info.plist"></p>
<ul>
<li>ä¿è¯ TARGETS ç»„ä¸‹çš„ä¸¤ä¸ª Target ç”¨çš„åŒä¸€ä¸ªç­¾åã€‚</li>
</ul>
<h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><p>æœ¬ Demo è¦å®ç°çš„åŠŸèƒ½å°±æ˜¯æŒ‰ç…§å­—æ¯é¡ºåºé‡æ–°æ’åˆ—å½“å‰æ–‡ä»¶çš„æ‰€æœ‰ Importï¼Œå¼ºè¿«ç—‡ä»¬ä¸€å®šçŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆğŸ¤£ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-58e34917de432fbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå›¾"><br><img src="http://upload-images.jianshu.io/upload_images/698554-9638491f62073029.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¼”ç¤ºæ•ˆæœ"><br>å¯ä»¥ç‚¹å‡» Editor -&gt; ImportArranger -&gt; Arrange Imports é‡æ–°æ’åˆ—æ‰€æœ‰çš„ Importsï¼Œç”šè‡³è¿˜å¯ä»¥ä¸ºå…¶è®¾ç½®å¿«é”®é”®ã€‚</p>
<p>å®ç°æ­¥éª¤åè€Œæ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ï¼Œä¸»è¦æ˜¯æ“ä½œ invocation.buffer.lines å’Œ invocation.buffer.selectionsï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯å½“å‰æ–‡ä»¶çš„æ‰€æœ‰è¡Œå’Œå½“å‰æ–‡ä»¶çš„é€‰æ‹©åŒºåŸŸï¼Œéƒ½æ˜¯å¯å˜ç±»å‹çš„æ•°ç»„ï¼Œåšå®Œè‡ªå®šä¹‰çš„æ“ä½œåæ“ä½œæ•°ç»„å³å¯æ›´æ–°å½“å‰æ–‡ä»¶ã€‚æ³¨æ„ï¼š<strong>ä¸ç®¡æ˜¯å“ªæ¡æ‰§è¡Œè·¯å¾„ï¼Œä¸€å®šè¦ä¿è¯è°ƒç”¨åˆ° completionHandler</strong>ã€‚å…¶ä»–éœ€è¦ç•™æ„çš„åœ°æ–¹éƒ½åœ¨ä»£ç ä¸­çš„æ³¨é‡Šä¸­ç»™å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">- (void)performCommandWithInvocation:(XCSourceEditorCommandInvocation *)invocation completionHandler:(void (^)(NSError *_Nullable nilOrError))completionHandler</div><div class="line">&#123;</div><div class="line">    NSMutableArray&lt;NSString *&gt; *lines = invocation.buffer.lines;</div><div class="line">    if (!lines || !lines.count) &#123;</div><div class="line">        completionHandler(nil);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSMutableArray&lt;NSString *&gt; *importLines = [[NSMutableArray alloc] init];</div><div class="line">    NSInteger firstLine = -1;</div><div class="line">    for (NSUInteger index = 0, max = lines.count; index &lt; max; index++) &#123;</div><div class="line">        NSString *line = lines[index];</div><div class="line">        NSString *pureLine = [line stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];       // å»æ‰å¤šä½™çš„ç©ºæ ¼ï¼Œä»¥é˜²è¢«ç©ºæ ¼å¹²æ‰°æ²¡æ£€æµ‹åˆ° #import</div><div class="line">        // æ”¯æŒ Objective-Cã€Swiftã€C è¯­è¨€çš„å¯¼å…¥æ–¹å¼</div><div class="line">        if ([pureLine hasPrefix:@&quot;#import&quot;] || [pureLine hasPrefix:@&quot;import&quot;] || [pureLine hasPrefix:@&quot;@class&quot;]</div><div class="line">            || [pureLine hasPrefix:@&quot;@import&quot;] || [pureLine hasPrefix:@&quot;#include&quot;]) &#123;     </div><div class="line">            [importLines addObject:line];</div><div class="line">            if (firstLine == -1) &#123;</div><div class="line">                firstLine = index;      // è®°ä½ç¬¬ä¸€è¡Œ #import æ‰€åœ¨çš„è¡Œæ•°ï¼Œç”¨æ¥ç­‰ä¸‹é‡æ–°æ’å…¥çš„ä½ç½®</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (!importLines.count) &#123;</div><div class="line">        completionHandler(nil);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [invocation.buffer.lines removeObjectsInArray:importLines];</div><div class="line"></div><div class="line">    NSArray *noRepeatArray = [[NSSet setWithArray:importLines] allObjects];         // å»æ‰é‡å¤çš„ #import</div><div class="line">    NSMutableArray&lt;NSString *&gt; *sortedImports = [[NSMutableArray alloc] initWithArray:[noRepeatArray sortedArrayUsingSelector:@selector(caseInsensitiveCompare:)]];</div><div class="line"></div><div class="line">    // å¼•ç”¨ç³»ç»Ÿæ–‡ä»¶åœ¨å‰ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„æ–‡ä»¶åœ¨å</div><div class="line">    NSMutableArray *systemImports = [[NSMutableArray alloc] init];</div><div class="line">    for (NSString *line in sortedImports) &#123;</div><div class="line">        if ([line containsString:@&quot;&lt;&quot;]) &#123;</div><div class="line">            [systemImports addObject:line];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    if (systemImports.count) &#123;</div><div class="line">        [sortedImports removeObjectsInArray:systemImports];</div><div class="line">        [sortedImports insertObjects:systemImports atIndexes:[NSIndexSet indexSetWithIndexesInRange:NSMakeRange(0, systemImports.count)]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (firstLine &gt;= 0 &amp;&amp; firstLine &lt; invocation.buffer.lines.count) &#123;</div><div class="line">        // é‡æ–°æ’å…¥æ’å¥½åºçš„ #import è¡Œ</div><div class="line">        [invocation.buffer.lines insertObjects:sortedImports atIndexes:[NSIndexSet indexSetWithIndexesInRange:NSMakeRange(firstLine, sortedImports.count)]];</div><div class="line">        // é€‰ä¸­æ‰€æœ‰ #import è¡Œ</div><div class="line">        [invocation.buffer.selections addObject:[[XCSourceTextRange alloc] initWithStart:XCSourceTextPositionMake(firstLine, 0) end:XCSourceTextPositionMake(firstLine + sortedImports.count, sortedImports.lastObject.length)]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    completionHandler(nil);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹©è¿™ä¸ªæ’ä»¶ä½œä¸ºå½“å‰ Schemeï¼Œé€‰æ‹© Xcode è¿è¡Œï¼Œç„¶åå°±ä¼šå¼¹å‡ºä¸€ä¸ªé»‘è‰²çš„ Xcode ä¾›ä½ è°ƒè¯•äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-8fb83256d9e38800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="http://upload-images.jianshu.io/upload_images/698554-7410ea37b33422fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è°ƒè¯•æ’ä»¶"></p>
<h2 id="åˆ†å‘"><a href="#åˆ†å‘" class="headerlink" title="åˆ†å‘"></a>åˆ†å‘</h2><p>æ’ä»¶å¼€å‘æµ‹è¯•å®Œæˆä¹‹åï¼Œæœ€é‡è¦çš„å½“ç„¶æ˜¯å°†æ’ä»¶åˆ†å‘å‡ºå»ï¼Œä¾›ä»–äººä½¿ç”¨ã€‚Apple åœ¨  <a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">WWDC</a> è¯´åˆ° Xcode Source Editor Extension æ˜¯å¯ä»¥ä¸Šæ¶ Mac App Store çš„ï¼Œä¸è¿‡å—é™äº Source Editor Extension åŠŸèƒ½å®åœ¨å¤ªå°‘ï¼Œç›®å‰ä¹Ÿæ²¡æœ‰åœ¨ Mac App Store ä¸Šçœ‹åˆ°å¾ˆç«çš„æ’ä»¶ã€‚æ›´å¤šæ˜¯ç›´æ¥æŠŠ .app æ–‡ä»¶ä¸Šä¼ åˆ° Github ä¸Šä¾›äººä¸‹è½½ï¼ˆè¿™é‡Œæœ‰äººæ•´ç†äº†ä¸€äº›ä¸é”™çš„æ’ä»¶ï¼š<a href="https://github.com/theswiftdev/awesome-xcode-extensionsï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š" target="_blank" rel="external">https://github.com/theswiftdev/awesome-xcode-extensionsï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</a></p>
<h4 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h4><p>æµ‹è¯•å®Œæˆåï¼Œæ‰¾åˆ° Products ä¸‹é¢çš„ .app æ–‡ä»¶ï¼Œæ³¨æ„éœ€è¦ä¿è¯ä¸Šæ–‡ä¸­è¯´çš„ä¸¤ä¸ªç­¾åæ˜¯ä¸€è‡´çš„ã€‚ç„¶åå°±å¯ä»¥æŠŠè¿™ä¸ª .app ä¸Šä¼ åˆ°ä¸ªäººç½‘ç«™æˆ–è€… Github ä¸Šä¾›äººä¸‹è½½ä½¿ç”¨äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-5202f8ddea721d38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=".app æ–‡ä»¶"></p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>å½“æˆ‘ä»¬ä¸‹è½½å¥½äº†ä¸€ä¸ª .app æ ¼å¼çš„æ’ä»¶ä¹‹åï¼Œç›´æ¥åŒå‡»è¿™ä¸ª .app æ–‡ä»¶ï¼Œç„¶ååœ¨ ç³»ç»Ÿåå¥½è®¾ç½®-&gt; æ‰©å±• -&gt; Xcode Source Editor Extension å‹¾é€‰è¯¥æ’ä»¶ï¼Œæœ€åé‡å¯ Xcode å°±å¯ä»¥åœ¨ Editor èœå•ä¸­æ‰¾åˆ°è¯¥æ’ä»¶äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-b35bafce22cccf86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å‹¾é€‰æ’ä»¶"></p>
<p>è¿˜å¯ä»¥åœ¨ Xcode ä¸­ä¸ºæ’ä»¶çš„èœå•é¡¹è®¾ç½®å¿«æ·é”®ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-d5f2a3622205f490.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®å¿«é”®é”®"></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è‡³å°‘ç°æœ‰çš„ Xcode Source Editor Extension è¿˜æ˜¯æ¯”è¾ƒå—é™çš„ï¼Œæ¥å£å°‘çš„å¯æ€œï¼Œå¯æƒ³è±¡çš„ç©ºé—´ä¸æ˜¯å¾ˆå¤šï¼Œå¤§éƒ¨åˆ†ä¹‹å‰ç¬¬ä¸‰æ–¹æ’ä»¶èƒ½åšçš„äº‹æƒ…éƒ½æ²¡åŠæ³•å®Œæˆäº†ğŸ¤·â€â™€ï¸ã€‚è¿˜æ˜¯é»˜é»˜å¸Œæœ› Apple èƒ½ä»¥æ›´åŠ å¼€æ”¾çš„å§¿æ€ï¼Œæä¾›æ›´å¤šçš„æ¥å£ç»™å¼€å‘è€…ï¼ŒXcode æ²¡åŠæ³•æ»¡è¶³æ‰€æœ‰äººçš„å–œå¥½ï¼Œèµ·ç ï¼Œèƒ½è®©å–œæ¬¢æŠ˜è…¾çš„äººæŠŠå®ƒå˜å¾—æ›´å¥½ :-D</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/19/iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/19/iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°/" itemprop="url">
                  iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-19T23:55:51+08:00">
                2018-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/19/iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/01/19/iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/01/19/iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°/" class="leancloud_visitors" data-flag-title="iOSè¡¨æƒ…é”®ç›˜çš„å®Œæ•´å®ç°">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘åœ¨å…¬å¸åšäº†ä¸ªè¡¨æƒ…é”®ç›˜çš„éœ€æ±‚ï¼Œè¿™ä¸ªéœ€æ±‚çš„æŠ€æœ¯éš¾åº¦ä¸ä¼šå¾ˆå¤§ï¼Œæ¯”è¾ƒåå‘ä¸šåŠ¡ã€‚ä½†æ˜¯è¦æŠŠç”¨æˆ·ä½“éªŒåšçš„å¥½ä¹Ÿæ˜¯ä¸å®¹æ˜“çš„ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚è¯ä¸å¤šè¯´ï¼Œä¸‹é¢å¼€å§‹æ­£æ–‡(æ³¨ï¼šæœ¬æ–‡å¯¹åº”çš„Demoæ”¾åœ¨Githubä¸Šï¼š<a href="https://github.com/VernonVan/PPStickerKeyboard" target="_blank" rel="external">https://github.com/VernonVan/PPStickerKeyboard</a>)ã€‚</p>
<h2 id="å¸‚é¢ä¸Šçš„è¡¨æƒ…é”®ç›˜çš„åˆ†æ"><a href="#å¸‚é¢ä¸Šçš„è¡¨æƒ…é”®ç›˜çš„åˆ†æ" class="headerlink" title="å¸‚é¢ä¸Šçš„è¡¨æƒ…é”®ç›˜çš„åˆ†æ"></a>å¸‚é¢ä¸Šçš„è¡¨æƒ…é”®ç›˜çš„åˆ†æ</h2><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å¸‚é¢ä¸Šä¸»è¦çš„å‡ ä¸ªAPPä¸Šçš„è¡¨æƒ…é”®ç›˜ï¼Œå¹³æ—¶ä½¿ç”¨çš„æ—¶å€™ä¸ä¼šå»å…³æ³¨ç»†èŠ‚ï¼Œè¿™æ¬¡ç‰¹æ„å»ä½¿ç”¨äº†è¡¨æƒ…é”®ç›˜ï¼Œå‘ç°å„ä¸ªAPPçš„ä½“éªŒè¿˜æ˜¯æœ‰ä¼˜æœ‰åŠ£çš„ã€‚</p>
<p>é¦–å…ˆæ˜¯QQå’Œå¾®ä¿¡ï¼Œè¿™ä¸¤è€…å·®ä¸å¤šï¼Œåˆ‡æ¢åˆ°è¡¨æƒ…é”®ç›˜çš„æ—¶å€™éƒ½æ˜¯æ²¡æœ‰å…‰æ ‡çš„ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒæ˜¯éå¸¸ä¸å¥½çš„ï¼Œæ²¡æœ‰åŠæ³•åœ¨è¾“å…¥è¡¨æƒ…çš„æ—¶å€™æ¡†é€‰åŒºåŸŸï¼Œä¹Ÿä¸èƒ½æ‹–åŠ¨å…‰æ ‡è¿›è¡Œç‰¹å®šä½ç½®çš„å¤åˆ¶é»è´´åˆ é™¤ç­‰æ“ä½œï¼Œå¾®ä¿¡ç”šè‡³åœ¨è¾“å…¥æ¡†é‡Œæ˜¾ç¤ºçš„éƒ½ä¸æ˜¯ç‚¹å‡»çš„è¡¨æƒ…å›¾ç‰‡ï¼Œè€Œæ˜¯æ–‡å­—æè¿°ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-2c59f42aa0dd0dd1.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¾®ä¿¡QQè¡¨æƒ…é”®ç›˜.JPG"></p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¾®åšå›½é™…ç‰ˆï¼Œå›½é™…ç‰ˆè°ƒèµ·è¡¨æƒ…é”®ç›˜æ—¶æ˜¯æœ‰å…‰æ ‡çš„ï¼Œæ˜¯ä¸€ä¸ªâ€çœŸæ­£çš„â€é”®ç›˜ï¼Œä½†æ˜¯æƒ³è¦æ‹–æ‹½å…‰æ ‡çš„æ—¶å€™ï¼Œå¾ˆå¤§æ¦‚ç‡ä¸Šä¼šè§¦å‘åˆ°ä¿å­˜å›¾ç‰‡çš„è¡Œä¸ºï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œå¯¼è‡´æ ¹æœ¬æ²¡åŠæ³•æ‹–åŠ¨å…‰æ ‡ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-5f667795a7778a6e.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¾®åšå›½é™…ç‰ˆè¯¯è§¦.JPG"></p>
<p>åŒæ—¶å¾®åšå›½é™…ç‰ˆè¾“å…¥æ¡†è¡¨æƒ…é»è´´åçš„å…‰æ ‡å®šä½æ˜¯é”™è¯¯çš„ï¼Œå¦‚ä¸‹å›¾ï¼Œå¼€å§‹æ—¶å…‰æ ‡æ˜¯åœ¨ç¬¬4ä¸ªè¡¨æƒ…åé¢ï¼Œç„¶åå¤åˆ¶ç‹—å¤´+å®³ç¾ä¸¤ä¸ªè¡¨æƒ…é»è´´åˆ°å…‰æ ‡åï¼Œå…‰æ ‡è¿˜æ˜¯åœ¨ç¬¬4ä¸ªè¡¨æƒ…åï¼ŒåŒæ—¶é»è´´çš„è¡¨æƒ…å‰åéƒ½è«åå¤šäº†ç©ºæ ¼ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-d4cddecefc22cfc9.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¾®åšå›½é™…ç‰ˆé»è´´.JPG"></p>
<p>æœ€åæ˜¯å¾®åšï¼Œå¾®åšå®¢æˆ·ç«¯çš„è¡¨æƒ…é”®ç›˜çš„ä½“éªŒæ˜¯éå¸¸å¥½çš„ï¼Œä¸Šé¢è¯´åˆ°çš„é—®é¢˜éƒ½ä¸å­˜åœ¨ï¼Œè€Œä¸”è¡¨æƒ…é”®ç›˜çš„åˆ é™¤æŒ‰é’®è¿˜èƒ½é•¿æŒ‰åˆ é™¤è¾“å…¥æ¡†çš„å†…å®¹ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-63023d1dfcce132b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¾®åšè¡¨æƒ…é”®ç›˜.jpg"></p>
<h2 id="è¡¨æƒ…é”®ç›˜çš„å®ç°"><a href="#è¡¨æƒ…é”®ç›˜çš„å®ç°" class="headerlink" title="è¡¨æƒ…é”®ç›˜çš„å®ç°"></a>è¡¨æƒ…é”®ç›˜çš„å®ç°</h2><h4 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h4><p>ä¸»è¦å®ç°äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½</p>
<ul>
<li>èƒ½è¾“å…¥è¡¨æƒ…ï¼Œæœ‰å…‰æ ‡ï¼Œæ”¯æŒå¤åˆ¶é»è´´åˆ é™¤è¡¨æƒ…ç­‰</li>
<li>é•¿æŒ‰é¢„è§ˆè¡¨æƒ…</li>
<li>åˆ é™¤è¡¨æƒ…ã€é•¿æŒ‰è¿ç»­åˆ é™¤è¡¨æƒ…</li>
<li>é€‚é… iPhone X<br><img src="http://upload-images.jianshu.io/upload_images/698554-9d1661ee627dc3ca.GIF?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¼”ç¤º.GIF"></li>
</ul>
<h4 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h4><p>é¦–å…ˆï¼Œè¡¨æƒ…åŒ…çš„å›¾ç‰‡æ˜¯ç”¨bundleçš„å½¢å¼ç»„ç»‡çš„ï¼Œç”¨<code>PPSticker</code>ç±»è¡¨å¾ä¸€å¥—è¡¨æƒ…åŒ…ï¼Œç”¨<code>PPEmoji</code>ç±»è¡¨å¾æŸä¸€ä¸ªè¡¨æƒ…ï¼Œç”¨ä¸€ä¸ªplistä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨è¡¨æƒ…åŒ…çš„ä¿¡æ¯ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-10847f03391e9560.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¡¨æƒ…çš„ç»„ç»‡.jpg"></p>
<p><code>PPStickerDataManager</code>ç±»ä¸»è¦è´Ÿè´£æ•°æ®éƒ¨åˆ†ï¼Œç”¨å•ä¾‹çš„å½¢å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™åªä¼šè¯»å–ä¸€æ¬¡plistæ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡¨æƒ…ä¿¡æ¯ï¼›åŒæ—¶æˆ‘ä»¬æŠŠè¾“å…¥æ¡†å†…å®¹å‘åˆ°æœåŠ¡ç«¯ä»¥åŠä»æœåŠ¡ç«¯è¯·æ±‚åˆ°çš„éƒ½æ˜¯çº¯æ–‡æœ¬çš„ï¼Œæ¯”å¦‚ä¼šæŠŠ â€œç¬‘æ­»äº†ğŸ¤£â€ è½¬æˆ â€œç¬‘æ­»äº†[ç¬‘å“­]â€ è¿™æ ·çš„çº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠè¡¨æƒ…å›¾ç‰‡ç›´æ¥å‘åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´é¡¹ç›®ä¸­æœ‰å¤§é‡çš„åœ°æ–¹ä¼šæœ‰æŠŠæ–‡æœ¬-&gt;è¡¨æƒ…çš„æ“ä½œï¼Œæ‰€ä»¥<code>PPStickerDataManager</code>ç±»ä¹Ÿæä¾›åŒ¹é…æŸæ®µçº¯æ–‡æœ¬ä¸­çš„è¡¨æƒ…ï¼Œå¹¶æŠŠæ–‡æœ¬æ›¿æ¢ä¸ºå›¾ç‰‡çš„åŠŸèƒ½ï¼Œ<code>PPStickerDataManager</code>ç±»çš„å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@interface PPStickerDataManager : NSObject</div><div class="line"></div><div class="line">+ (instancetype)sharedInstance;</div><div class="line"></div><div class="line">/// æ‰€æœ‰çš„è¡¨æƒ…åŒ…</div><div class="line">@property (nonatomic, strong, readonly) NSArray&lt;PPSticker *&gt; *allStickers;</div><div class="line"></div><div class="line">/* åŒ¹é…ç»™å®šattributedStringä¸­çš„æ‰€æœ‰emojiï¼Œå¦‚æœåŒ¹é…åˆ°çš„emojiæœ‰æœ¬åœ°å›¾ç‰‡çš„è¯ä¼šç›´æ¥æ¢æˆæœ¬åœ°çš„å›¾ç‰‡</div><div class="line"> *</div><div class="line"> * @param attributedString å¯èƒ½åŒ…å«è¡¨æƒ…åŒ…çš„attributedString</div><div class="line"> * @param font è¡¨æƒ…å›¾ç‰‡çš„å¯¹é½å­—ä½“å¤§å°</div><div class="line"> */</div><div class="line">- (void)replaceEmojiForAttributedString:(NSMutableAttributedString *)attributedString font:(UIFont *)font;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="â€œçœŸæ­£çš„â€é”®ç›˜"><a href="#â€œçœŸæ­£çš„â€é”®ç›˜" class="headerlink" title="â€œçœŸæ­£çš„â€é”®ç›˜"></a>â€œçœŸæ­£çš„â€é”®ç›˜</h4><p>çœŸæ­£çš„é”®ç›˜ä¹Ÿå°±æ˜¯è¯´è°ƒèµ·è¡¨æƒ…é”®ç›˜æ—¶è¾“å…¥æ¡†æ˜¯æœ‰å…‰æ ‡çš„ï¼Œèƒ½è¿›è¡Œæ‹–æ‹½å…‰æ ‡ã€é€‰ä¸­åŒºåŸŸç­‰çš„æ“ä½œï¼Œè¿™æ ·çš„ä½“éªŒæ‰æ˜¯ä¸ç³»ç»Ÿé”®ç›˜ä¸€è‡´çš„ã€‚å…¶å®ç³»ç»Ÿå·²ç»æä¾›å¥½äº†æ¥å£ç»™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼Œ<code>UITextView</code>å’Œ<code>UITextField</code>éƒ½æœ‰çš„<code>inputView</code>å’Œ<code>inputAccessoryView</code>å°±æ˜¯ç”¨æ¥å®ç°è‡ªå®šä¹‰é”®ç›˜çš„ï¼Œè¿™ä¸¤ä¸ªå±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// Presented when object becomes first responder.  If set to nil, reverts to following responder chain.  If</div><div class="line">// set while first responder, will not take effect until reloadInputViews is called.</div><div class="line">@property (nullable, readwrite, strong) UIView *inputView;             </div><div class="line">@property (nullable, readwrite, strong) UIView *inputAccessoryView;</div></pre></td></tr></table></figure>
<p>åŒæ—¶ç³»ç»Ÿé”®ç›˜åœ¨ è®¾ç½®-&gt;å£°éŸ³-&gt;æŒ‰é”®éŸ³ é€‰é¡¹æ‰“å¼€ä¸”æ‰‹æœºéé™éŸ³çŠ¶æ€ä¸‹è¾“å…¥æ˜¯æœ‰æŒ‰é”®çš„å£°éŸ³çš„ï¼Œè¿™ä¸ªæŒ‰é”®éŸ³ä¹Ÿæ˜¯å¯ä»¥æ”¯æŒçš„ï¼Œåªè¦è‡ªå®šä¹‰é”®ç›˜ç±»éµå¾ª<code>UIInputViewAudioFeedback</code>åè®®ï¼ŒåŒæ—¶å®ç° <code>enableInputClicksWhenVisible</code>æ–¹æ³•å¹¶è¿”å›YESï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç‚¹å‡»è¡¨æƒ…çš„æ—¶å€™è°ƒç”¨<code>[[UIDevice currentDevice] playInputClick]</code>æ–¹æ³•å‘å‡ºæŒ‰é”®éŸ³äº†ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/InputViews/InputViews.html" target="_blank" rel="external">è‹¹æœçš„å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>ä¸‹é¢æ˜¯Demoä¸­é”®ç›˜åˆ‡æ¢æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (void)changeKeyboardTo:(PPKeyboardType)toType</div><div class="line">&#123;</div><div class="line">    switch (toType) &#123;</div><div class="line">        case PPKeyboardTypeSystem:</div><div class="line">            self.textView.inputView = nil;    // åˆ‡æ¢åˆ°ç³»ç»Ÿé”®ç›˜</div><div class="line">            [self.textView reloadInputViews]; // è°ƒç”¨reloadInputViewsæ–¹æ³•ä¼šç«‹åˆ»è¿›è¡Œé”®ç›˜çš„åˆ‡æ¢</div><div class="line">            break;</div><div class="line">        case PPKeyboardTypeSticker:            </div><div class="line">            self.textView.inputView = self.stickerKeyboard; // åˆ‡æ¢åˆ°è‡ªå®šä¹‰çš„è¡¨æƒ…é”®ç›˜</div><div class="line">            [self.textView reloadInputViews];</div><div class="line">            break;</div><div class="line">        default:</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å»é™¤è¡¨æƒ…çš„æ‹–æ‹½äº¤äº’"><a href="#å»é™¤è¡¨æƒ…çš„æ‹–æ‹½äº¤äº’" class="headerlink" title="å»é™¤è¡¨æƒ…çš„æ‹–æ‹½äº¤äº’"></a>å»é™¤è¡¨æƒ…çš„æ‹–æ‹½äº¤äº’</h4><p>åœ¨iOS11ä¸Šï¼Œ<code>UITextView</code>ä¸Šçš„<code>NSTextAttachment</code>ï¼ˆè¡¨æƒ…ï¼‰é»˜è®¤å¯ä»¥è¿›è¡Œæ‹–æ‹½äº¤äº’ï¼Œä½†æ˜¯å´å¯¼è‡´æ‹–åŠ¨å…‰æ ‡æ—¶å¾ˆå®¹æ˜“è§¦å‘è¿™ä¸ªäº¤äº’ï¼ˆå›¾ç¤ºå¯ä»¥æŸ¥çœ‹ä¸Šé¢è¯´åˆ°çš„å¾®åšå›½é™…ç‰ˆä¸­çš„è¯¯è§¦ï¼‰ã€‚ä¸€ç•ªæŸ¥æ‰¾ä¹‹åæ‰æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒéšè”½çš„å±æ€§ï¼š<code>textDragInteraction</code>ï¼Œç›´æ¥è®¾ç½®ä¸º<code>NO</code>å°±èƒ½ç¦æ­¢æ‰<code>NSTextAttachment</code>çš„æ‹–æ‹½äº¤äº’ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (@available(iOS 11.0, *)) &#123;	// åªåœ¨iOS11åŠä»¥ä¸Šæ‰æœ‰è¿™ä¸ªå±æ€§</div><div class="line">     _textView.textDragInteraction.enabled = NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä¸æœåŠ¡ç«¯çš„äº¤äº’"><a href="#ä¸æœåŠ¡ç«¯çš„äº¤äº’" class="headerlink" title="ä¸æœåŠ¡ç«¯çš„äº¤äº’"></a>ä¸æœåŠ¡ç«¯çš„äº¤äº’</h4><p>æˆ‘ä»¬åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥çš„å†…å®¹ä¸æœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„æ—¶å€™éƒ½æ˜¯ç”¨çº¯æ–‡æœ¬çš„ï¼Œæ¯”å¦‚ä¼šæŠŠ â€œç¬‘æ­»äº†ğŸ¤£â€ è½¬æˆ â€œç¬‘æ­»äº†[ç¬‘å“­]â€ è¿™æ ·çš„çº¯æ–‡æœ¬å‘åˆ°æœåŠ¡ç«¯ï¼Œè€Œä¸æ˜¯ç›´æ¥å‘è¡¨æƒ…å›¾ç‰‡ï¼Œå‘æœåŠ¡ç«¯è¯·æ±‚å†…å®¹çš„æ—¶å€™ä¹Ÿæ˜¯ä¼ å› â€œç¬‘æ­»äº†[ç¬‘å“­]â€ï¼Œç„¶åå®¢æˆ·ç«¯å†æ ¹æ®æ­£åˆ™åŒ¹é…æ‰¾å‡ºè¡¨æƒ…æ›¿æ¢æˆå¯¹åº”çš„è¡¨æƒ…å›¾ç‰‡ï¼Œç„¶åæ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹å›¾ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-00199a31ec46945d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸æœåŠ¡ç«¯çš„äº¤äº’.png"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¾ç½®åˆ°è¾“å…¥æ¡†çš„<code>NSAttributedString</code>ä¸­çš„æ¯ä¸€ä¸ª<code>NSTextAttachment</code>éƒ½æœ‰ä¸€ä¸ªâ€éšè—çš„â€å±æ€§â€”è¡¨æƒ…çš„æ–‡æœ¬æè¿°ï¼Œè¿™é‡Œå¯¹<code>NSAttributedString</code>è¿›è¡Œæ‹“å±•å°±èƒ½å®ç°ã€‚<code>pp_setTextBackedString</code>å¯ä»¥å¯¹<code>NSAttributedString</code>çš„æŒ‡å®š<code>range</code>è®¾ç½®ä¸€ä¸ª<code>PPTextBackedString</code>ç±»å‹çš„å±æ€§ï¼Œè€Œ<code>pp_plainTextForRange</code>èƒ½æ‹¿åˆ°<code>NSAttributedString</code>æŒ‡å®š<code>range</code>çš„çº¯æ–‡æœ¬ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">@implementation NSAttributedString (PPAddition)</div><div class="line"></div><div class="line">- (NSString *)pp_plainTextForRange:(NSRange)range</div><div class="line">&#123;</div><div class="line">    if (range.location == NSNotFound || range.length == NSNotFound) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSMutableString *result = [[NSMutableString alloc] init];</div><div class="line">    if (range.length == 0) &#123;</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSString *string = self.string;</div><div class="line">    [self enumerateAttribute:PPTextBackedStringAttributeName inRange:range options:kNilOptions usingBlock:^(id value, NSRange range, BOOL *stop) &#123;</div><div class="line">        PPTextBackedString *backed = value;</div><div class="line">        if (backed &amp;&amp; backed.string) &#123;</div><div class="line">            [result appendString:backed.string];</div><div class="line">        &#125; else &#123;</div><div class="line">            [result appendString:[string substringWithRange:range]];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">    return result;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation NSMutableAttributedString (PPAddition)</div><div class="line"></div><div class="line">- (void)pp_setTextBackedString:(PPTextBackedString *)textBackedString range:(NSRange)range</div><div class="line">&#123;</div><div class="line">    if (textBackedString &amp;&amp; ![NSNull isEqual:textBackedString]) &#123;</div><div class="line">        [self addAttribute:PPTextBackedStringAttributeName value:textBackedString range:range];</div><div class="line">    &#125; else &#123;</div><div class="line">        [self removeAttribute:PPTextBackedStringAttributeName range:range];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="çµæ´»çš„å…‰æ ‡"><a href="#çµæ´»çš„å…‰æ ‡" class="headerlink" title="çµæ´»çš„å…‰æ ‡"></a>çµæ´»çš„å…‰æ ‡</h4><p>è¡¨æƒ…åŠŸèƒ½ï¼Œ<code>UITextView</code>éƒ½æ˜¯ç”¨<code>NSAttributedString</code>è¿›è¡Œèµ‹å€¼çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åº•å±‚å…¶å®è¿˜æ˜¯ç”¨ä¸Šé¢è¯´åˆ°çš„çº¯æ–‡æœ¬è¿›è¡Œå®ç°çš„ï¼Œé‚£ä¹ˆæŠŠ [ç¬‘æ­»] è½¬æˆ ğŸ¤£ å°±ä¼šä»4ä¸ªå­—ç¬¦å˜æˆ1ä¸ªå­—ç¬¦ï¼Œè¿™é‡Œæ˜¯æœ‰å·®å€¼çš„ï¼Œå¦‚æœä¸å¤„ç†çš„è¯å°±ä¼šå‡ºç°ä¸Šé¢æåˆ°çš„å¾®åšå›½é™…ç‰ˆä¸­å¤åˆ¶é»è´´è¾“å…¥æ¡†çš„è¡¨æƒ…ä¼šå¯¼è‡´å…‰æ ‡ä½ç½®ä¸å¯¹ï¼Œç”šè‡³è«åå…¶å¦™å¤šå‡ºå‰åç©ºæ ¼çš„é—®é¢˜ã€‚ä¸ºäº†ç²¾å‡†çš„å®šä½å…‰æ ‡ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œå¤„ç†å¥½è¿™äº›é—®é¢˜ã€‚</p>
<p>è¿™é‡Œè‡ªå·±ç»§æ‰¿å¹¶å®ç°äº†<code>UITextView</code>çš„å­ç±»<code>PPStickerTextView</code>ï¼Œåœ¨è¿™ä¸ªç±»ä¸­é‡è½½å¤åˆ¶ã€é»è´´ã€å‰ªåˆ‡ç­‰æ“ä½œï¼Œåˆ†åˆ«å¯¹åº”çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)cut:(id)sender;		// å‰ªåˆ‡</div><div class="line"></div><div class="line">- (void)copy:(id)sender;	// å¤åˆ¶</div><div class="line"></div><div class="line">- (void)paste:(id)sender;	// é»è´´</div></pre></td></tr></table></figure>
<p>ä¸‹é¢ä»¥å‰ªåˆ‡æ–¹æ³•ä¸¾ä¾‹ï¼Œçœ‹çœ‹æ€ä¹ˆå¤„ç†å…‰æ ‡çš„é—®é¢˜ï¼Œéœ€è¦æ³¨æ„çš„åœ°æ–¹è¯·çœ‹å¯¹åº”çš„æ³¨é‡Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (void)cut:(id)sender</div><div class="line">&#123;</div><div class="line">    // 1.ä»textViewä¸­æ‹¿åˆ°å¯¹åº”çš„çº¯æ–‡æœ¬ï¼Œæ¯”å¦‚ï¼šç¬‘æ­»äº†[ç¬‘æ­»]</div><div class="line">    NSString *string = [self.attributedText pp_plainTextForRange:self.selectedRange];</div><div class="line">    if (string.length) &#123;</div><div class="line">      	// 2. å°†çº¯æ–‡æœ¬å†™å…¥åˆ°å‰ªè´´æ¿ä¸­</div><div class="line">        [UIPasteboard generalPasteboard].string = string;</div><div class="line"></div><div class="line">      	// 3. è®°ä½å½“å‰çš„å…‰æ ‡ä½ç½®</div><div class="line">        NSRange selectedRange = self.selectedRange;</div><div class="line">        NSMutableAttributedString *attributeContent = [[NSMutableAttributedString alloc] initWithAttributedString:self.attributedText];</div><div class="line">      	// 4. å°†æ£€æµ‹åˆ°æ˜¯è¡¨æƒ…çš„æ–‡æœ¬æ›¿æ¢æˆå¯¹åº”çš„å›¾ç‰‡</div><div class="line">        [attributeContent replaceCharactersInRange:self.selectedRange withString:@&quot;&quot;];</div><div class="line">        self.attributedText = attributeContent;</div><div class="line">      </div><div class="line">      	// 5. é‡æ–°è®¾ç½®å…‰æ ‡</div><div class="line">        self.selectedRange = NSMakeRange(selectedRange.location, 0);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æŠ€æœ¯ç‚¹çš„åˆ†æå°±æ˜¯ä»¥ä¸Šè¿™äº›ï¼Œè¯¦ç»†çš„ä»£ç å¯ä»¥cloneä»£ç æŸ¥çœ‹ï¼š<a href="https://github.com/VernonVan/PPStickerKeyboard" target="_blank" rel="external">https://github.com/VernonVan/PPStickerKeyboard</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/30/2017å¹´ç»ˆæ€»ç»“/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/30/2017å¹´ç»ˆæ€»ç»“/" itemprop="url">
                  2017å¹´ç»ˆæ€»ç»“
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-30T14:13:29+08:00">
                2017-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-åˆå‰å›çš„æ—¥å¸¸/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa&åˆå‰å›çš„æ—¥å¸¸</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/30/2017å¹´ç»ˆæ€»ç»“/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/12/30/2017å¹´ç»ˆæ€»ç»“/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/12/30/2017å¹´ç»ˆæ€»ç»“/" class="leancloud_visitors" data-flag-title="2017å¹´ç»ˆæ€»ç»“">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™å‡ å¤©è¢«â€œ18å²â€ã€â€œç½‘æ˜“äº‘éŸ³ä¹å¹´åº¦å¬æ­ŒæŠ¥å‘Šâ€ã€â€œæ”¯ä»˜å®å¹´åº¦è´¦å•â€å„ç§åˆ·å±ï¼Œå¤§å®¶éƒ½ç©çš„ä¸äº¦ä¹ä¹ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯å¹´åº•äº†ï¼Œè¾›è‹¦å·¥ä½œå­¦ä¹ äº†ä¸€å¹´äº†ï¼Œä¹Ÿè¯¥æ˜¯æ—¶å€™æ”¾æ¾ä¸€ä¸‹äº†ã€‚è‡ªå·±é€šå¸¸éƒ½ä¸æ˜¯å¤ªå–œæ¬¢å‡‘çƒ­é—¹çš„ï¼Œåå®‰ä¸€éš…ï¼Œèº²åœ¨è‡ªå·±çš„å°è§’è½ï¼Œå†™ä¸‹åˆšåˆšè¿‡å»çš„2017å¹´å‘ç”Ÿçš„å¤§äº‹å°æƒ…ï¼Œé¡ºä¾¿å±•æœ›ä¸€ä¸‹æ˜å¹´ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡æç¬”å†™ä¸‹è‡ªå·±çš„å¹´ç»ˆæ€»ç»“ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±ä»¥åéƒ½èƒ½åšæŒè¿™ä»¶äº‹æƒ…ã€‚</p>
<h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>è¿‡å»çš„è¿™ä¸€å¹´ï¼Œæœ€å…ˆæƒ³è¯´çš„è¿˜æ˜¯å·¥ä½œä¸Šçš„äº‹æƒ…ï¼Œæ¯•ç«Ÿä»Šå¹´å‘Šåˆ«ç”¨äº†16å¹´çš„å­¦ç”Ÿèº«ä»½ã€‚</p>
<p>å‰åŠå¹´ä¸€ç›´æ˜¯å®ä¹ ç”Ÿèº«ä»½ï¼Œä¸Šä¸‹ç­éƒ½æ˜¯æ­¥è¡Œå›å­¦æ ¡ï¼Œå®Œå…¨æ²¡æœ‰è§‰å¾—ç”Ÿæ´»æœ‰å‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚å…¬å¸ç»™äº†å¤§é‡çš„æ—¶é—´è‡ªå·±å­¦ä¹ ä¸ç†Ÿæ‚‰æŠ€æœ¯ï¼Œæ‰€ä»¥ä¸Šç­å¹¶æ²¡æœ‰æ„Ÿåˆ°ä»€ä¹ˆå‹åŠ›ï¼Œä¸‹äº†ç­å›å»å®¿èˆï¼Œæ‰“æ‰“çƒï¼Œè¿™é‡Œæºœè¾¾æºœè¾¾ï¼Œé‚£é‡Œå¹å¹æ°´ï¼Œå¶å°”æŠ½å‡ºæ—¶é—´å¤„ç†è®ºæ–‡ã€å…¥å…šã€æ¯•ä¸šçš„äº‹å®œï¼Œä¸€åˆ‡å¦‚æ•…ã€‚</p>
<p>æ¥ä¸‹æ¥é¡ºåˆ©è½¬äº†æ­£ï¼Œåˆ°ç°åœ¨ä¹ŸåŠå¹´äº†ï¼Œè¿™åŠå¹´æ˜¯æŠ€æœ¯å¿«é€Ÿè¿›æ­¥çš„ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå¼€å§‹æ¥è§¦æ¯”è¾ƒå¤æ‚çš„éœ€æ±‚ã€‚ä»¥å‰å¸¸å¸¸èƒ½åœ¨ç¤¾åŒºçœ‹åˆ°å¤§å®¶åæ§½åšä¸šåŠ¡çš„ç¨‹åºå‘˜æ˜¯æœ€åº•å±‚çš„ï¼Œæˆ‘å€’æ˜¯ä¸è¿™ä¹ˆè®¤ä¸ºï¼Œæˆ‘è§‰å¾—å‡¡äº‹éƒ½éœ€è¦å¾ªåºæ¸è¿›ï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½ä¸€å…¥é—¨å°±ç©æ ¸å¿ƒç®—æ³•ã€æ·±åº¦å­¦ä¹ ã€åº•å±‚æ¶æ„è¿™äº›é«˜æ·±çš„ä¸œè¥¿çš„ï¼Œç›¸åï¼Œå½“å‰ä»»ä½•å…¬å¸ç»å¤§éƒ¨åˆ†çš„éƒ½æ˜¯è¿™äº›ä¸šåŠ¡éœ€æ±‚ï¼Œåšéœ€æ±‚çš„èƒ½åŠ›æ‰å®äº†ï¼Œåˆ°å“ªé‡Œéƒ½ä¸æ„æ‰¾ä¸åˆ°å·¥ä½œã€‚æ­£å¦‚æˆ‘åœ¨å…¥èŒçš„èŒä¸šè§„åˆ’ä¸Šå†™çš„ï¼šå¸Œæœ›è‡ªå·±åœ¨æœªæ¥çš„ä¸€ã€ä¸¤å¹´å†…èƒ½å°½é‡çš„åšå„ç§éœ€æ±‚ã€‚</p>
<p>ä½†æ˜¯åªåœç•™åœ¨æœ¯è€Œä¸å»é’»ç ”é“çš„è¯ï¼Œè¿™æ ·èŒä¸šç”Ÿæ¶¯ä¹Ÿä¸ä¼šå¤ªé•¿ä¹…ï¼Œè‡ªå·±ä¹Ÿåœ¨ç©ºä½™æ—¶é—´æ¥è§¦äº†ä¸€ä¸‹clang+llvmã€é€†å‘å·¥ç¨‹ç­‰æ¯”è¾ƒé«˜æ·±çš„æŠ€æœ¯ï¼Œé“©ç¾½è€Œå½’ç®—ä¸ä¸Šï¼Œåæ­£è¿˜æ²¡æœ‰ä»€ä¹ˆå®é™…äº§å‡ºï¼Œè¿˜éœ€è¦çš„å‰æœŸçŸ¥è¯†ã€é“ºå«æ¯”è¾ƒå¤šï¼Œæˆ‘ä¼šæ…¢æ…¢è¡¥ä¸Šã€‚åŒæ—¶è‡ªå·±ä¹Ÿä¸€ç›´å¯¹é‡‘èè¿™ä¸€å—æ¯”è¾ƒæœ‰å…´è¶£ï¼Œå¹³æ—¶ç»å¸¸é©»è¶³æ–°æµªè´¢ç»ã€è™å—…ç­‰å„ç§è´¢ç»ç±»çš„ç½‘ç«™ï¼Œå°¤å…¶è‡ªå·±ä¹Ÿæ˜¯ææŠ€æœ¯çš„ï¼Œäº’è”ç½‘+é‡‘èï¼Œå®Œå…¨æ˜¯ä¸€ç‰‡å¹¿é˜”çš„å¤©åœ°ã€‚</p>
<h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>ä»Šå¹´æœ€é‡è¦çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å½“ç„¶æ˜¯ï¼Œæˆ‘æ”¶è·äº†ä¸€ä¸ªå…¨ä¸–ç•Œæœ€å¯çˆ±çš„å¥³æœ‹å‹å•¦~(â‰§â–½â‰¦)/ã€‚1æœˆ10å·åˆè¯†ï¼Œ3æœˆ7å·æ­£å¼åœ¨ä¸€èµ·ï¼Œä¸çŸ¥ä¸è§‰ç«Ÿç„¶æºæ‰‹èµ°è¿‡äº†å¿«ä¸€å¹´äº†ã€‚è¿™ä¸€å¹´é‡Œï¼Œæœ‰è¿‡å¾ˆå¤šä¸ªé˜¶æ®µã€‚ä»å„è‡ªè¯•æ¢ï¼Œåˆ°äº’ç”Ÿå¥½æ„Ÿï¼Œå†åˆ°æ¯å¤©ç”œç”œè…»è…»ï¼Œå†åˆ°ç°åœ¨æ›´å¤šäº†ä¸€ä»½ç†æ€§ã€‚æœŸé—´æœ‰å› ä¸ºå°äº‹åµåµé—¹é—¹ï¼Œä¹Ÿæœ‰ä¸‰è§‚çš„æ¿€çƒˆç¢°æ’ï¼Œå¼‚åœ°æ€»æ˜¯æ¯”è¾ƒè¾›è‹¦çš„ï¼Œä½†æ˜¯èƒ½ç»å—çš„ä½å¼‚åœ°çš„è€ƒéªŒï¼Œé‚£å¾—æ¥çš„æ‰æ›´åŠ éš¾èƒ½å¯è´µã€‚</p>
<p>è¿™ä¸€å¹´ä¹Ÿæ˜¯æˆ‘çœŸæ­£ç‹¬ç«‹ç”Ÿæ´»çš„ç¬¬ä¸€å¹´ï¼Œå¾ˆåº†å¹¸è‡ªå·±è¿˜æ˜¯ä¿æŒäº†ä¸€äº›è‰¯å¥½çš„ä¹ æƒ¯ï¼Œæˆ¿é—´æ€»æ˜¯ä¼šæ‰“æ‰«æ”¶æ‹¾ï¼Œå‘¨æœ«çš„æ—¶å€™ä¼šè‡ªå·±ç…®é¥­ï¼Œå¹³æ—¶ä¼šè¿›è¡Œé˜…è¯»å­¦ä¹ ï¼Œå¶å°”è¿˜ä¼šå»è·‘æ­¥ã€‚ä¸è¿‡è·‘æ­¥è¿åŠ¨è¿™ä¸€æ®µæ—¶é—´çœŸçš„æ˜¯æ¾æ‡ˆäº†ï¼Œæ€»è§‰å¾—è·‘èµ·æ¥åŠ¨åŠ›ä¸è¶³ï¼Œæ—¶å¸¸è·‘äº†æ²¡å‡ å…¬é‡Œå°±è§‰å¾—å¤Ÿäº†ï¼Œç„¶åå°±åœä¸‹äº†è„šæ­¥ï¼Œæ–°çš„ä¸€å¹´ï¼Œè¿˜æ˜¯å¸Œæœ›è‡ªå·±èƒ½æŠŠè¿åŠ¨çš„å¥½ä¹ æƒ¯é‡æ‹¾èµ·æ¥ã€‚</p>
<h2 id="ä¸Šä¸€å¹´å®šä¸‹çš„ç›®æ ‡"><a href="#ä¸Šä¸€å¹´å®šä¸‹çš„ç›®æ ‡" class="headerlink" title="ä¸Šä¸€å¹´å®šä¸‹çš„ç›®æ ‡"></a>ä¸Šä¸€å¹´å®šä¸‹çš„ç›®æ ‡</h2><ul>
<li>å†™<strong>5</strong>ç¯‡é«˜è´¨é‡çš„æŠ€æœ¯æ–‡ç« ï¼ˆå®Œæˆåº¦60%ï¼‰ï¼šä»Šå¹´çš„äº§å‡ºåªæœ‰3ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œå®åœ¨æ˜¯å¤ªå°‘äº†ï¼Œä¹Ÿæ˜¯å› ä¸ºè‡ªå·±ä»Šå¹´æ¯”è¾ƒå¤šç§äººäº‹æƒ…ï¼Œæ˜å¹´è¿˜æ˜¯è¦æ›´å¤šçš„è¿›è¡Œäº§å‡ºã€‚ä¸è¿‡ä»Šå¹´å€’æ˜¯æ‰“ç†äº†è‡ªå·±çš„åšå®¢ã€æ˜é‡‘ã€ç®€ä¹¦ç­‰è´¦å·ï¼Œæ›´å¤šçš„å°†è‡ªå·±çš„äº§å‡ºæ”¾åˆ°ç¤¾äº¤å¹³å°ä¸Šäº’åŠ¨ï¼Œå°¤å…¶æ˜¯æ˜é‡‘ï¼Œç«Ÿç„¶å·²ç»æœ‰äº†2000ä¸ªå…³æ³¨è€…äº†ï¼Œä½†æ˜¯è‡ªå·±å¿ƒé‡Œæ¸…æ¥šç¦»å¤§ç‰›è¿˜æœ‰å¾ˆè¿œçš„è·ç¦»ï¼Œè¦å¤šå¤šåŠªåŠ›äº†ã€‚</li>
<li>å¼€å‘å¹¶ç»´æŠ¤1ä¸ªå¼€æºåº“ï¼ˆå®Œæˆï¼‰ï¼šå‘ƒã€‚ã€‚ã€‚çœ‹ç€Githubä¸Šç¨€ç¨€æ‹‰æ‹‰çš„contributionsï¼Œå®åœ¨æ‹¿ä¸å‡ºæ‰‹å•Šã€‚</li>
<li>ç¿»è¯‘5ç¯‡æŠ€æœ¯æ–‡ç«  3/5ï¼ˆå®Œæˆåº¦60%ï¼‰ï¼š<a href="https://vernonvan.github.io/2017/07/21/%E7%BF%BB%E8%AF%91%E6%9D%82%E5%BF%97%E5%BA%94%E7%94%A8/" target="_blank" rel="external">iOSçš„Core Textæ•™ç¨‹ï¼šåˆ¶ä½œä¸€ä¸ªæ‚å¿—åº”ç”¨</a>ã€iPhone X ç½‘é¡µè®¾è®¡(æ ¡å¯¹)ã€<a href="https://vernonvan.github.io/2017/10/22/%E7%BF%BB%E8%AF%91%E5%85%B3%E4%BA%8ESwift%E7%9A%84%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/" target="_blank" rel="external">å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–</a>ã€‚</li>
<li>çœ‹15æœ¬ä¹¦ï¼ˆå®Œæˆï¼‰ï¼ˆã€Šå—äº¬å¤§å± æ€ã€‹ã€ã€Šæ¿€è¡ä¸‰åå¹´ã€‹ã€ã€Šå²è’‚å¤«ä¹”å¸ƒæ–¯ä¼ ã€‹ã€ã€Šç©·æŸ¥ç†å®å…¸ã€‹ã€ã€Š100ä¸ªSwift2å¼€å‘å¿…å¤‡Tipã€‹ã€ã€Šäº®å‰‘ã€‹ã€ã€Šæ•°å­¦ä¹‹ç¾ã€‹ã€ã€Šæµªæ½®ä¹‹å·…ã€‹ã€ã€Šæ¬§ç¥æ–‡é›†01ã€‹ã€ã€ŠASOä¼˜åŒ–é“ä¸æœ¯ã€‹ã€ã€Šåœ¨ä½ èº«è¾¹ï¼Œä¸ºä½ è®¾è®¡â…¡ã€‹ã€ã€Šè…¾è®¯ä¼ ã€‹ã€ã€Šæ¬§ç¥æ–‡é›†02ã€‹ã€ã€ŠiOSåº”ç”¨é€†å‘å·¥ç¨‹ã€‹ã€ã€Šæ¬§ç¥æ–‡é›†03ã€04ã€05ã€‹ï¼‰ï¼šä»Šå¹´çš„é˜…è¯»è¿˜æ˜¯è¾¾æ ‡çš„ï¼Œæœ‰è‡ªå·±æ„Ÿå…´è¶£çš„äººç‰©ä¼ è®°ã€å†å²ç­‰æ–¹é¢çš„ä¹¦ç±ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯æŠ€æœ¯ä¹¦ç±ã€æŠ•èµ„å…¥é—¨æ–¹é¢çš„ä¸€äº›ä¹¦ã€‚</li>
<li>å¼€å§‹æ¥è§¦ç†è´¢ä¸æŠ•èµ„äº§å“</li>
</ul>
<h2 id="æˆ‘æƒ³è¦çš„2018"><a href="#æˆ‘æƒ³è¦çš„2018" class="headerlink" title="æˆ‘æƒ³è¦çš„2018"></a>æˆ‘æƒ³è¦çš„2018</h2><ul>
<li>å†™6ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œå¹¶æ›´å¤šçš„åœ¨ç¤¾åŒºä¸­äº’åŠ¨ã€‚</li>
<li>å¼€å‘ä¸€ä¸ªç‹¬ç«‹APP</li>
<li>æŠ€æœ¯æ–¹é¢è¿˜æ˜¯æ·±è€•iOSï¼šé€†å‘å·¥ç¨‹ã€å›¾åƒå¤„ç†ï¼Œæ‹“å±•æ–¹é¢çš„æ‰“ç®—å…¥é—¨ä¸€ä¸‹æœºå™¨å­¦ä¹ ã€åŒºå—é“¾çš„åŸºç¡€çŸ¥è¯†</li>
<li>çœ‹12æœ¬ä¹¦ï¼Œè€Œä¸”å¾—ä¿è¯çœ‹äº†çš„ä¹¦éƒ½å†™ä¸€ç¯‡è¯»åæ„Ÿï¼Œå¦åˆ™ä¸èƒ½ç®—ä¸Šè¿™æœ¬ä¹¦ã€‚</li>
<li>äº‰å–èƒ½åšåˆ°Githubçš„contributionsèƒ½äº®èµ·æ¥ä¸€åŠå§ã€‚ã€‚ã€‚</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/22/ç¿»è¯‘å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/22/ç¿»è¯‘å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–/" itemprop="url">
                  (ç¿»è¯‘)å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-22T21:39:50+08:00">
                2017-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/22/ç¿»è¯‘å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/22/ç¿»è¯‘å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/10/22/ç¿»è¯‘å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–/" class="leancloud_visitors" data-flag-title="(ç¿»è¯‘)å…³äºSwiftçš„ç¼–è¯‘æ—¶é—´ä¼˜åŒ–">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŸæ–‡é“¾æ¥ï¼š<a href="https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31" target="_blank" rel="external">Regarding Swift build time optimizations</a></p>
<p>ä¸Šå‘¨ï¼Œåœ¨æˆ‘è¯»å®Œ <a href="https://medium.com/@nickoneill" target="_blank" rel="external">@nickoneill</a> å†™çš„ä¸€ç¯‡ä¼˜ç§€çš„åšæ–‡<a href="https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns" target="_blank" rel="external">ã€Šä¸ºç¼“æ…¢çš„Swiftç¼–è¯‘æ—¶é—´æé€Ÿã€‹</a>åï¼Œæˆ‘å‘ç°ç”¨ä¸€ä¸ªä¸åŒçš„è§’åº¦å»å®¡è§† Swift ä»£ç å¹¶ä¸æ˜¯å¾ˆéš¾çš„ä¸€ä»¶äº‹ã€‚</p>
<p>å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç®€æ´çš„ä¸€è¡Œä»£ç ç°åœ¨å¼•å‘äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ â€“ æ˜¯å¦åº”è¯¥æŠŠè¿™è¡Œä»£ç é‡æ„æˆå¯¹åº”çš„9è¡Œä»£ç ä»¥è®©ç¼–è¯‘å™¨æ›´å®¹æ˜“å·¥ä½œï¼ˆçœ‹çœ‹æ¥ä¸‹æ¥è¦è®²çš„å…³äºç©ºåˆè¿ç®—ç¬¦(nil coalescing operator)çš„ç¤ºä¾‹ï¼‰ï¼Ÿåˆ°åº•å“ªä¸ªæ‰æ˜¯æ›´é‡è¦çš„ï¼Œç®€æ´çš„ä»£ç è¿˜æ˜¯å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç ï¼Ÿè¿™å–å†³äºé¡¹ç›®çš„å¤§å°å’Œå¼€å‘è€…çš„æƒ³æ³•ã€‚</p>
<h4 id="æ…¢ç€ã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª-Xcode-æ’ä»¶"><a href="#æ…¢ç€ã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª-Xcode-æ’ä»¶" class="headerlink" title="æ…¢ç€ã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª Xcode æ’ä»¶"></a>æ…¢ç€ã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª Xcode æ’ä»¶</h4><p>åœ¨å±•ç¤ºå…·ä½“çš„ä¾‹å­ä¹‹å‰ï¼Œæˆ‘å…ˆæƒ³åˆ°å°±æ˜¯æ‰‹åŠ¨æŸ¥çœ‹æ—¥å¿—æ˜¯ä¸€ä»¶éå¸¸è€—æ—¶çš„äº‹æƒ…ã€‚æœ‰äººæå‡ºäº†ç”¨ç»ˆç«¯å‘½ä»¤å¯ä»¥è®©è¿™ä»¶äº‹æƒ…å˜å¾—æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯æˆ‘æ›´è¿›ä¸€æ­¥ï¼ŒæŠŠè¿™ä¸ªç”¨ <a href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode" target="_blank" rel="external">Xcode æ’ä»¶</a> ç»™å®ç°å‡ºæ¥äº†ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-be809654f87b2336.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Xcodeæ’ä»¶.png"></p>
<p>å¯¹æˆ‘æ¥è¯´ï¼Œæœ€åˆçš„ç›®çš„å°±æ˜¯æ‰¾åˆ°å¹¶ä¿®å¤æœ€è€—æ—¶çš„åœ°æ–¹ï¼Œä½†æˆ‘ç°åœ¨çš„æƒ³æ³•æ˜¯è®©å®ƒç»å†æ›´å¤šçš„è¿­ä»£è¿‡ç¨‹ã€‚è¿™æ ·çš„è¯æˆ‘å°±ä¸ä»…å¯ä»¥è®©ä»£ç ç¼–è¯‘æ›´æœ‰æ•ˆç‡ï¼Œè¿˜å¯ä»¥é˜²æ­¢ç¬¬ä¸€æ¬¡è¿›å…¥é¡¹ç›®çš„è€—æ—¶ã€‚</p>
<h4 id="æ›´åŠ æƒŠå–œçš„æ˜¯"><a href="#æ›´åŠ æƒŠå–œçš„æ˜¯" class="headerlink" title="æ›´åŠ æƒŠå–œçš„æ˜¯"></a>æ›´åŠ æƒŠå–œçš„æ˜¯</h4><p>æˆ‘ç»å¸¸åœ¨å¤šä¸ª Git åˆ†æ”¯é—´è·³æ¥è·³å»ï¼Œç­‰å¾…ä¸€ä¸ªç¼“æ…¢çš„é¡¹ç›®ç¼–è¯‘å®Œæˆå¾€å¾€æµªè´¹äº†å¤§é‡çš„æ—¶é—´ã€‚æˆ‘æƒ³äº†å¥½é•¿ä¸€æ®µæ—¶é—´ä¸ºä»€ä¹ˆæˆ‘çš„ä¸€ä¸ªå® ç‰©é¡¹ç›®ä¼šç¼–è¯‘åœ°è¿™ä¹ˆç¼“æ…¢ï¼ˆå¤§æ¦‚2ä¸‡è¡Œ Swift ä»£ç ï¼‰ã€‚</p>
<p>åœ¨æˆ‘å­¦ä¹ äº†ç©¶ç«Ÿæ˜¯åŸå› å¯¼è‡´çš„è¿™ä»¶äº‹ä¹‹åï¼Œæˆ‘ä¸å¾—ä¸æ‰¿è®¤æˆ‘çš„ç¡®å¾ˆåƒæƒŠï¼Œä¸€è¡Œä»£ç å°±éœ€è¦å‡ ç§’é’Ÿæ¥ç¼–è¯‘ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å‡ ä¸ªä¾‹å­ã€‚</p>
<h4 id="ç©ºåˆæ“ä½œç¬¦"><a href="#ç©ºåˆæ“ä½œç¬¦" class="headerlink" title="ç©ºåˆæ“ä½œç¬¦"></a>ç©ºåˆæ“ä½œç¬¦</h4><p>ç¼–è¯‘å™¨æ˜¯å¾ˆä¸å–œæ¬¢è¿™é‡Œçš„ç¬¬ä¸€ç§æ–¹å¼çš„ã€‚åœ¨å±•å¼€ä¸‹é¢ä¸¤å¤„ç®€å†™çš„ä»£ç ä¹‹åï¼Œç¼–è¯‘æ—¶é—´å‡å°‘äº†99.4%ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 5238.3ms</span></div><div class="line"><span class="keyword">return</span> <span class="type">CGSize</span>(width: size.width + (rightView?.bounds.width ?? <span class="number">0</span>) + (leftView?.bounds.width ?? <span class="number">0</span>) + <span class="number">22</span>, height: bounds.height)</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 32.4ms</span></div><div class="line"><span class="keyword">var</span> padding: <span class="type">CGFloat</span> = <span class="number">22</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> rightView = rightView &#123;</div><div class="line">    padding += rightView.bounds.width</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> leftView = leftView &#123;</div><div class="line">    padding += leftView.bounds.width</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="type">CGSizeMake</span>(size.width + padding, bounds.height)</div></pre></td></tr></table></figure>
<h4 id="ArrayOfStuff-Stuff"><a href="#ArrayOfStuff-Stuff" class="headerlink" title="ArrayOfStuff + [Stuff]"></a>ArrayOfStuff + [Stuff]</h4><p>è¿™ä¸ªçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> <span class="type">ArrayOfStuff</span> + [<span class="type">Stuff</span>]</div><div class="line"><span class="comment">// è€Œä¸æ˜¯</span></div><div class="line"><span class="type">ArrayOfStuff</span>.append(stuff)</div><div class="line"><span class="keyword">return</span> <span class="type">ArrayOfStuff</span></div></pre></td></tr></table></figure>
<p>æˆ‘ç»å¸¸è¿™æ ·åšï¼Œæ¯æ¬¡éƒ½ä¼šå¯¹æ‰€éœ€çš„ç¼–è¯‘æ—¶é—´äº§ç”Ÿå½±å“ã€‚ä¸‹é¢æ˜¯æœ€å·®çš„ä¸€ä¸ªï¼Œè¿™é‡Œçš„ç¼–è¯‘æ—¶é—´å‡å°‘äº†97.9ï¼…ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 1250.3ms</span></div><div class="line"><span class="keyword">let</span> systemOptions = [ <span class="number">7</span>, <span class="number">14</span>, <span class="number">30</span>, -<span class="number">1</span> ]</div><div class="line"><span class="keyword">let</span> systemNames = (<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span>&#123; <span class="type">String</span>(format: localizedFormat, systemOptions[$<span class="number">0</span>]) &#125; + [<span class="type">NSLocalizedString</span>(<span class="string">"everything"</span>, comment: <span class="string">""</span>)]</div><div class="line"><span class="comment">// ä¸€äº›ä¸­é—´çš„ä»£ç </span></div><div class="line">labelNames = <span class="type">Array</span>(systemNames[<span class="number">0</span>..&lt;<span class="built_in">count</span>]) + [systemNames.last!]</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 25.5ms</span></div><div class="line"><span class="keyword">let</span> systemOptions = [ <span class="number">7</span>, <span class="number">14</span>, <span class="number">30</span>, -<span class="number">1</span> ]</div><div class="line"><span class="keyword">var</span> systemNames = systemOptions.<span class="built_in">dropLast</span>().<span class="built_in">map</span>&#123; <span class="type">String</span>(format: localizedFormat, $<span class="number">0</span>) &#125;</div><div class="line">systemNames.append(<span class="type">NSLocalizedString</span>(<span class="string">"everything"</span>, comment: <span class="string">""</span>))</div><div class="line"><span class="comment">// ä¸€äº›ä¸­é—´çš„ä»£ç </span></div><div class="line">labelNames = <span class="type">Array</span>(systemNames[<span class="number">0</span>..&lt;<span class="built_in">count</span>])</div><div class="line">labelNames.append(systemNames.last!)</div></pre></td></tr></table></figure>
<h4 id="ä¸‰å…ƒè¿ç®—ç¬¦"><a href="#ä¸‰å…ƒè¿ç®—ç¬¦" class="headerlink" title="ä¸‰å…ƒè¿ç®—ç¬¦"></a>ä¸‰å…ƒè¿ç®—ç¬¦</h4><p>ä»…ä»…åªæ˜¯æŠŠä¸‰å…ƒè¿ç®—ç¬¦æ›¿æ¢æˆ if-else è¯­å¥ï¼Œå°±è®©ç¼–è¯‘æ—¶é—´å‡å°‘äº†92.9%ã€‚å¦‚æœå°† map æ¢æˆ for å¾ªç¯ï¼Œå°±åˆèƒ½å‡å°‘75%ï¼ˆä½†æ˜¯é‚£æ ·çš„è¯æˆ‘çš„çœ¼ç›å¯å°±å—ä¸äº†äº†ï¼‰ã€‚ğŸ˜‰</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 239.0ms</span></div><div class="line"><span class="keyword">let</span> labelNames = type == <span class="number">0</span> ? (<span class="number">1</span>...<span class="number">5</span>).<span class="built_in">map</span>&#123;type0ToString($<span class="number">0</span>)&#125; : (<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span>&#123;type1ToString($<span class="number">0</span>)&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 16.9ms</span></div><div class="line"><span class="keyword">var</span> labelNames: [<span class="type">String</span>]</div><div class="line"><span class="keyword">if</span> type == <span class="number">0</span> &#123;</div><div class="line">    labelNames = (<span class="number">1</span>...<span class="number">5</span>).<span class="built_in">map</span>&#123;type0ToString($<span class="number">0</span>)&#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    labelNames = (<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span>&#123;type1ToString($<span class="number">0</span>)&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="è½¬æ¢-CGFloat-åˆ°-CGFloat"><a href="#è½¬æ¢-CGFloat-åˆ°-CGFloat" class="headerlink" title="è½¬æ¢ CGFloat åˆ° CGFloat"></a>è½¬æ¢ CGFloat åˆ° CGFloat</h4><p>æ²¡å¬æ‡‚æˆ‘åœ¨è¯´ä»€ä¹ˆï¼Ÿå…¶å®ä¸‹é¢ä¾‹å­ä¸­å€¼å·²ç»æ˜¯ CGFloat äº†ï¼Œå¹¶ä¸”æœ‰äº›æ‹¬å·æ˜¯å¤šä½™çš„ã€‚åœ¨æ¸…ç†å®Œè¿™äº›å†—ä½™ä¹‹åï¼Œç¼–è¯‘æ—¶é—´å‡å°‘äº†99.9%ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 3431.7 ms</span></div><div class="line"><span class="keyword">return</span> <span class="type">CGFloat</span>(<span class="type">M_PI</span>) * (<span class="type">CGFloat</span>((hour + hourDelta + <span class="type">CGFloat</span>(minute + minuteDelta) / <span class="number">60</span>) * <span class="number">5</span>) - <span class="number">15</span>) * unit / <span class="number">180</span></div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 3.0ms</span></div><div class="line"><span class="keyword">return</span> <span class="type">CGFloat</span>(<span class="type">M_PI</span>) * ((hour + hourDelta + (minute + minuteDelta) / <span class="number">60</span>) * <span class="number">5</span> - <span class="number">15</span>) * unit / <span class="number">180</span></div></pre></td></tr></table></figure>
<h4 id="Round"><a href="#Round" class="headerlink" title="Round()"></a>Round()</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ä¾‹å­ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­å˜é‡æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸å®ä¾‹å˜é‡çš„æ··åˆã€‚è¿™ä¸ªé—®é¢˜ä¼¼ä¹ä¸æ˜¯å‡ºåœ¨å››èˆäº”å…¥æœ¬èº«ï¼Œè€Œæ˜¯åœ¨äºç»“åˆä»£ç çš„æ–¹æ³•ã€‚å»æ‰å››èˆäº”å…¥çš„æ–¹æ³•å¤§æ¦‚èƒ½å‡å°‘ <strong>97.6%</strong> çš„æ„å»ºæ—¶é—´ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 1433.7ms</span></div><div class="line"><span class="keyword">let</span> expansion = a â€” b â€” <span class="built_in">c</span> + round(d * <span class="number">0.66</span>) + e</div><div class="line"><span class="comment">// ç¼–è¯‘æ—¶é—´: 34.7ms</span></div><div class="line"><span class="keyword">let</span> expansion = a â€” b â€” <span class="built_in">c</span> + d * <span class="number">0.66</span> + e</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä»¥ä¸Šæ‰€æœ‰æµ‹è¯•éƒ½åœ¨MacBool Air(13è‹±å¯¸ï¼Œ2013å¹´ä¸­)ä¸Šè¿›è¡Œã€‚</p>
<h4 id="å°è¯•ä¸€ä¸‹å§"><a href="#å°è¯•ä¸€ä¸‹å§" class="headerlink" title="å°è¯•ä¸€ä¸‹å§"></a>å°è¯•ä¸€ä¸‹å§</h4><p>ä¸ç®¡ä½ æ˜¯å¦é¢ä¸´è¿‡ç¼–è¯‘æ—¶é—´å¤ªé•¿çš„é—®é¢˜ï¼Œç¼–å†™å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æˆ‘ç¡®ä¿¡ä½ ä¼šåœ¨å…¶ä¸­æ‰¾åˆ°ä¸€äº›æƒŠå–œã€‚ä½œä¸ºå‚è€ƒï¼Œè¿™é‡Œæœ‰å®Œæ•´çš„ä»£ç ï¼Œæˆ‘çš„å·¥ç¨‹ä¸­å¯ä»¥5ç§’å†…å®Œæˆç¼–è¯‘â€¦</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMExpandingTextField</span>: <span class="title">UITextField</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">textFieldEditingChanged</span><span class="params">()</span></span> &#123;</div><div class="line">        invalidateIntrinsicContentSize()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">intrinsicContentSize</span><span class="params">()</span></span> -&gt; <span class="type">CGSize</span> &#123;</div><div class="line">        <span class="keyword">if</span> isFirstResponder(), <span class="keyword">let</span> text = text &#123;</div><div class="line">            <span class="keyword">let</span> size = text.sizeWithAttributes(typingAttributes)</div><div class="line">            <span class="keyword">return</span> <span class="type">CGSize</span>(width: size.width + (rightView?.bounds.width ?? <span class="number">0</span>) + (leftView?.bounds.width ?? <span class="number">0</span>) + <span class="number">22</span>, height: bounds.height)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.intrinsicContentSize()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/12/å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„--ç†è®ºç¯‡/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/12/å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„--ç†è®ºç¯‡/" itemprop="url">
                  å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„â€”ç†è®ºç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-12T10:26:38+08:00">
                2017-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/12/å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„--ç†è®ºç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/12/å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„--ç†è®ºç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/10/12/å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„--ç†è®ºç¯‡/" class="leancloud_visitors" data-flag-title="å“åº”å¼ç¼–ç¨‹ä¸MVVMæ¶æ„â€”ç†è®ºç¯‡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å‰æ®µæ—¶é—´ï¼Œåœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´çš„MVVMæ¶æ„ä¹‹åï¼Œæˆ‘ä»å®é™…çš„é¡¹ç›®ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå¯¹ä½¿ç”¨MVVMæ¶æ„çš„æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œäº†æ€»ç»“ï¼Œå¯¹äºæ¶æ„ã€å¯¹äºç¼–ç¨‹æ€ç»´åˆæœ‰äº†ä¸ä¸€æ ·çš„ä½“ä¼šã€‚äºæ˜¯æç¬”å†™ä¸‹è‡ªå·±æ¢ç´¢MVVMæ¶æ„çš„ç»éªŒå’Œå¿ƒå¾—ï¼Œä»¥é£¨è¯»è€…ã€‚</p>
<p>æœ¬æ–‡ä¼šå…ˆå¯¹MVCæ¶æ„åšä¸€ä¸ªå›é¡¾ï¼Œæ˜ç¡®MVCä¸­å„å±‚çš„èŒè´£ï¼›ç„¶åä¼šæå‡ºMVVMæ¶æ„çš„æ¦‚å¿µï¼Œæœ¬æ¥æ¥ä¸‹æ¥åº”è¯¥é¡ºåŠ¿ä¸¾å‡ ä¸ªMVVMçš„ä¾‹å­è¿›è¡Œè¯´æ˜çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å“åº”å¼ç¼–ç¨‹ä¹‹äºMVVMçš„é‡è¦æ€§ï¼Œæ‰€ä»¥åœ¨ä¸¾ä¾‹ä¹‹å‰ä¼šå…ˆè®²è§£ä¸€ä¸‹å“åº”å¼ç¼–ç¨‹çš„æ¦‚å¿µ(å‡ºäºç¯‡å¹…è€ƒè™‘ï¼Œå°†MVVMæ¶æ„å®è·µç‹¬ç«‹æˆä¸€ç¯‡æ–‡ç« ï¼Œæƒ³ç›´æ¥çœ‹å®ä¾‹çš„è¯·ç§»é©¾<a href="">è¿™é‡Œ</a>)ï¼›æœ€åä¼šå¯¹MVCå’ŒMVVMçš„å–èˆè°ˆè°ˆè‡ªå·±çš„çœ‹æ³•ã€‚è¯ä¸å¤šè¯´ï¼Œç°åœ¨è¿›å…¥æ­£é¢˜ã€‚</p>
<h2 id="MVCæ¶æ„"><a href="#MVCæ¶æ„" class="headerlink" title="MVCæ¶æ„"></a>MVCæ¶æ„</h2><p>MVC(Model-View-Controller)ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„å®¢æˆ·ç«¯è½¯ä»¶å¼€å‘æ¡†æ¶ï¼Œå…·ä½“åˆ°iOSä¸Šï¼Œç»å¤§éƒ¨åˆ†äººä»å¼€å§‹æ¥è§¦iOSç¼–ç¨‹çš„æ—¶å€™éƒ½è¢«å‘ŠçŸ¥MVCå°±æ˜¯äº‹å®ä¸Šçš„é»˜è®¤æ¡†æ¶ã€‚ç³»ç»Ÿä¹Ÿä¸ºæˆ‘ä»¬å®ç°å¥½äº†å…¬å…±çš„è§†å›¾ç±»ï¼šUIView å’Œæ§åˆ¶å™¨ç±»ï¼šUIViewControllerã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç»§æ‰¿è¿™äº›ç±»æ¥å®ç°æˆ‘ä»¬çš„ç¨‹åºé€»è¾‘ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å‡ ä¹é€ƒé¿ä¸å¼€MVCè¿™ç§è®¾è®¡æ¨¡å¼ã€‚ä¸‹é¢å°±å¯¹MVCå„å±‚çš„èŒè´£è¿›è¡Œæ˜ç¡®ï¼š</p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>Modelå±‚ æ˜¯æœåŠ¡ç«¯æ•°æ®åœ¨å®¢æˆ·ç«¯çš„æ˜ å°„ï¼Œæ˜¯è–„è–„çš„ä¸€å±‚ï¼Œå®Œå…¨å¯ä»¥ç”¨structè¡¨å¾ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªå®ä¾‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-39fbabcc27672a79.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Model"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒModel å±‚é€šå¸¸æ˜¯æœåŠ¡ç«¯ä¼ å›çš„ JSONæ•°æ®çš„æ˜ å°„ï¼Œå¯¹åº”ä¸ºä¸€ä¸ªä¸€ä¸ªçš„å±æ€§ã€‚ä¸è¿‡ç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šäººå°†ç½‘ç»œå±‚(Serviceå±‚)å½’åˆ°Modelä¸­ï¼Œä¹Ÿå°±æ˜¯MVC(S)æ¶æ„ã€‚åŒæ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶å€™æ•°æ®çš„æŒä¹…åŒ–æ“ä½œä¹Ÿä¼šæ”¾åœ¨Modelå±‚ä¸­ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼ŒModelå±‚çš„èŒè´£ä¸»è¦æœ‰ä»¥ä¸‹å‡ é¡¹ï¼š<strong>HTTPè¯·æ±‚ã€è¿›è¡Œå­—æ®µéªŒè¯ã€æŒä¹…åŒ–</strong>ç­‰ã€‚</p>
<h3 id="Viewå±‚"><a href="#Viewå±‚" class="headerlink" title="Viewå±‚"></a>Viewå±‚</h3><p>Viewå±‚æ˜¯å±•ç¤ºåœ¨å±å¹•ä¸Šçš„è§†å›¾çš„å°è£…ï¼Œåœ¨ iOS ä¸­ä¹Ÿå°±æ˜¯UIViewä»¥åŠUIViewçš„å­ç±»ã€‚ä¸‹é¢æ˜¯UIViewçš„ç»§æ‰¿å±‚çº§å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-075df5d6895547a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="View"></p>
<p>Viewå±‚çš„èŒè´£æ˜¯<strong>å±•ç¤ºå†…å®¹</strong>å’Œ<strong>æ¥å—ç”¨æˆ·çš„æ“ä½œä¸äº‹ä»¶</strong>ã€‚</p>
<h3 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><p>çœ‹äº†Modelå±‚å’ŒViewå±‚å¦‚æ­¤ç®€å•æ¸…æ™°çš„å®šä¹‰ï¼Œå¦‚æœä½ ä»¥ä¸ºæ¥ä¸‹æ¥è¦è®²çš„Controllerå±‚çš„å®šä¹‰ä¹Ÿè·Ÿè¿™ä¸¤å±‚ä¸€æ ·ï¼Œé‚£ä½ å°±è¦å¤±æœ›äº†ã€‚</p>
<p>ç²—ç•¥æ€»ç»“äº†ä¸€ä¸‹ï¼ŒControllerå±‚çš„èŒè´£åŒ…æ‹¬ä½†ä¸é™äºï¼š<strong>ç®¡ç†æ ¹è§†å›¾ä»¥åŠå…¶å­è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€<strong>å±•ç¤ºå†…å®¹å’Œå¸ƒå±€</strong>ã€<strong>å¤„ç†ç”¨æˆ·è¡Œä¸º</strong>(å¦‚æŒ‰é’®çš„ç‚¹å‡»å’Œæ‰‹åŠ¿çš„è§¦å‘ç­‰)ã€<strong>å‚¨å­˜å½“å‰ç•Œé¢çš„çŠ¶æ€</strong>(ä¾‹å¦‚åˆ†é¡µåŠ è½½çš„é¡µæ•°ã€æ˜¯å¦æ­£åœ¨è¿›è¡Œç½‘ç»œè¯·æ±‚çš„å¸ƒå°”å€¼ç­‰)ã€<strong>å¤„ç†ç•Œé¢çš„è·³è½¬</strong>ã€<strong>ä½œä¸ºUITableViewä»¥åŠå…¶å®ƒå®¹å™¨è§†å›¾çš„ä»£ç†ä»¥åŠæ•°æ®æº</strong>ã€<strong>ä¸šåŠ¡é€»è¾‘</strong>å’Œ<strong>å„ç§åŠ¨ç”»æ•ˆæœ</strong>ç­‰ã€‚</p>
<p>ç”»é£ä¼¼ä¹ä¸å¯¹å•Šï¼Œä¸ºä»€ä¹ˆControllerå±‚çš„èŒè´£æ¯”å…¶ä»–ä¸¤å±‚åŠ èµ·æ¥è¿˜å¤šï¼Ÿ</p>
<h3 id="MVCçš„å›°å¢ƒ"><a href="#MVCçš„å›°å¢ƒ" class="headerlink" title="MVCçš„å›°å¢ƒ"></a>MVCçš„å›°å¢ƒ</h3><p>å› ä¸ºMVCæ¶æ„ä¸­Controllerå±‚å¾€å¾€ä»£ç å¾ˆå¤šï¼ŒåŠ¨è¾„2ã€3åƒè¡Œçš„è¿™ä¸€ç‰¹ç‚¹ï¼ŒMVCä¹Ÿå¸¸å¸¸è¢«è°ƒä¾ƒæˆæ˜¯ Massive View Controllerã€‚é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯MVCçš„å®šä¹‰å¤ªè¿‡ç®€å•æœ´ç´ ï¼Œè¦çŸ¥é“æ”¯æ’‘ä¸€ä¸ªå°šä¸ç®—å¤§çš„ä¼ä¸šçº§åº”ç”¨éƒ½åŠ¨è¾„å‡ åä¸‡è¡Œä»£ç ï¼Œè¿˜ä¸åŒ…æ‹¬å„ç§ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ã€‚è¿™ä¹ˆå¤šçš„ä»£ç å¦‚ä½•å®‰ç½®ï¼ŸæŒ‰ç…§ä¼ ç»Ÿçš„MVCå®šä¹‰ï¼Œåˆ†å‰²äº†å°éƒ¨åˆ†åˆ°Modelå±‚å’ŒViewå±‚ï¼Œå‰©ä¸‹çš„ä»£ç éƒ½æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯ä»¥å»äº†ï¼Œäºæ˜¯è¢«ç»Ÿç»Ÿçš„ä¸¢åˆ°äº†Controllå±‚ä¸­ã€‚</p>
<p>åºå¤§çš„Controllerå±‚å¸¦æ¥çš„é—®é¢˜å°±æ˜¯éš¾ä»¥ç»´æŠ¤ã€éš¾ä»¥æµ‹è¯•ã€‚è€Œä¸”å…¶ä¸­å……æ–¥ç€å¤§é‡çš„çŠ¶æ€å€¼ï¼Œä¸€ä¸ªä»»åŠ¡çš„å®Œæˆä¾èµ–äºå¥½å‡ ä¸ªçŠ¶æ€å€¼ï¼Œè€Œä¸€ä¸ªçŠ¶æ€å€¼åˆåŒæ—¶å‚ä¸åˆ°å¤šä¸ªä»»åŠ¡ä¸­ï¼Œè¿™æ ·å¤æ‚çš„å¤šå¯¹å¤šå…³ç³»å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¼€å‘æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å‘¨æ—‹åœ¨å„ä¸ªçŠ¶æ€å€¼ä¹‹é—´ï¼Œå¯¹ä»¥åçš„åŠŸèƒ½æ‹“å±•ã€ä¸šåŠ¡æ·»åŠ ä¹Ÿé€ æˆäº†éšœç¢ã€‚</p>
<p>è¿™æ ·çš„å‰æä¸‹ï¼Œæ¶æ„çš„æ”¹è¿›å°±æ˜¾å¾—éå¸¸æœ‰å¿…è¦äº†ã€‚</p>
<h2 id="MVVMæ¶æ„åˆæ¢"><a href="#MVVMæ¶æ„åˆæ¢" class="headerlink" title="MVVMæ¶æ„åˆæ¢"></a>MVVMæ¶æ„åˆæ¢</h2><p>MVVM(Model-View-ViewModel)ï¼Œ2005å¹´ç”±å¾®è½¯çš„WPFå’ŒSilverlightçš„æ¶æ„å¸ˆ John Gossman æå‡ºï¼Œæ˜¯MVPæ¨¡å¼ä¸WPFç»“åˆå‘å±•æ¼”å˜è¿‡æ¥çš„ä¸€ç§æ¶æ„æ¡†æ¶ã€‚MVVMå®è´¨ä¸Šè¿˜æ˜¯MVCæ¶æ„èŒƒå›´ï¼Œæ˜¯ä¸€ä¸ªç²¾å¿ƒä¼˜åŒ–çš„MVCæ¶æ„ï¼Œæ‰€ä»¥ä¸MVCæ¶æ„æ˜¯å…¼å®¹çš„ã€‚</p>
<p>MVVMé¦–å…ˆå°†Viewå±‚å’ŒControllerå±‚è¿›è¡Œäº†åˆå¹¶ï¼Œç»Ÿç§°ä¸ºViewå±‚ï¼Œå› ä¸ºViewå±‚å’ŒControllerå±‚å¾€å¾€æ˜¯ä¸€èµ·å‡ºç°çš„ã€‚ç„¶åå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¨¡å— â€” <strong>ViewModelå±‚</strong>ï¼ŒViewModelå±‚æ‰¿è½½çš„å†…å®¹å°±æ˜¯ä¹‹å‰åœ¨Controllerå±‚ä¸­<strong>è§†å›¾å±•ç°é€»è¾‘</strong>ã€‚MVVMçš„å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-5f804627e25202e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MVVMå›¾ç¤º"></p>
<p>ä»€ä¹ˆæ˜¯è§†å›¾å±•ç°é€»è¾‘å‘¢ï¼Ÿåœ¨ä¸€æ¬¾åº”ç”¨ä¸­ï¼Œæ•°æ®çš„æ¥æºå¯èƒ½æ˜¯æœåŠ¡ç«¯è¿”å›ã€æ•°æ®åº“è·å–å’Œç”¨æˆ·è¾“å…¥ï¼Œç„¶åå­˜å‚¨åœ¨Modelä¸­ï¼Œä½†æ˜¯è¿™æ ·çš„æ•°æ®æ˜¯ä¸€ç§â€œæœªç»æ ¼å¼åŒ–çš„â€åŸå§‹æ•°æ®ï¼Œè¿˜ä¸èƒ½ç›´æ¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚æ¯”å¦‚Modelä¸­å¯èƒ½æœ‰å§“ã€åã€æ˜µç§°ç­‰å±æ€§ï¼Œåœ¨æŸäº›ç•Œé¢ä¸­éœ€è¦æ˜¾ç¤ºæˆâ€å§“åâ€çš„æ ·å¼ï¼ŒæŸäº›ç•Œé¢ä¸­æ˜¾ç¤ºæˆâ€åå§“â€çš„æ ·å¼ï¼ŒæŸäº›ç•Œé¢ä¸­æ˜¾ç¤ºâ€æ˜µç§°â€çš„æ ·å¼ã€‚è§†å›¾å±•ç°é€»è¾‘å°±æ˜¯æŠŠè¿™äº›åŸå§‹æ•°æ®ç»è¿‡ä¸šåŠ¡éœ€æ±‚å¤„ç†æˆå±•ç°åˆ°å±å¹•ä¸Šçš„æ•°æ®ã€‚å¯ä»¥æŠŠä¸€ä¸ªåº”ç”¨çœ‹æˆæ˜¯æ’­å‡ºä¸€ä¸ªæ–°é—»èŠ‚ç›®ï¼ŒModelå±‚å°±æ˜¯ä¸€å¤§å †ç¹æ‚çš„ç¨¿ä»¶ï¼ŒViewå±‚å°±æ˜¯ä¸»æŒäººå®é™…æ’­æŠ¥çš„æ–°é—»ï¼Œè€ŒViewModelå±‚å°±æ˜¯å¹•åçš„ç¼–è¾‘å¤„ç†å›¢é˜Ÿï¼Œè´Ÿè´£ä»å‡Œä¹±çš„ç¨¿ä»¶ä¸­æŠ½å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œæ•´ç†æˆæ’­æŠ¥æ—¶ç”¨çš„ç¨¿ä»¶ã€‚è¿™æ ·ä¸»æŒäººæ‹¿ç€æ•´ç†å¥½çš„ç¨¿ä»¶ï¼Œå°±èƒ½è½»æ¾çš„æ’­æŠ¥æ–°é—»äº†ã€‚</p>
<p>ä½†æ˜¯å‘¢ï¼Œå¹³ç™½æ— æ•…å¤šäº†ä¸€ä¸ªViewModelå±‚ã€‚å¤šä¸€ä¸ªå±‚å¸¦æ¥çš„ç›´æ¥é—®é¢˜å°±æ˜¯ä¿¡æ¯çš„ä¼ é€’é—®é¢˜ï¼Œå±‚ä¸å±‚ä¹‹é—´éœ€è¦äº’é€šä¿¡æ¯ï¼Œè¿›è¡Œäº¤æµã€‚åœ¨MVVMæ¶æ„çš„å®ç°ä¸­ï¼Œå¼€å‘äººå‘˜æƒ³å‡ºäº†ä¸€ä¸ªä¸ä¼ ç»Ÿæ¶ˆæ¯ä¼ é€’æ‰€ä¸ä¸€æ ·çš„æ–¹å¼ï¼Œè¿™å°±å¼•å‡ºäº†å“åº”å¼ç¼–ç¨‹çš„æ¦‚å¿µã€‚</p>
<h2 id="å“åº”å¼ç¼–ç¨‹"><a href="#å“åº”å¼ç¼–ç¨‹" class="headerlink" title="å“åº”å¼ç¼–ç¨‹"></a>å“åº”å¼ç¼–ç¨‹</h2><p>å“åº”å¼ç¼–ç¨‹(Reactive Programming)ï¼Œæ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„èŒƒå¼ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆæ–¹ä¾¿åœ°è¡¨è¾¾é™æ€æˆ–åŠ¨æ€çš„æ•°æ®æµï¼Œè€Œç›¸å…³çš„è®¡ç®—æ¨¡å‹ä¼šè‡ªåŠ¨å°†å˜åŒ–çš„å€¼é€šè¿‡æ•°æ®æµè¿›è¡Œä¼ æ’­ã€‚ä¸¾ä¸ªç»´åŸºç™¾ç§‘ä¸­çš„ä¾‹å­ï¼šc:=a+bè¡¨ç¤ºå°†è¡¨è¾¾å¼çš„ç»“æœèµ‹ç»™cï¼Œè€Œä¹‹åæ”¹å˜aæˆ–bçš„å€¼ä¸ä¼šå½±å“cã€‚ä½†åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œcçš„å€¼ä¼šéšç€aæˆ–bçš„æ›´æ–°è€Œæ›´æ–°ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-0a3c4d4e90a11372.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å“åº”å¼ç¼–ç¨‹"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸Šå›¾ä¸­cçš„å€¼æœ€åä¼šæ˜¯5</strong>ã€‚</p>
<p>åŒæ ·çš„ä¾‹å­è¿˜æœ‰Excelä¸­çš„å•å…ƒæ ¼ï¼Œå•å…ƒæ ¼å¯ä»¥åŒ…å«å­—é¢å€¼æˆ–ç±»ä¼¼â€=B1+C1â€çš„å…¬å¼ï¼Œè€ŒåŒ…å«å…¬å¼çš„å•å…ƒæ ¼çš„å€¼ä¼šä¾æ®å…¶ä»–å•å…ƒæ ¼çš„å€¼çš„å˜åŒ–è€Œå˜åŒ– ã€‚</p>
<p>å¦‚ä½•å®ç°æ‰€è°“çš„å“åº”å¼ç¼–ç¨‹ï¼Ÿåœ¨WPFä¸­å®˜æ–¹æä¾›äº†Data BindingæŠ€æœ¯ï¼ŒmacOSä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„Cocoa Bindingæ¡†æ¶ï¼Œä½†æ˜¯åœ¨iOSä¸­å®˜æ–¹æ²¡æœ‰æä¾›è¿™æ ·çš„æ¡†æ¶ã€‚äºæ˜¯GitHubä¸Šå‡ºç°äº†ReactiveCococa(ä»¥ä¸‹ç®€ç§°ä¸ºRAC)å’ŒRxSwiftç­‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚</p>
<p>åœ¨RACçš„æ€ç»´ä¸­ï¼ŒiOSä¸Šçš„ä¸€åˆ‡éƒ½æ˜¯åœ¨å˜åŒ–çš„æ•°æ®æµï¼Œæ¯”å¦‚è¾“å…¥æ¡†ä¸Šç”¨æˆ·æ­£åœ¨ä¸æ–­è¾“å…¥çš„æ–‡å­—ã€è¢«ç‚¹å‡»çš„æŒ‰é’®ã€æ—‹è½¬ç¼©æ”¾çš„è§†å›¾ã€ä¸æ–­æ”¹å˜çš„NSStringç­‰ç­‰ï¼Œè¿™äº›å°±åƒæ˜¯ä¸€ä¸ªâ€æ°´é¾™å¤´â€ï¼Œå½“æœ‰å˜åŒ–äº§ç”Ÿçš„æ—¶å€™ï¼Œæ°´é¾™å¤´å°±ä¼šå‡ºæ°´ï¼ŒæŠŠå˜åŒ–ä¼ é€’ä¸‹å»ï¼Œå¯¹è¿™ä¸ªå˜åŒ–æ„Ÿå…´è¶£çš„äººå°±å¯ä»¥åœ¨è¿™ä¸ªæ°´é¾™å¤´ä¸Šå¥—ä¸€ä¸ªâ€æ°´ç®¡â€ï¼Œè¿™ä¸ªäººå°±æˆä¸ºäº†ä¸€ä¸ªæ¥æ”¶è€…(subscriber)ï¼Œå½“æœ‰å˜åŒ–äº§ç”Ÿçš„æ—¶å€™ï¼Œæ¥æ”¶è€…å°±èƒ½ä»æ°´ç®¡ä¸­æ‹¿åˆ°è¿™ä¸ªå˜åŒ–çš„å…·ä½“ä¿¡æ¯ã€‚</p>
<p>RACå°±æä¾›äº†è¿™æ ·çš„â€æ°´ç®¡â€ï¼Œä½†æ˜¯å’Œç°å®ä¸­çš„æ°´ç®¡æœ‰æ‰€ä¸åŒï¼ŒRACæœ‰è‡ªå·±çš„ä¸€äº›é™åˆ¶ï¼šæ°´ç®¡ä¸­ä¼ é€’çš„ä¸æ˜¯æ°´ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ªçš„â€ç»ç’ƒçƒâ€ï¼Œè¿™äº›ç»ç’ƒçƒçš„ç›´å¾„å’Œæ°´ç®¡çš„å†…å¾„ä¸€æ ·å¤§ï¼Œä¿è¯äº†ç»ç’ƒçƒåœ¨æ°´ç®¡ä¸­éƒ½æ˜¯ä¾æ¬¡æ’åˆ—é€šè¿‡çš„ï¼Œè¿™å°±ä¿è¯äº†ä¸ä¼šå‡ºç°å¤šä¸ªç»ç’ƒçƒå¹¶åˆ—é€šè¿‡çš„æƒ…å†µã€‚æ›´åŠ é‡è¦çš„æ˜¯ï¼Œåœ¨æ‹¿åˆ°ç»ç’ƒçƒä¹‹å‰ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œä¸€äº›ä¸ªæ€§åŒ–çš„å®šåˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æ°´é¾™å¤´ä¸ŠåŠ ä¸€ä¸ªè¿‡æ»¤å˜´(filter)ï¼Œä¸ç¬¦åˆçš„ä¸è®©é€šè¿‡ï¼›ä¹Ÿå¯ä»¥åŠ ä¸€ä¸ªæ”¹åŠ¨è£…ç½®ï¼ŒæŠŠçƒæ”¹å˜æˆç¬¦åˆè‡ªå·±çš„éœ€æ±‚(map)ï¼›è¿˜å¯ä»¥æŠŠå¤šä¸ªæ°´é¾™å¤´åˆå¹¶æˆä¸€ä¸ªæ–°çš„æ°´é¾™å¤´(combineLatest:reduce:)ï¼Œç»è¿‡äº†è¿™äº›å®šåˆ¶ä¹‹åï¼Œå‡ºæ¥çš„ç¬¦åˆè¦æ±‚çš„ç»ç’ƒçƒå°±èƒ½æ‹¿æ¥ç›´æ¥ç”¨äº†ã€‚</p>
<p>åœ¨è¿™ä¹ˆå¼ºå¤§çš„æ¡†æ¶å¸®åŠ©ä¸‹ï¼ŒMVVMæ‰€å¼•å…¥çš„ViewModelå±‚å’Œå…¶ä»–å±‚ä¹‹é—´çš„é€šè®¯é—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚</p>
<h2 id="MVCè¿˜æ˜¯MVVMï¼Ÿ"><a href="#MVCè¿˜æ˜¯MVVMï¼Ÿ" class="headerlink" title="MVCè¿˜æ˜¯MVVMï¼Ÿ"></a>MVCè¿˜æ˜¯MVVMï¼Ÿ</h2><p>åœ¨è€ƒè™‘æ˜¯å¦è¦é€‰æ‹©MVVMæ¶æ„ä¹‹å‰ï¼Œå…ˆæ¥æ€»ç»“ä¸€ä¸‹MVVMçš„ä¼˜åŠ¿å’Œä¸è¶³ã€‚</p>
<p>MVVMä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š</p>
<ul>
<li>Controllerå±‚ç˜¦èº«ï¼šå°†è§†å›¾å±•ç°é€»è¾‘æŠ½å‡ºåˆ°ViewModelå±‚å¸¦æ¥çš„ç›´æ¥å˜åŒ–å°±æ˜¯Controllerå±‚å˜å¾—æ›´åŠ è½»é‡çº§ï¼Œæ›´åŠ å®¹æ˜“ç»´æŠ¤ã€‚</li>
<li>æ›´åŠ å®¹æ˜“æµ‹è¯•ï¼šControllerå±‚ä»£ç å‡å°‘äº†ï¼Œä¹Ÿæ„å‘³ç€å¯¹Controllerå±‚çš„æµ‹è¯•æ›´åŠ å®¹æ˜“ã€‚</li>
<li>å…¼å®¹MVCï¼šé€‰æ‹©MVVMå¹¶ä¸æ„å‘³ç€å®Œå…¨æ‘’å¼ƒMVCï¼ŒMVVMç›¸å½“äºæ˜¯MVCçš„è¶…é›†ï¼Œæ‰€ä»¥å’ŒMVCæ˜¯å…¼å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åªåœ¨æŸä¸€ä¸ªæ¨¡å—ä¸­ä½¿ç”¨MVVMï¼Œä¸ç”¨æ‹…å¿ƒè¿ç§»æ¶æ„æ—¶ä¼šé€ æˆéœ€è¦å…¨å±€é‡æ„çš„é—®é¢˜ã€‚</li>
<li>è§£å†³çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´ä¾èµ–è¿‡å¤šçš„é—®é¢˜ï¼šè¿™ä¸ªä¼˜åŠ¿æ˜¯ç”±RACæ‰€å¸¦æ¥çš„ï¼Œå“åº”å¼ç¼–ç¨‹å…³æ³¨çš„æ•°æ®çš„å˜åŒ–å’Œæµå‘ï¼Œå…é™¤äº†ä¸€éƒ¨åˆ†çš„çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥å°†å˜åŒ–ä¼ åˆ°æ˜¾ç¤ºçš„æ§ä»¶ä¸Šï¼Œ<a href="">å®ä¾‹</a>åœ¨è¿™é‡Œã€‚</li>
<li>æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼šè¿™ä¹Ÿæ˜¯ç”±RACæ‰€å¸¦æ¥çš„ï¼ŒRACå¯¹iOSç¼–ç¨‹ä¸­å¤§éƒ¨åˆ†çš„å®ç‰©è¿›è¡Œäº†æŠ½è±¡ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥å°†iOSä¸ŠKVOã€é€šçŸ¥(NSNotification)ã€å§”æ‰˜(delegate)ã€Target-Actionã€å—(Block)ç­‰æ¶ˆæ¯ä¼ é€’æ–¹å¼ç»Ÿä¸€ï¼Œ<a href="">å®ä¾‹</a>åœ¨è¿™é‡Œã€‚</li>
</ul>
<p>MVVMå­˜åœ¨çš„é—®é¢˜ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>å­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡ï¼Œé€šå¸¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“(ReactiveCocoa/RxSwift)ï¼šä½¿ç”¨MVVMé€šå¸¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œè€Œä¸”éœ€è¦è½¬æ¢æˆå“åº”å¼ç¼–ç¨‹çš„æ€ç»´æ–¹å¼ï¼Œè¿™æ˜¯éœ€è¦èŠ±è´¹ç›¸å½“çš„å­¦ä¹ é€‚åº”æ—¶é—´çš„ã€‚</li>
<li>åˆ›å»ºæ›´å¤šçš„ç±»ï¼šåŸºæœ¬ä¸Šæ¯ä¸ªControllerç±»ä¼šå¯¹åº”æœ‰ä¸€ä¸ªViewModelç±»</li>
<li>æ€§èƒ½ä¸Šæœ‰ä¸€å®šå½±å“ï¼Œè°ƒç”¨æ ˆå˜æ·±ï¼šRACçš„å®ç°åº•å±‚ä¾èµ–äºKVOï¼Œå¸¦æ¥çš„é—®é¢˜æ˜¯æ€§èƒ½çš„æŸè€—ï¼Œæ¯”å¦‚å…‰æ˜¯subscribNextå°±æ…¢äº†1ä¸ªæ•°é‡çº§ï¼Œç›®å‰çš„å›è°ƒå †æ ˆä¹Ÿæ¯”è¾ƒæ·±ï¼Œæœ€ç®€å•çš„[signal subscribeNext^(id x){}]å°±ä¼šæœ‰è¿‘40æ¬¡çš„è°ƒç”¨ã€‚</li>
</ul>
<p>MVVMå¥½å¤„ä¸å°‘ï¼Œç¼ºç‚¹ä¹Ÿä¸€å †ã€‚é‚£åˆ°åº•è¦ä¸è¦ç”¨MVVMå‘¢ï¼Ÿæˆ‘è§‰å¾—ï¼Œåœ¨é¡¹ç›®è¿˜ä¸ç®—è‡ƒè‚¿çš„æ—¶å€™ï¼Œå¯ä»¥ç®€å•çš„å¯¹ç°æœ‰çš„MVCè¿›è¡Œè§£è€¦ä¼˜åŒ–ï¼Œæ¯”å¦‚å°†ç½‘ç»œå±‚(Serviceå±‚)ã€æŒä¹…å±‚(Storageå±‚)ç­‰éƒ¨åˆ†æŠ½è±¡å‡ºæ¥å³å¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒMVVMå¯¹MVCä¹Ÿæ˜¯å…¼å®¹çš„ï¼Œå¯ä»¥è€ƒè™‘åœ¨é¡¹ç›®ä¸­çš„æŸä¸ªæ¨¡å—è¯•æ°´MVVMï¼Œè§‰å¾—å¥½å†é€æ­¥æ›¿æ¢å…¶ä»–æ¨¡å—ï¼›è€Œä¸”å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå“åº”å¼ç¼–ç¨‹è¿™æ ·ä¸€ç§èŒƒå¼ç›¸å½“çš„é”»ç‚¼æˆ‘ä»¬çš„ç¼–ç¨‹æ€ç»´ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç«™åœ¨æ•°æ®çš„å˜åŒ–å’Œæµå‘çš„è§’åº¦å»æ€è€ƒæˆ‘ä»¬çš„æ•´ä¸€ä¸ªé¡¹ç›®ï¼ŒæŒæ¡è¿™ç§æ€ç»´æ–¹å¼ä¹Ÿå¯ä»¥åå“ºåˆ°æˆ‘ä»¬é¡¹ç›®ä¸­åˆ«çš„åœ°æ–¹ã€‚</p>
<p>æ¶æ„æ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ï¼Œé€‚åˆè‡ªå·±çš„æ¶æ„å°±æ˜¯æœ€å¥½çš„æ¶æ„ï¼Œé‚£å°±è®©æˆ‘ä»¬ç†æ€§åˆ†æï¼Œæ‹¥æŠ±å˜åŒ–ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/20/iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/20/iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨/" itemprop="url">
                  iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-20T11:11:06+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/20/iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/09/20/iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/09/20/iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨/" class="leancloud_visitors" data-flag-title="iOSæ€§èƒ½ä¼˜åŒ–æ¢è®¨">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>æœ€è¿‘åœ¨å…¬å¸å†…éƒ¨åšäº†ä¸€ä¸ªåˆ†äº«ä¼šï¼Œæ¢è®¨äº†iOSæ€§èƒ½ä¼˜åŒ–çš„è¯é¢˜ï¼Œç°åœ¨å°†é‡ç‚¹çš„å†…å®¹æ•´ç†å¥½å‘å‡ºæ¥ï¼Œå„ä½å¤§ç‰›æ–§æ­£ã€‚</em></p>
<p>æœ¬æ–‡å°†ä»åŸç†å‡ºå‘ï¼Œè§£é‡Šå¡é¡¿å‘ç”Ÿçš„åŸç†ï¼Œç„¶åä¼šè®²è§£é¡¹ç›®ä¸­è¡Œä¹‹æœ‰æ•ˆçš„å‡ ä¸ªä¼˜åŒ–ç‚¹ï¼Œæœ€åä¼šå±•æœ›ä¸€ä¸‹æ¥ä¸‹æ¥å°†è¦å°è¯•çš„æ–¹å‘ã€‚ä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚</p>
<h3 id="å±å¹•æ˜¾ç¤ºçš„åŸç†"><a href="#å±å¹•æ˜¾ç¤ºçš„åŸç†" class="headerlink" title="å±å¹•æ˜¾ç¤ºçš„åŸç†"></a>å±å¹•æ˜¾ç¤ºçš„åŸç†</h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p><img src="http://upload-images.jianshu.io/upload_images/698554-f81809fe17a003e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•æ˜¾ç¤º"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¿œå¤æ—¶ä»£çš„CRTæ˜¾ç¤ºå™¨çš„æ˜¾ç¤ºåŸç†æ˜¯ç”¨ç”µå­æªæ‰«æè§å…‰å±æ¥å‘å…‰ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”µå­æªæŒ‰ç…§ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ‰«æã€‚å½“ç”µå­æªæ¢åˆ°æ–°çš„ä¸€è¡Œå‡†å¤‡è¿›è¡Œæ‰«ææ—¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾A4ã€B4ã€C4ã€D4çš„ä½ç½®ï¼Œæ˜¾ç¤ºå™¨ä¼šå‘å‡ºä¸€ä¸ªæ°´å¹³åŒæ­¥ä¿¡å·ï¼›è€Œå½“ä¸€å¸§ç”»é¢ç»˜åˆ¶å®Œæˆåï¼Œç”µå­æªå›å¤åˆ°åŸä½å‡†å¤‡ç”»ä¸‹ä¸€å¸§å‰ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾D4çš„ä½ç½®ï¼Œæ˜¾ç¤ºå™¨ä¼šå‘å‡ºä¸€ä¸ªå‚ç›´åŒæ­¥ä¿¡å·ã€‚å‚ç›´åŒæ­¥ä¿¡å·çš„ä½œç”¨ä¸€æ–¹é¢æ˜¯é€šçŸ¥æ˜¾ç¤ºå™¨å›åˆ°A1ä½ç½®ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œä¹Ÿé€šçŸ¥æ˜¾å¡ï¼Œå‡†å¤‡è¾“å‡ºä¸‹ä¸€å¸§ç”»é¢ã€‚ç°åœ¨å·²ç»æ˜¯æ¶²æ™¶æ˜¾ç¤ºå™¨çš„æ—¶ä»£äº†ï¼Œä¸å†ä½¿ç”¨ç”µå­æªæ‰«æäº†ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯ç±»ä¼¼çš„ï¼Œæ°´å¹³åŒæ­¥ä¿¡å·å’Œå‚ç›´åŒæ­¥ä¿¡å·è¿˜æ˜¯ä¸€æ ·è¢«ä½¿ç”¨çš„ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-10c8e7e137166beb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¡ç®—æœºå·¥ä½œåŸç†"></p>
<p>è®¡ç®—æœºç³»ç»Ÿçš„å·¥ä½œåŸç†å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šé¦–å…ˆæ˜¯CPUçš„å·¥ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºè§†å›¾åˆ†é…å†…å­˜ã€è®¡ç®—å¸ƒå±€ã€å›¾ç‰‡è§£ç ä»¥åŠæ–‡æœ¬ç»˜åˆ¶ç­‰ï¼›æ¥ä¸‹æ¥è½®åˆ°GPUå·¥ä½œäº†ï¼ŒGPUè´Ÿè´£è§†å›¾å˜æ¢ã€åˆæˆå’Œæ¸²æŸ“ç­‰ï¼›GPUæ¸²æŸ“å®Œæäº¤åˆ°å¸§ç¼“å†²åŒºä¸­ï¼Œç­‰æ”¶åˆ°å‚ç›´åŒæ­¥ä¿¡å·åå°†å¸§ç¼“å†²åŒºçš„å†…å®¹æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p>
<h4 id="å±å¹•æ’•è£‚-Screen-tearing"><a href="#å±å¹•æ’•è£‚-Screen-tearing" class="headerlink" title="å±å¹•æ’•è£‚(Screen tearing)"></a>å±å¹•æ’•è£‚(Screen tearing)</h4><p>ä¸Šè¿°çš„ç®€å•çš„å±å¹•æ˜¾ç¤ºåŸç†å…¶å®ä¼šäº§ç”Ÿè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå‡è®¾æˆ‘ä»¬çš„æ˜¾å¡é€Ÿåº¦å¾ˆå¿«ï¼Œæ¯ç§’ç”Ÿäº§çš„å¸§æ•°è‚¯å®šè¦è¶…è¿‡æ˜¾ç¤ºå™¨åˆ·æ–°ç‡ã€‚é‚£ä¹ˆåœ¨å®é™…æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œç¼“å†²åŒºçš„æ•°æ®ï¼Œåœ¨è¢«è¾“å‡ºä¹‹å‰ï¼Œå°±è¢«æ˜¾å¡ä¸æ–­çš„åˆ·æ–°é‡å†™ã€‚ä½†æ˜¯ç¼“å†²åŒºå¹¶ä¸æ˜¯â€œå…ˆæ¸…ç©ºå†å†™å…¥æ•°æ®â€ï¼Œè¿™å¤ªæ²¡æœ‰æ•ˆç‡ï¼Œè€Œæ˜¯é‡‡ç”¨â€œæ–°æ•°æ®è¦†ç›–è€æ•°æ®â€çš„æ–¹å¼ã€‚</p>
<p>å‡è®¾è¿™æ ·ä¸€ç§æƒ…å†µï¼Œç¼“å†²åŒºå·²ç»æœ‰ä¸€å‰¯å®Œæ•´çš„å¸§ç”»é¢ï¼ˆAå¸§ï¼‰ï¼Œç„¶åæ˜¾å¡ç”Ÿæˆäº†ä¸‹ä¸€å¸§ç”»é¢ï¼ˆBå¸§ï¼‰ï¼Œæ–°ä¸€å¸§çš„æ•°æ®å¼€å§‹å†™å…¥ç¼“å†²åŒºï¼Œå†™åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå‚ç›´åŒæ­¥ä¿¡å·æ¥äº†ï¼Œäºæ˜¯ç¼“å†²åŒºçš„æ•°æ®è¢«è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ã€‚ä½†é—®é¢˜æ˜¯ï¼Œè¿™æ—¶ç¼“å†²åŒºçš„æ•°æ®ï¼Œæ˜¯ç”±ä¸€åŠAå¸§å’Œä¸€åŠBå¸§æ•°æ®åˆæˆçš„ã€‚å› æ­¤æœ€ç»ˆæ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºå‡ºæ¥çš„ç”»é¢å°±ä¸æ˜¯ä¸€å‰¯å®Œæ•´çš„ç”»é¢ï¼Œè¿™å°±æ˜¯â€œç”»é¢æ’•è£‚â€ç°è±¡å‡ºç°çš„åŸå› ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-66bc0d60d4a305c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•æ’•è£‚"></p>
<p>é‚£æ€æ ·æ‰èƒ½è§£å†³ç”»é¢æ’•è£‚çš„é—®é¢˜å‘¢ï¼Ÿç®€å•æ¥è¯´åªè¦è®©å¸§ç¼“å†²åŒºé‡Œçš„æ•°æ®å§‹ç»ˆä¿æŒä¸€å‰¯å®Œæ•´çš„ç”»é¢å°±å¯ä»¥äº†ã€‚ä»æŠ€æœ¯è§’åº¦å‡ºå‘ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨åˆšåˆšæåˆ°çš„å‚ç›´åŒæ­¥ä¿¡å·ã€‚</p>
<p>å…·ä½“è¯´èµ·æ¥å°±æ˜¯ï¼Œå½“æ˜¾å¡ç”Ÿæˆäº†ä¸€å‰¯å®Œæ•´ç”»é¢å¹¶å†™å…¥äº†å¸§ç¼“å†²åŒºä¹‹åï¼Œæš‚åœï¼ç„¶åå¼€å§‹ç­‰å¾…å‚ç›´åŒæ­¥ä¿¡å·ï¼Œå½“å¾—åˆ°å‚ç›´åŒæ­¥ä¿¡å·åï¼Œå†ç»§ç»­æ¸²æŸ“ä¸‹ä¸€å¸§å†™å…¥ç¼“å†²åŒºã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯åœ¨ç¼“å†²åŒºçš„æ•°æ®å§‹ç»ˆæ˜¯ä¸€å‰¯å®Œæ•´çš„ç”»é¢ï¼Œä¸ä¼šå‡ºç°å‰åå¸§æ··åˆçš„é—®é¢˜ã€‚</p>
<h4 id="å¡é¡¿äº§ç”ŸåŸå› "><a href="#å¡é¡¿äº§ç”ŸåŸå› " class="headerlink" title="å¡é¡¿äº§ç”ŸåŸå› "></a>å¡é¡¿äº§ç”ŸåŸå› </h4><p>ä½†æ˜¯å‘¢ï¼Œå‚ç›´åŒæ­¥æœºåˆ¶å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ â€”â€” æ‰å¸§ã€‚æ‰€è°“çš„æ‰å¸§ï¼Œè·Ÿå‚ç›´åŒæ­¥æœ‰ä¸€å®šå…³ç³»ï¼Œå› ä¸ºå‚ç›´åŒæ­¥æœºåˆ¶å†³å®šäº†å¦‚æœåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…CPUæˆ–è€…GPUæ²¡æœ‰å®Œæˆå„è‡ªçš„ä»»åŠ¡çš„è¯ï¼Œå°±ä¼šå°†å¸§ç¼“å†²åŒºé‡Œçš„å†…å®¹ç›´æ¥ä¸¢å¼ƒï¼æ‰å¸§å¹¶ä¸èƒ½å®Œå…¨æ€ªç½ªäºå‚ç›´åŒæ­¥æœºåˆ¶ï¼Œæ›´é‡è¦çš„åŸå› æ˜¯æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…æ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„ä¼˜åŒ–ï¼Œå°†è¿‡é‡çš„ä»»åŠ¡æ´¾å‘åˆ°äº†CPUæˆ–è€…GPUä¸Šï¼Œä¸‹å›¾(fromï¼š<a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">iOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§</a>)æ˜¯æ‰å¸§çš„å›¾ç¤ºï¼Œè¡¨æ˜CPUæˆ–è€…GPUä»»æ„ä¸€ä¸ªæ²¡èƒ½åœ¨æ—¶é’Ÿå‘¨æœŸå†…å®Œæˆè‡ªå·±çš„ä»»åŠ¡çš„è¯éƒ½ä¼šå¯¼è‡´å¡é¡¿æ‰å¸§ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-75e20f80bb5101f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¡é¡¿"></p>
<h3 id="è¡Œä¹‹æœ‰æ•ˆçš„ä¼˜åŒ–ç‚¹"><a href="#è¡Œä¹‹æœ‰æ•ˆçš„ä¼˜åŒ–ç‚¹" class="headerlink" title="è¡Œä¹‹æœ‰æ•ˆçš„ä¼˜åŒ–ç‚¹"></a>è¡Œä¹‹æœ‰æ•ˆçš„ä¼˜åŒ–ç‚¹</h3><ol>
<li><h4 id="æå‰å¸ƒå±€"><a href="#æå‰å¸ƒå±€" class="headerlink" title="æå‰å¸ƒå±€"></a>æå‰å¸ƒå±€</h4><p>æå‰å¸ƒå±€å¯ä»¥è¯´æ˜¯æœ€é‡è¦çš„ä¼˜åŒ–ç‚¹äº†ã€‚å…¶å®åœ¨ä»æœåŠ¡ç«¯æ‹¿åˆ° JSON æ•°æ®çš„æ—¶å€™ï¼Œå…³äºè§†å›¾çš„å¸ƒå±€å°±å·²ç»ç¡®å®šäº†ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ§ä»¶çš„frameã€cellçš„é«˜åº¦ä»¥åŠæ–‡æœ¬æ’ç‰ˆç»“æœç­‰ç­‰ï¼Œåœ¨è¿™ä¸ªæ—¶å€™å®Œå…¨å¯ä»¥åœ¨åå°çº¿ç¨‹è®¡ç®—å¹¶å°è£…ä¸ºå¯¹åº”çš„å¸ƒå±€å¯¹è±¡XXXTableViewCellLayoutï¼Œæ¯ä¸ªcellLayoutçš„å†…å­˜å ç”¨å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥ç›´æ¥å…¨éƒ¨ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚å½“åˆ—è¡¨æ»šåŠ¨åˆ°æŸä¸ªcellçš„æ—¶å€™ï¼Œç›´æ¥æ‹¿åˆ°å¯¹åº”çš„cellLayouté…ç½®è¿™ä¸ªcellçš„å¯¹åº”å±æ€§å³å¯ã€‚å½“ç„¶ï¼Œè¯¥æœ‰çš„è®¡ç®—æ˜¯å…ä¸äº†çš„ï¼Œåªæ˜¯æå‰ç®—å¥½å¹¶ç¼“å­˜ï¼Œå…å»äº†åœ¨æ»šåŠ¨çš„æ—¶å€™è®¡ç®—å’Œé‡å¤çš„è®¡ç®—ã€‚é€šè¿‡è¿™ä¸€ä¸ªä¼˜åŒ–ï¼Œå°†æœ¬æ¥çš„fps50çš„åˆ—è¡¨ä¼˜åŒ–åˆ°äº†55ã€56å·¦å³ï¼Œå¯ä»¥è¯´ä»è‚‰çœ¼ä¸Šå·²ç»çœ‹ä¸å‡ºæœ‰å¡é¡¿æ‰å¸§äº†ã€‚</p>
<p>â€‹</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-6b21937ce6754567.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cellLayoutç¤ºä¾‹å›¾"></p>
<p>ä¸Šå›¾æ˜¯é¡¹ç›®ä¸­æŸä¸ªcellLayoutçš„éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢å­˜çš„å°±æ˜¯æ‰€æœ‰æ§ä»¶çš„frameå’Œæ–‡æœ¬çš„æ’ç‰ˆç»“æœè€Œå·²ï¼Œé‡Œé¢æ²¡æœ‰ä»»ä½•çš„é»‘ç§‘æŠ€ï¼Œåªæ˜¯å°†æœ¬æ¥åœ¨æ»šåŠ¨ä¸­æ‰åšçš„äº‹æƒ…æå‰äº†è€Œå·²ã€‚</p>
<p>â€‹</p>
</li>
<li><h4 id="æŒ‰é¡µåŠ è½½ç¼“å­˜"><a href="#æŒ‰é¡µåŠ è½½ç¼“å­˜" class="headerlink" title="æŒ‰é¡µåŠ è½½ç¼“å­˜"></a>æŒ‰é¡µåŠ è½½ç¼“å­˜</h4><ul>
<li><p>ç°çŠ¶åˆ†æï¼š90%çš„APPæœ‰tableviewï¼Œ90%çš„tableviewé‡Œæœ‰ä¸Šæ‹‰åˆ·æ–°å’Œä¸‹æ‹‰åŠ è½½ã€‚ä»¥æˆ‘å¸çš„é¡¹ç›®<strong>ZAKER</strong>ä¸­çš„çƒ­ç‚¹æ–°é—»ç•Œé¢ä¸ºä¾‹ï¼Œç®€å•æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šâ‘ åº”ç”¨å¯åŠ¨çš„æ—¶å€™ä¼šå°†ç£ç›˜ä¸­æ‰€æœ‰çš„æ–°é—»ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼› â‘¡åœ¨æ¯æ¬¡ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½çš„æ—¶å€™ä¼šå°†å†…å­˜ä¸­æ‰€æœ‰æ–°é—»ç¼“å­˜åˆ°ç£ç›˜ä¸­ï¼Œä¹Ÿå³å…¨é‡è¯»å†™ã€‚è¿™æ„å‘³ç€å¤§éƒ¨åˆ†çš„æ–°é—»æ•°æ®ä¼šåå¤å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œè¿™æ ·çš„å†™å…¥æ˜¯å†—ä½™çš„ï¼Œå› ä¸ºå‰é¢çš„è¿™äº›æ–°é—»æ•°æ®å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>â€‹</p>
</li>
<li><p>æ”¹è¿›æ–¹æ¡ˆï¼šæ‰€ä»¥ä¼˜åŒ–çš„æ–¹æ³•å°±æ˜¯å°†è¿™äº›åˆ—è¡¨æ•°ç»„è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²æˆä¸€é¡µä¸€é¡µï¼Œæ¯æ¬¡å†™å…¥çš„æ•°æ®é‡å¾ˆå°ï¼Œè€Œä¸”é¿å…äº†å†—ä½™å†™å…¥çš„é—®é¢˜ã€‚ç°åœ¨çš„æµç¨‹å˜ä¸ºï¼šâ‘ å¯åŠ¨æ—¶åªè¯»å–ç¬¬ä¸€æ‰¹æ–°é—»æ˜¾ç¤ºåœ¨å±å¹•ä¸­ï¼›â‘¡ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½çš„æ—¶å€™åªæŠŠå½“å‰æœåŠ¡å™¨è¿”å›çš„ä¸€æ‰¹æ–°é—»å†™å…¥ç¼“å­˜ä¸­ï¼›â‘¢åœ¨ä¸Šæ‹‰åŠ è½½çš„æ—¶å€™ä¼šå…ˆæŸ¥çœ‹ç£ç›˜ä¸­æ˜¯å¦æœ‰æœªè¯»çš„ç¼“å­˜ï¼Œè‹¥æœ‰åˆ™è¯»å–ç¼“å­˜ï¼Œå¦åˆ™æ‰ä»æœåŠ¡å™¨ä¸‹è½½ä¸€æ‰¹æ–°çš„æ–‡ç« ã€‚</p>
<p>â€‹</p>
</li>
<li><p>ç›´è§‚å›¾ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-ba7a27262a9e0931.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŒ‰é¡µç¼“å­˜"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¼˜åŒ–ä¹‹å‰æ•´ä¸ªæ–°é—»åˆ—è¡¨ä»¥åŠå…¶ä»–é…ç½®éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œåˆ·æ–°10å‡ æ¬¡ä¹‹åæ–‡ä»¶å¤§å°è¾¾åˆ°2MBï¼Œå¹¶ä¸”éšç€ä¸æ–­åˆ·æ–°è€Œè¶Šæ¥è¶Šå¤§ï¼›ä¼˜åŒ–ä¹‹åï¼Œå…¶ä»–çš„é…ç½®è¿˜æ˜¯åœ¨åˆšåˆšçš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ä¸æ–­å¢é•¿çš„æ–°é—»æ•°ç»„è¢«åˆ†å‰²æˆä¸€é¡µä¸€é¡µçš„æ–‡ä»¶ï¼Œæ¯ä¸€é¡µé‡Œé¢æœ‰10å¤šæ¡çš„æ–°é—»æ•°æ®ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªconfigureæ–‡ä»¶ä¿å­˜è¿™äº›é¡µçš„ä¿¡æ¯ä»¥åŠé¡µçš„é¡ºåºã€‚æ ¹æ®æµ‹è¯•äººå‘˜çš„åé¦ˆï¼Œè¿›è¡ŒæŒ‰é¡µåŠ è½½ç¼“å­˜ä¼˜åŒ–èƒ½å‡å°‘5%~8%çš„CPUå ç”¨ï¼Œä½¿ç”¨çš„å†…å­˜ä¹Ÿæœ‰ä¸€å®šçš„ä¸‹é™ã€‚è¿˜æ˜¯æœ‰å¾ˆæ˜æ˜¾çš„ä¼˜åŒ–æ•ˆæœçš„ã€‚</p>
<p>â€‹</p>
</li>
</ul>
</li>
<li><h4 id="åå°çº¿ç¨‹å¤„ç†å›¾ç‰‡"><a href="#åå°çº¿ç¨‹å¤„ç†å›¾ç‰‡" class="headerlink" title="åå°çº¿ç¨‹å¤„ç†å›¾ç‰‡"></a>åå°çº¿ç¨‹å¤„ç†å›¾ç‰‡</h4><p>åœ†å½¢å¤´åƒã€å›¾ç‰‡è£åœ†è§’ç­‰å¤„ç†å¯ä»¥è¯´æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚äº†ï¼ŒåŒ…æ‹¬ä»iOS11çš„ç³»ç»Ÿå„å¤„éƒ½èƒ½çœ‹åˆ°ï¼Œæ•´ä½“çš„é¡µé¢æ§ä»¶éƒ½å˜å¾—æ›´åŠ åœ†æ¶¦äº†ã€‚ä½†æ˜¯ï¼Œå¯¹å›¾ç‰‡å¤„ç†å¿…ç„¶æ˜¯æ¶ˆè€—èµ„æºçš„ï¼Œå®ç°è¿‡å›¾ç‰‡åœ†è§’æ•ˆæœçš„åº”è¯¥éƒ½çŸ¥é“ï¼Œæœ€ç®€å•çš„å°±æ˜¯ layer.cornerRadius+layer.masksToBounds çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§åšæ³•åœ¨tableviewä¸­å¾€å¾€ä¼šæ˜¯æ»šåŠ¨å˜å¾—å¡é¡¿ï¼Œå› ä¸ºè¿™ç§å®ç°æ–¹å¼ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼Œå±å¹•å¤–ç¼“å†²åŒºè·Ÿå½“å‰å±å¹•ç¼“å†²åŒºä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å¾ˆè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥ç¦»å±æ¸²æŸ“å¾€å¾€ä¼šé€ æˆå¡é¡¿(å‚è€ƒï¼š<a href="http://www.jianshu.com/p/6d24a4c29e18" target="_blank" rel="external">iOS ç¦»å±æ¸²æŸ“çš„ç ”ç©¶</a>)ã€‚</p>
<p>é‚£è¦æ€ä¹ˆå¤„ç†å›¾ç‰‡å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨Core Graphicsï¼ŒCoreGraphicé€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå¼‚æ­¥ç»˜åˆ¶ï¼Œæ˜¾ç¤ºçš„æ—¶å€™å†æ”¾å›ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å®ç°äº†ä¸€ä¸ªåå°å¤„ç†å›¾ç‰‡çš„æ¡†æ¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">NSBlockOperation *transformOperation = [[NSBlockOperation alloc] init];</div><div class="line">    [transformOperation addExecutionBlock:^&#123;        </div><div class="line">        // æ­¤å¤„å¤„ç†å›¾ç‰‡</div><div class="line">      	...</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">          	    // ä¸»çº¿ç¨‹è®¾ç½®å›¾ç‰‡</div><div class="line">                [self setImage:transformedImage forState:UIControlStateNormal];</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>â€‹</p>
<p>â€‹</p>
</li>
<li><h4 id="æ›´åŠ é«˜æ•ˆçš„æ§ä»¶"><a href="#æ›´åŠ é«˜æ•ˆçš„æ§ä»¶" class="headerlink" title="æ›´åŠ é«˜æ•ˆçš„æ§ä»¶"></a>æ›´åŠ é«˜æ•ˆçš„æ§ä»¶</h4><p>è¿˜å¯ä»¥ç›´æ¥ä»å¼€æºåº“ä¸­é€‰ç”¨æ›´åŠ é«˜æ•ˆçš„æ§ä»¶æ›¿æ¢é¡¹ç›®ä¸­æ€§èƒ½æ²¡é‚£ä¹ˆå¥½çš„æ§ä»¶ã€‚é¡¹ç›®ä¸­å°†ä¹‹å‰çš„TTTAttributedLabelã€M80AttributedLabelå…¨éƒ¨æ›¿æ¢ä¸ºYYLabelï¼Œå¼€å¯YYLabelçš„displaysAsynchronouslyã€ignoreCommonPropertieså±æ€§å¯ä»¥å¼‚æ­¥ç»˜åˆ¶æ–‡æœ¬ä»¥åŠå¿½ç•¥ä¸éœ€è¦çš„å±æ€§ã€‚æ›´åŠ è¿½æ±‚æ€§èƒ½çš„è¯ï¼Œå¯ä»¥ç»“åˆç¬¬1ç‚¹çš„æå‰å¸ƒå±€æœºåˆ¶ï¼Œåœ¨æå‰å¸ƒå±€çš„é˜¶æ®µç”Ÿæˆå¥½YYLabelæ¸²æŸ“æ—¶ç”¨åˆ°çš„textLayoutï¼Œæ˜¾ç¤ºçš„æ—¶å€™ç›´æ¥èµ‹å€¼textLayoutå°±å¯ä»¥äº†ã€‚</p>
<p>â€‹</p>
</li>
<li><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå¾®å°çš„ä¼˜åŒ–ï¼Œå¯¹æ€§èƒ½å¯ä»¥è¯´æ²¡æœ‰å¤šå¤§çš„å½±å“ï¼Œä½†æ˜¯å¯ä»¥åœ¨å¼€å‘é˜¶æ®µç¨åŠ ç•™æ„ï¼Œå…»æˆè‰¯å¥½çš„ä¹ æƒ¯ã€‚</p>
<ul>
<li>å°½é‡å‡å°‘è§†å›¾å±‚çº§ï¼Œåˆå¹¶å¤šä½™çš„è§†å›¾ã€‚åŒæ ·ä»¥ <strong>ZAKER</strong> ä¸ºä¾‹ï¼Œç”¨æˆ·æ˜¾ç¤ºæ—¶çš„è“Væ ‡ç­¾ã€è¾¾äººæ ‡ç­¾ä»¥åŠæ¥¼ä¸»å›¾ç‰‡ç­‰å‡ ä¸ªè§†å›¾ï¼Œä¹‹å‰æ˜¯ç”¨ä¸åŒçš„viewæ¥å±•ç¤ºçš„ï¼Œä¼˜åŒ–è¿‡ç¨‹å°†è¿™å‡ ä¸ªviewåˆå¹¶ä¸ºä¸€ä¸ªviewï¼Œä¸€ä¸ªviewç®¡ç†è¿™äº›ç›¸ä¼¼çš„äº‹ç‰©ï¼Œä¹Ÿå¯ä»¥å‡å°‘æŸäº›ç›¸åŒé€»è¾‘çš„ä»£ç ã€‚</li>
<li>å‡å°‘é¢‘ç¹çš„addSubviewã€removeSubviewï¼Œremoveä¹‹åè§†å›¾çš„å®ä¾‹å¯¹è±¡ä¼šè¢«é‡Šæ”¾ï¼Œå†addçš„æ—¶å€™ä¼šå†æ¬¡è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚å¯ä»¥ç”¨hiddenå±æ€§éšè—ä¸æ˜¾ç¤ºçš„è§†å›¾ã€‚</li>
</ul>
</li>
</ol>
<h3 id="æ¥ä¸‹æ¥çš„æ–¹å‘"><a href="#æ¥ä¸‹æ¥çš„æ–¹å‘" class="headerlink" title="æ¥ä¸‹æ¥çš„æ–¹å‘"></a>æ¥ä¸‹æ¥çš„æ–¹å‘</h3><ol>
<li><h4 id="å¼‚æ­¥ç»˜åˆ¶"><a href="#å¼‚æ­¥ç»˜åˆ¶" class="headerlink" title="å¼‚æ­¥ç»˜åˆ¶"></a>å¼‚æ­¥ç»˜åˆ¶</h4><p>ä»å¼€å§‹æ¥è§¦æˆ‘ä»¬å°±ä¸€ç›´åœ¨è¢«å‘ŠçŸ¥ï¼ŒUIKitçš„ä¸œè¥¿æ˜¯ç»å¯¹ä¸èƒ½åœ¨åå°çº¿ç¨‹è°ƒç”¨çš„ï¼Œä¸€å®šå¾—åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹ä¹Ÿè¢«å«åšUIçº¿ç¨‹ã€‚åœ¨åå°çº¿ç¨‹è°ƒç”¨UIKitçš„ä¸œè¥¿æœ‰ä¸€å®šå‡ ç‡å¯¼è‡´å´©æºƒï¼Œæˆ–è€…å‡ºç°è§†å›¾ä¸æ˜¾ç¤ºã€æ˜¾ç¤ºé”™ä¹±ç­‰ç­‰é—®é¢˜ã€‚ä½†æ˜¯å‘¢ï¼Œæ ¹æ®åˆšåˆšæ‰€è¯´çš„ï¼ŒCore Graphicsçš„é‚£ä¸€å¥—ä¸œè¥¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡Core Graphicsåœ¨åå°å°†è§†å›¾æ¸²æŸ“åˆ°ä¸€å¼ å›¾ç‰‡ä¸Šï¼Œæ˜¾ç¤ºçš„æ—¶å€™åœ¨ä¸»çº¿ç¨‹å°†è¿™å¼ å›¾ç‰‡è®¾ç½®åˆ°ç›¸åº”ä½ç½®ä¸Šã€‚Facebookè‘—åçš„AsyncDisplayKitçš„æ ¸å¿ƒå®ç°åº”è¯¥ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªåŸç†ï¼Œæ¥ä¸‹æ¥çš„ä¼˜åŒ–å¯ä»¥å°è¯•è¿™ä¸ªæ–¹æ¡ˆã€‚</p>
<p>â€‹</p>
</li>
<li><h4 id="Metal"><a href="#Metal" class="headerlink" title="Metal"></a>Metal</h4><p>æ ¹æ®Appleå®˜æ–¹è¯´æ³•ï¼ŒMetalæ¡†æ¶è¢«è®¾è®¡ç”¨æ¥å®ç°ä¸¤ä¸ªç›®æ ‡: 3D å›¾å½¢æ¸²æŸ“å’Œå¹¶è¡Œè®¡ç®—ã€‚è¿™ä¸¤è€…æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚å®ƒä»¬éƒ½åœ¨æ•°é‡åºå¤§çš„æ•°æ®ä¸Šå¹¶è¡Œè¿è¡Œç‰¹æ®Šçš„ä»£ç ï¼Œå¹¶å¯ä»¥åœ¨GPUä¸Šæ‰§è¡Œã€‚ç›®å‰æ­£åœ¨ç ”ç©¶å­¦ä¹ é˜¶æ®µï¼Œçœ‹é¡¹ç›®ä¸­æ˜¯å¦èƒ½åˆ©ç”¨Metalè¿›è¡Œä¸€å®šçš„ä¼˜åŒ–ã€‚</p>
<p>â€‹</p>
</li>
<li><h4 id="APM"><a href="#APM" class="headerlink" title="APM??"></a>APM??</h4><p>Application Performance Management(APM)ï¼šåº”ç”¨ç¨‹åºæ€§èƒ½ç®¡ç†ï¼Œ é€šè¿‡å¯¹åº”ç”¨çš„å¯é æ€§ã€ç¨³å®šæ€§ç­‰æ–¹é¢çš„ç›‘æ§ï¼Œè¿›è€Œè¾¾åˆ°å¯ä»¥å¿«é€Ÿä¿®å¤é—®é¢˜ã€æé«˜ç”¨æˆ·ä½“éªŒçš„ç›®çš„ã€‚ç›®å‰æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ APM äº§å“æœ‰ï¼šå¬äº‘ã€é˜¿é‡Œç™¾å·ã€è…¾è®¯buglyç­‰ï¼Œç°åœ¨ä¹Ÿåœ¨è€ƒè™‘è‡ªå·±ç ”å‘ä¸€å¥—APMç³»ç»Ÿï¼Œå…ˆä»æ¯”è¾ƒç®€å•çš„æŒ‡æ ‡å…¥æ‰‹ï¼Œå…ˆå¯¹å¡é¡¿å’Œå´©æºƒè¿™ä¸¤ä¸ªæŒ‡æ ‡ç€æ‰‹ï¼Œåšçš„é¡ºåˆ©çš„è¯å†é€æ­¥æ‰©å±•åˆ«çš„æŒ‡æ ‡çš„æ£€æµ‹ç®¡ç†ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸Šã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/21/ç¿»è¯‘æ‚å¿—åº”ç”¨/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/21/ç¿»è¯‘æ‚å¿—åº”ç”¨/" itemprop="url">
                  (ç¿»è¯‘)iOSçš„Core Textæ•™ç¨‹ï¼šåˆ¶ä½œä¸€ä¸ªæ‚å¿—åº”ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-21T10:46:34+08:00">
                2017-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-æŠ€æœ¯è´´/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa--æŠ€æœ¯è´´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/21/ç¿»è¯‘æ‚å¿—åº”ç”¨/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/21/ç¿»è¯‘æ‚å¿—åº”ç”¨/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/07/21/ç¿»è¯‘æ‚å¿—åº”ç”¨/" class="leancloud_visitors" data-flag-title="(ç¿»è¯‘)iOSçš„Core Textæ•™ç¨‹ï¼šåˆ¶ä½œä¸€ä¸ªæ‚å¿—åº”ç”¨">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.raywenderlich.com/153591/core-text-tutorial-ios-making-magazine-app" target="_blank" rel="external">https://www.raywenderlich.com/153591/core-text-tutorial-ios-making-magazine-app</a>  </p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-57c6d4f3c2df1c38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‚å¿—ï¼ŒCore Textå’Œå¤§è„‘ï¼"><br>æ›´æ–°è¯´æ˜ï¼šæœ¬æ•™ç¨‹å·²ç»ç”±Lyndsey Scottå‡çº§ä¸ºSwift 4å’ŒXcode 9ã€‚æœ€åˆçš„æ•™ç¨‹ç”±Marin Todorovæ‰€åˆ›ä½œã€‚</p>
<p>Core Textæ˜¯ä¸€ä¸ªåº•å±‚çš„æ–‡æœ¬å¼•æ“ï¼Œå½“ä¸Core Graphics/Quartzæ¡†æ¶é…åˆä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹å¸ƒå±€å’Œæ ¼å¼è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p>
<p>éšç€iOS 7çš„å‘å¸ƒï¼ŒAppleå…¬å¸å‘å¸ƒäº†ä¸€ä¸ªåå«Text Kitçš„é«˜çº§åº“ï¼Œå¯ä»¥ç”¨æ¥å‚¨å­˜ã€å¸ƒå±€å’Œæ˜¾ç¤ºå…·æœ‰å„ç§æ’ç‰ˆç‰¹å¾çš„æ–‡æœ¬ã€‚è™½ç„¶Text Kitåœ¨å¸ƒå±€æ–‡æœ¬æ—¶ä¸ä»…å¼ºå¤§è€Œä¸”å¤§éƒ¨åˆ†æƒ…å†µä¸‹å·²ç»è¶³å¤Ÿç”¨äº†ï¼Œä½†æ˜¯Core Textå¯ä»¥æä¾›æ›´å¤šçš„æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ç›´æ¥ä½¿ç”¨Quartzçš„è¯ï¼Œé‚£å°±è¯·ç”¨Core Textå§ã€‚å¦‚æœä½ éœ€è¦æ„å»ºä½ è‡ªå·±çš„å¸ƒå±€å¼•æ“çš„è¯ï¼ŒCore Textå°†ä¼šå¸®åŠ©ä½ ç”Ÿæˆ<a href="https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/CoreText_Programming/Introduction/Introduction.html#//apple_ref/doc/uid/TP40005533" target="_blank" rel="external">å­—å½¢(glyphs)å¹¶ä¸”æ ¹æ®äº’ç›¸ä¹‹é—´çš„å…³ç³»æ‘†æ”¾å¥½è¿™äº›å­—å½¢ï¼Œå¹¶å…·æœ‰å¥½çš„æ’ç‰ˆçš„æ‰€æœ‰ç‰¹æ€§</a>ã€‚</p>
<p>æœ¬æ•™ç¨‹å°†ä¼šå¼•å¯¼ä½ ä½¿ç”¨Core Textå»åˆ›ä½œä¸€æœ¬éå¸¸ç®€å•çš„æ‚å¿—åº”ç”¨â€¦ç»™åƒµå°¸çœ‹çš„ï¼<br>å‘ƒï¼Œåƒµå°¸æœˆåˆŠçš„è¯»è€…æœ‹å‹ä»¬å·²ç»å®½å®¹çš„ç­”åº”äº†ï¼Œåªè¦ä½ æœ¬æ•™ç¨‹è®¤çœŸä½¿ç”¨Core Textçš„è¯ï¼Œå°±ä¸ä¼šåƒæ‰ä½ çš„å¤§è„‘äº†â€¦æ‰€ä»¥å‘¢ï¼Œä½ è¿˜æ˜¯å°½å¿«å¼€å§‹å§ï¼</p>
<blockquote>
<p>è¯´æ˜ï¼šè¦å……åˆ†è¯»æ‡‚æœ¬æ•™ç¨‹ï¼Œä½ é¦–å…ˆéœ€è¦äº†è§£iOSå¼€å‘çš„åŸºç¡€ã€‚å¦‚æœä½ æ˜¯iOSå¼€å‘çš„æ–°äººçš„è¯ï¼Œä½ åº”è¯¥é¦–å…ˆæŸ¥çœ‹æœ¬ç½‘ç«™çš„<a href="https://www.raywenderlich.com/category/ios" target="_blank" rel="external">å…¶ä»–æ•™ç¨‹</a>ã€‚</p>
</blockquote>
<h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><p>æ‰“å¼€Xcodeï¼Œç”¨Single View Applicationæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„Swift universal projectï¼Œå‘½åä¸ºCoreTextMagazineã€‚</p>
<p>ç„¶åï¼Œå°†Core Textæ¡†æ¶åŠ åˆ°ä½ çš„å·¥ç¨‹ä¸­ï¼š</p>
<ol>
<li>å•å‡»å·¥ç¨‹å¯¼èˆªå™¨ä¸­çš„å·¥ç¨‹æ–‡ä»¶(åœ¨å·¦è¾¹çš„å¯¼èˆªæ¡ä¸Š)</li>
<li>åœ¨â€Generalâ€æŒ‰é’®ä¸‹ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨çš„â€Linked Frameworks and Librariesâ€</li>
<li>å•å‡»â€+â€æŒ‰é’®ç„¶åæ‰¾åˆ°â€CoreTextâ€</li>
<li>é€‰ä¸­â€CoreText.frameworkâ€ç„¶åç‚¹å‡»â€Addâ€æŒ‰é’®ã€‚å°±è¿™ä¹ˆç®€å•ï¼</li>
</ol>
<p>ç°åœ¨å·¥ç¨‹å·²ç»é…ç½®å¥½äº†ï¼Œæ˜¯æ—¶å€™å¼€å§‹å†™ä»£ç äº†ã€‚</p>
<h3 id="æ·»åŠ ä¸€ä¸ªCore-Text-View"><a href="#æ·»åŠ ä¸€ä¸ªCore-Text-View" class="headerlink" title="æ·»åŠ ä¸€ä¸ªCore Text View"></a>æ·»åŠ ä¸€ä¸ªCore Text View</h3><p>é¦–å…ˆï¼Œä½ å°†è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„UIViewï¼Œåœ¨è¿™ä¸ªUIViewçš„draw(_:)æ–¹æ³•ä¸­å°†ä¼šç”¨åˆ°Core Textã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç»§æ‰¿äºUIViewçš„Cocoa Touch Class fileï¼Œå‘½åä¸ºCTViewã€‚æ‰“å¼€CTView.swiftï¼Œç„¶ååœ¨ <figure class="highlight plain"><figcaption><span>UIKit ``` è¯­å¥ä¸‹é¢åŠ ä¸Šä¸‹é¢çš„ä»£ç ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">import CoreText</div></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œå°†è¿™ä¸ªè‡ªå®šä¹‰çš„viewè®¾ç½®ä¸ºåº”ç”¨çš„ä¸»è§†å›¾ã€‚æ‰“å¼€Main.storyboardï¼Œåœ¨å³è¾¹æ‰“å¼€Utilitiesèœå•ï¼Œç„¶ååœ¨é¡¶éƒ¨å·¥å…·æ¡å•å‡»Identity Inspectorå›¾æ ‡ã€‚åœ¨Interface Builderçš„å·¦ä¾§èœå•ä¸­ï¼Œé€‰ä¸­Viewã€‚ç°åœ¨åœ¨Utilitiesèœå•çš„Classå­—æ®µä¸­åº”è¯¥å†™ç€UIViewã€‚åœ¨Classå­—æ®µè¾“å…¥CTViewä»¥å­ç±»åŒ–ä¸»è§†å›¾æ§åˆ¶å™¨çš„è§†å›¾ï¼Œç„¶åç‚¹å‡»å›è½¦é”®ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-e426ca1cea702142.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ä¸‹æ¥ï¼Œæ‰“å¼€CTView.swiftå¹¶å°†è¢«æ³¨é‡Šæ‰çš„draw(_:)æ–¹æ³•å…¨éƒ½æ›¿æ¢æˆä¸‹é¢çš„ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//1	 	 </div><div class="line">override func draw(_ rect: CGRect) &#123;	 	 </div><div class="line">  // 2	 	 </div><div class="line">  guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;	 	 </div><div class="line">  // 3	 	 </div><div class="line">  let path = CGMutablePath()	 	 </div><div class="line">  path.addRect(bounds)	 	 </div><div class="line">  // 4</div><div class="line">  let attrString = NSAttributedString(string: &quot;Hello World&quot;)</div><div class="line">  // 5</div><div class="line">  let framesetter = CTFramesetterCreateWithAttributedString(attrString as CFAttributedString)</div><div class="line">  // 6</div><div class="line">  let frame = CTFramesetterCreateFrame(framesetter, CFRangeMake(0, attrString.length), path, nil) </div><div class="line">  // 7</div><div class="line">  CTFrameDraw(frame, context)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°åˆ†æä¸€ä¸‹ä»£ç ï¼š</p>
<ol>
<li>åœ¨è§†å›¾åˆ›å»ºçš„æ—¶å€™ï¼Œdraw(_:)ä¼šè‡ªåŠ¨è¿è¡Œï¼Œæ¸²æŸ“è¿™ä¸ªè§†å›¾çš„èƒŒæ™¯å›¾å±‚ã€‚</li>
<li>æ‰“å¼€ç”¨äºç»˜åˆ¶çš„å½“å‰å›¾å½¢ä¸Šä¸‹æ–‡ã€‚</li>
<li>åˆ›å»ºä¸€æ¡ç”¨æ¥é™å®šç»˜å›¾åŒºåŸŸçš„è·¯å¾„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯æ•´ä¸ªè§†å›¾çš„boundsã€‚</li>
<li>åœ¨Core Textï¼Œä½¿ç”¨NSAttributedStringè€Œä¸æ˜¯Stringæˆ–è€…NSStringï¼Œä¿å­˜æ–‡æœ¬å’Œå±æ€§(attributes)ã€‚åˆå§‹åŒ–ä¸€ä¸ªâ€Hello Worldâ€çš„å±æ€§å­—ç¬¦ä¸²ã€‚</li>
<li>CTFramesetterCreateWithAttributedStringä½¿ç”¨æä¾›çš„å±æ€§å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªCTFramesetterã€‚CTFramesetterä¼šç®¡ç†ä½ å¼•ç”¨çš„å­—ä½“å’Œç»˜å›¾åŒºåŸŸã€‚</li>
<li>é€šè¿‡ä½¿CTFramesetterCreateFrameåœ¨è·¯å¾„å†…æ¸²æŸ“æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªCTFrameã€‚</li>
<li>CTFrameDrawåœ¨ç»™å®šçš„ä¸Šä¸‹æ–‡ä¸­ç»˜åˆ¶CTFrameã€‚<br>è¿™å°±æ˜¯ä½ ç»˜åˆ¶ç®€å•æ–‡æœ¬æ‰€éœ€è¦åšçš„å…¨éƒ¨äº†ï¼Buildï¼Œè¿è¡Œç„¶åæŸ¥çœ‹ç»“æœã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-bdfec1f8b8817617.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
</ol>
<p>å™¢ä¸â€¦ä¼¼ä¹çœ‹èµ·æ¥ä¸å¤ªå¯¹ã€‚å°±åƒå¾ˆå¤šçš„åº•å±‚APIä¸€æ ·ï¼ŒCore Textä½¿ç”¨çš„æ˜¯Y-flippedåæ ‡ç³»ç»Ÿã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå†…å®¹åœ¨ç«–ç›´æ–¹å‘ä¸Šä¹Ÿç¿»è½¬äº†ï¼</p>
<p>æ·»åŠ ä»¥ä¸‹ä»£ç åˆ°<figure class="highlight plain"><figcaption><span>let context ```è¯­å¥ä»¥ä¿®æ­£å†…å®¹çš„æ–¹å‘ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">// Flip the coordinate system</div><div class="line">context.textMatrix = .identity</div><div class="line">context.translateBy(x: 0, y: bounds.size.height)</div><div class="line">context.scaleBy(x: 1.0, y: -1.0)</div></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç é€šè¿‡åº”ç”¨å˜æ¢(transformation)åˆ°è§†å›¾çš„ä¸Šä¸‹æ–‡æ¥å°†å†…å®¹ç¿»è½¬ã€‚</p>
<p>Buildç„¶åè¿è¡Œappã€‚åˆ«æ‹…å¿ƒçŠ¶æ€æ é‡å çš„é—®é¢˜ï¼Œä½ æ¥ä¸‹æ¥ä¼šå­¦åˆ°æ€æ ·é€šè¿‡çº¦æŸè§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-5febf55f8e6bc993.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç¥è´ºä½ çš„ç¬¬ä¸€ä¸ªCore Textè½¯ä»¶ï¼åƒµå°¸ä»¬å¾ˆé«˜å…´çœ‹åˆ°ä½ çš„è¿›æ­¥ã€‚</p>
<h3 id="Core-Textå¯¹è±¡æ¨¡å‹"><a href="#Core-Textå¯¹è±¡æ¨¡å‹" class="headerlink" title="Core Textå¯¹è±¡æ¨¡å‹"></a>Core Textå¯¹è±¡æ¨¡å‹</h3><p>å¦‚æœä½ å¯¹CTFramesetterå’ŒCTFrameæ„Ÿåˆ°æœ‰ç‚¹ç–‘æƒ‘ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œä¹Ÿæ˜¯æ—¶å€™è¯´æ˜ä¸€ä¸‹å®ƒä»¬äº†ã€‚:]<br>Core Textå¯¹è±¡æ¨¡å‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-e7418de12cb5ae45.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“ä½ æä¾›ä¸€ä¸ªNSAttributedStringåˆ›å»ºä¸€ä¸ªCTFramesetterå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œä¸€ä¸ªCTTypesetterçš„å®ä¾‹å¯¹è±¡ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºç”¨ä»¥ç®¡ç†ä½ çš„å­—ä½“ã€‚æ¥ä¸‹æ¥ä½ ä¼šåœ¨æ¸²æŸ“æ–‡æœ¬çš„æ—¶å€™ç”¨åˆ°è¿™ä¸ªCTFramesetterå»åˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ªframeã€‚</p>
<p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªframeï¼Œä½ å¯ä»¥ä¸ºè¿™ä¸ªframeæä¾›æ–‡æœ¬çš„ä¸€ä¸ªsubrangeå»æ¸²æŸ“è¿™æ®µæ–‡æœ¬ã€‚Core Textä¼šè‡ªåŠ¨ä¸ºæ–‡æœ¬çš„æ¯ä¸€è¡Œåˆ›å»ºä¸€ä¸ªCTLineï¼Œå¹¶ä¸ºæ¯ä¸ªå…·æœ‰ç›¸åŒæ ¼å¼çš„å­—ç¬¦åˆ›å»ºä¸€ä¸ªCTRunã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒCore Textåªä¼šåˆ›å»ºä¸€ä¸ªCTRunç”¨äºåŒä¸€è¡Œä¸­çš„å‡ ä¸ªçº¢è‰²çš„å•è¯ï¼Œåˆ›å»ºä¸€ä¸ªCTRunç”¨äºæ¥ä¸‹æ¥çš„çº¯æ–‡æœ¬ï¼Œåˆ›å»ºä¸€ä¸ªCTRunç”¨äºç²—ä½“æ®µè½ç­‰ç­‰ã€‚Core Textåˆ›å»ºä¼šæ ¹æ®ä½ æä¾›çš„NSAttributedStringä¸­çš„å±æ€§åˆ›å»ºCTRunã€‚æ­¤å¤–ï¼Œä¸Šé¢è¯´åˆ°çš„æ¯ä¸€ä¸ªCTRunå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨ä¸åŒçš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶å­—è·ã€è¿å­—ã€å®½åº¦ã€é«˜åº¦ç­‰ã€‚</p>
<h3 id="æ·±å…¥æ‚å¿—Appï¼"><a href="#æ·±å…¥æ‚å¿—Appï¼" class="headerlink" title="æ·±å…¥æ‚å¿—Appï¼"></a>æ·±å…¥æ‚å¿—Appï¼</h3><p>ä¸‹è½½å¹¶è§£å‹<a href="http://www.raywenderlich.com/downloads/zombieMagMaterials.zip" target="_blank" rel="external">the zombie magazine materials</a>ã€‚æ‹–æ‹½è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹åˆ°ä½ çš„Xcodeå·¥ç¨‹ä¸­ã€‚å½“å¼¹å‡ºå¯¹è¯æ¡†æ—¶ï¼Œç¡®ä¿Copy items if neededå’ŒCreate groupsé€‰ä¸­ã€‚</p>
<p>ä¸ºäº†åˆ›å»ºè¿™ä¸ªappï¼Œä½ éœ€è¦å¯¹æ–‡æœ¬åº”ç”¨å„ç§å±æ€§ã€‚ä½ å°†è¦åˆ›å»ºä¸€ä¸ªç”¨æ ‡ç­¾è®¾ç½®æ‚å¿—æ ¼å¼çš„ç®€å•æ–‡æœ¬æ ‡è®°è§£æå™¨ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„Cocoa Touch Class fileï¼Œå‘½åä¸ºMarkupParserï¼Œç»§æ‰¿äºNSObjectã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹zombies.txtã€‚çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åœ¨æ•´ä¸ªæ–‡æœ¬ä¸­åŒ…å«æ‹¬å·å†…çš„æ ¼å¼åŒ–æ ‡ç­¾çš„ã€‚â€img srcâ€æ ‡ç­¾æŒ‡å‘æ‚å¿—çš„å›¾ç‰‡ï¼Œè€Œâ€font color/faceâ€æ ‡ç­¾åˆ™ç¡®å®šäº†æ–‡æœ¬çš„é¢œè‰²å’Œå­—ä½“ã€‚</p>
<p>æ‰“å¼€MarkupParser.swiftç„¶åå°†å®ƒçš„å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import CoreText</div><div class="line"></div><div class="line">class MarkupParser: NSObject &#123;</div><div class="line">  </div><div class="line">  // MARK: - Properties</div><div class="line">  var color: UIColor = .black</div><div class="line">  var fontName: String = &quot;Arial&quot;</div><div class="line">  var attrString: NSMutableAttributedString!</div><div class="line">  var images: [[String: Any]] = []</div><div class="line"></div><div class="line">  // MARK: - Initializers</div><div class="line">  override init() &#123;</div><div class="line">    super.init()</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  // MARK: - Internal</div><div class="line">  func parseMarkup(_ markup: String) &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä½ åœ¨è¿™æ®µä»£ç ä¸­æ·»åŠ äº†å±æ€§æŒæœ‰å­—ä½“å’Œæ–‡æœ¬é¢œè‰²ï¼Œè®¾ç½®äº†å®ƒä»¬çš„åˆå§‹å€¼ã€‚åˆ›å»ºäº†ä¸€ä¸ªå˜é‡å»æŒæœ‰parseMarkup(_:)ç”Ÿæˆçš„å±æ€§å­—ç¬¦ä¸²ã€‚è¿˜åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ç”¨æ¥æŒæœ‰å®šä¹‰äº†å°ºå¯¸ã€ä½ç½®ä»¥åŠä»æ–‡æœ¬ä¸­è§£æå‡ºæ¥çš„å›¾ç‰‡æ–‡ä»¶åç­‰ä¿¡æ¯çš„é”®å€¼å¯¹ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œå†™ä¸€ä¸ªè§£æå™¨å¹¶ä¸æ˜¯ä¸€ä¸ªè½»æ¾çš„å·¥ä½œï¼Œä½†æ˜¯æœ¬æ•™ç¨‹æ‰€å®ç°çš„è§£æå™¨å°†ä¼šéå¸¸ç®€æ˜“ï¼Œåªæä¾›å¼€æ”¾æ ‡ç­¾çš„æ”¯æŒï¼Œä¹Ÿå°±æ„å‘³ç€ä¸€ä¸ªæ ‡ç­¾ä¼šå†³å®šç´§éšç€è¿™ä¸ªæ ‡ç­¾çš„æ–‡æœ¬çš„æ ·å¼ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ–°çš„æ ‡ç­¾ã€‚è¿™æ®µæ–‡æœ¬çš„æ ‡è®°å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">These are &lt;font color=&quot;red&quot;&gt;red&lt;font color=&quot;black&quot;&gt; and</div><div class="line">&lt;font color=&quot;blue&quot;&gt;blue &lt;font color=&quot;black&quot;&gt;words.</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-6d55091e685937d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å°†ä»¥ä¸‹ä»£ç åŠ åˆ° <figure class="highlight plain"><figcaption><span>``` æ–¹æ³•ä¸­ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">//1</div><div class="line">attrString = NSMutableAttributedString(string: &quot;&quot;)</div><div class="line">//2 </div><div class="line">do &#123;</div><div class="line">  let regex = try NSRegularExpression(pattern: &quot;(.*?)(&lt;[^&gt;]+&gt;|\\Z)&quot;,</div><div class="line">                                      options: [.caseInsensitive,</div><div class="line">                                                .dotMatchesLineSeparators])</div><div class="line">  //3</div><div class="line">  let chunks = regex.matches(in: markup, </div><div class="line">                             options: NSRegularExpression.MatchingOptions(rawValue: 0), </div><div class="line">                             range: NSRange(location: 0,</div><div class="line">                                            length: markup.characters.count))</div><div class="line">&#125; catch _ &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>attrStringåˆå§‹ä¸ºç©ºï¼Œä½†æ˜¯æœ€åä¼šåŒ…å«è§£æå‡ºæ¥çš„æ ‡è®°ã€‚</li>
<li>è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…äº†ç´§è·Ÿç€è¿™äº›æ ‡ç­¾çš„æ–‡æœ¬å—ã€‚å®ƒå°±å¥½åƒåœ¨è¯´ï¼šâ€œå»æŸ¥çœ‹å­—ç¬¦ä¸²ç›´åˆ°ä½ æ‰¾åˆ°ä¸€ä¸ªå¼€å¤´çš„æ‹¬å·ï¼Œç„¶åæŸ¥çœ‹å­—ç¬¦ä¸²ç›´åˆ°ä½ æ‰¾åˆ°ä¸€ä¸ªç»“æŸçš„æ‹¬å·ï¼ˆæˆ–è€…æ–‡æ¡£çš„æœ«å°¾ï¼‰â€ã€‚</li>
<li>æœç´¢regexåŒ¹é…åˆ°çš„æ•´ä¸ªæ ‡è®°èŒƒå›´ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªNSTextCheckingResultçš„æ•°ç»„ã€‚</li>
</ol>
<blockquote>
<p>æƒ³è¦å­¦ä¹ æ›´å¤šæœ‰å…³æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹ï¼Œè®¿é—®<a href="https://www.raywenderlich.com/86205/nsregularexpression-swift-tutorial" target="_blank" rel="external">NSRegularExpression Tutorial</a>å§ã€‚</p>
</blockquote>
<p>ç°åœ¨ä½ å·²ç»è§£æäº†æ‰€æœ‰çš„æ–‡æœ¬å¹¶å°†æ‰€æœ‰æ ¼å¼åŒ–çš„æ ‡ç­¾éƒ½æ”¾è¿›äº†chunksä¸­ï¼Œä½ è¦åšçš„å°±æ˜¯éå†chunksæ•°ç»„å»ç”Ÿæˆå¯¹åº”çš„å±æ€§å­—ç¬¦ä¸²ã€‚</p>
<p>ä½†åœ¨é‚£ä¹‹å‰ï¼Œä½ æ˜¯å¦ç•™æ„åˆ°matches(in:options:range:)æ–¹æ³•æ˜¯å¦‚ä½•æ¥å—ä¸€ä¸ªNSRangeä½œä¸ºå‚æ•°çš„å—ï¼Ÿåœ¨ä½ åº”ç”¨NSRegularExpressionåˆ°ä½ çš„æ ‡è®°Stringçš„æ—¶å€™ä¼šæœ‰å¤§é‡NSRangeåˆ°Rangeçš„è½¬åŒ–ã€‚Swiftå·²ç»æˆä¸ºäº†æˆ‘ä»¬æ‰€æœ‰äººçš„å¥½å¸®æ‰‹ï¼Œæ‰€ä»¥å®ƒå€¼å¾—å¸®åŠ©ã€‚</p>
<p>è¿˜æ˜¯åœ¨MarkupParser.swiftä¸­ï¼Œå°†ä¸‹é¢çš„extensionåŠ åˆ°æ–‡ä»¶çš„æœ€åé¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// MARK: - String</div><div class="line">extension String &#123;</div><div class="line">  func range(from range: NSRange) -&gt; Range&lt;String.Index&gt;? &#123;</div><div class="line">    guard let from16 = utf16.index(utf16.startIndex,</div><div class="line">                                   offsetBy: range.location,</div><div class="line">                                   limitedBy: utf16.endIndex),</div><div class="line">      let to16 = utf16.index(from16, offsetBy: range.length, limitedBy: utf16.endIndex),</div><div class="line">      let from = String.Index(from16, within: self),</div><div class="line">      let to = String.Index(to16, within: self) else &#123;</div><div class="line">        return nil</div><div class="line">   &#125;</div><div class="line"></div><div class="line">    return from ..&lt; to</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢è¿™ä¸ªå‡½æ•°å°†ä»¥NSRangeè¡¨ç¤ºçš„å­—ç¬¦ä¸²çš„èµ·æ­¢ç´¢å¼•è½¬æ¢ä¸ºäº†String.UTF16View.Indexæ ¼å¼ï¼Œå³UTF-16å­—ç¬¦ä¸²ä¸­çš„ä½ç½®(position)é›†åˆï¼Œç„¶åå°†æ¯ä¸ªString.UTF16View.Indexæ ¼å¼è½¬æ¢ä¸ºString.Indexæ ¼å¼ã€‚String.Indexæ ¼å¼åœ¨ç»„åˆæ—¶ï¼Œä¼šç”ŸæˆSwiftçš„èŒƒå›´æ ¼å¼ï¼šRangeã€‚åªè¦ç´¢å¼•æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¿”å›åŸå§‹NSRangeæ ¼å¼å¯¹åº”çš„Rangeæ ¼å¼ã€‚</p>
<p>ç°åœ¨æ˜¯æ—¶å€™å›å¤´å¤„ç†æ–‡æœ¬å’Œæ ‡ç­¾æ•°ç»„äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-2c69a03c16835494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨parseMarkup(_:)å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸‹ä»£ç åˆ° <figure class="highlight plain"><figcaption><span>chunks ``` åˆ°ä¸‹é¢(åœ¨doå¾ªç¯è¯­å¥å—ä¸­)ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">let defaultFont: UIFont = .systemFont(ofSize: UIScreen.main.bounds.size.height / 40)</div><div class="line">//1</div><div class="line">for chunk in chunks &#123;  </div><div class="line">  //2</div><div class="line">  guard let markupRange = markup.range(from: chunk.range) else &#123; continue &#125;</div><div class="line">  //3    </div><div class="line">  let parts = markup.substring(with: markupRange).components(separatedBy: &quot;&lt;&quot;)</div><div class="line">  //4</div><div class="line">  let font = UIFont(name: fontName, size: UIScreen.main.bounds.size.height / 40) ?? defaultFont       </div><div class="line">  //5</div><div class="line">  let attrs = [NSAttributedStringKey.foregroundColor: color, NSAttributedStringKey.font: font] as [NSAttributedStringKey : Any]</div><div class="line">  let text = NSMutableAttributedString(string: parts[0], attributes: attrs)</div><div class="line">  attrString.append(text)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>å¾ªç¯chunksæ•°ç»„ã€‚</li>
<li>è·å–å½“å‰NSTextCheckingResultçš„rangeï¼Œå±•å¼€Range<string.index>å¹¶ä¸”åªè¦rangeå­˜åœ¨å°±ç»§ç»­æ‰§è¡Œä»¥ä¸‹çš„è¯­å¥å—ã€‚</string.index></li>
<li>å°†chunkç”¨â€&lt;â€åˆ†å‰²æˆå‡ éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†åŒ…å«äº†æ‚å¿—çš„æ–‡æœ¬è€Œç¬¬äºŒéƒ¨åˆ†åŒ…å«äº†å¯¹åº”çš„æ ‡ç­¾(å¦‚æœæ ‡ç­¾å­˜åœ¨çš„è¯)ã€‚</li>
<li>ç”¨fontNameç”Ÿæˆå­—ä½“ï¼Œç°åœ¨çš„é»˜è®¤å­—ä½“æ˜¯â€Arialâ€ï¼Œå¹¶ä¸”æ ¹æ®è®¾å¤‡å±å¹•åˆ›å»ºäº†å­—ä½“çš„å¤§å°ã€‚å‡å¦‚fontNameä¸èƒ½äº§ç”Ÿæœ‰æ•ˆçš„UIFontçš„è¯ï¼Œå°†é»˜è®¤å­—ä½“è®¾ä¸ºå½“å‰å­—ä½“ã€‚</li>
<li>åˆ›å»ºå­—ä½“æ ¼å¼çš„å­—å…¸ï¼Œå°†å…¶åº”ç”¨äºparts[0]ä»¥åˆ›å»ºå±æ€§å­—ç¬¦ä¸²ï¼Œç„¶åå°†è¯¥å­—ç¬¦ä¸²æ·»åŠ åˆ°ç»“æœå­—ç¬¦ä¸²åé¢ã€‚</li>
</ol>
<p>å°†ä¸‹é¢ç”¨æ¥å¤„ç†â€fontâ€æ ‡ç­¾çš„ä»£ç æ’åˆ°attrString.append(text)ä¸‹é¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">// 1</div><div class="line">if parts.count &lt;= 1 &#123;</div><div class="line">  continue</div><div class="line">&#125;</div><div class="line">let tag = parts[1]</div><div class="line">//2</div><div class="line">if tag.hasPrefix(&quot;font&quot;) &#123;</div><div class="line">  let colorRegex = try NSRegularExpression(pattern: &quot;(?&lt;=color=\&quot;)\\w+&quot;, </div><div class="line">                                           options: NSRegularExpression.Options(rawValue: 0))</div><div class="line">  colorRegex.enumerateMatches(in: tag, </div><div class="line">    options: NSRegularExpression.MatchingOptions(rawValue: 0), </div><div class="line">    range: NSMakeRange(0, tag.characters.count)) &#123; (match, _, _) in</div><div class="line">      //3</div><div class="line">      if let match = match,</div><div class="line">        let range = tag.range(from: match.range) &#123;</div><div class="line">          let colorSel = NSSelectorFromString(tag.substring(with:range) + &quot;Color&quot;)</div><div class="line">          color = UIColor.perform(colorSel).takeRetainedValue() as? UIColor ?? .black</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  //5    </div><div class="line">  let faceRegex = try NSRegularExpression(pattern: &quot;(?&lt;=face=\&quot;)[^\&quot;]+&quot;,</div><div class="line">                                          options: NSRegularExpression.Options(rawValue: 0))</div><div class="line">  faceRegex.enumerateMatches(in: tag, </div><div class="line">    options: NSRegularExpression.MatchingOptions(rawValue: 0), </div><div class="line">    range: NSMakeRange(0, tag.characters.count)) &#123; (match, _, _) in</div><div class="line"></div><div class="line">      if let match = match,</div><div class="line">        let range = tag.range(from: match.range) &#123;</div><div class="line">          fontName = tag.substring(with: range)</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">&#125; //end of font parsing</div></pre></td></tr></table></figure></p>
<ol>
<li>å¦‚æœpartsæ•°ç»„å…ƒç´ å°‘äº2ä¸ªï¼Œåˆ™è·³è¿‡è¿™ä¸ªå¾ªç¯è¯­å¥å—ã€‚å¦åˆ™çš„è¯ï¼Œå°†partsçš„ç¬¬äºŒéƒ¨åˆ†å­˜ä¸ºtagã€‚</li>
<li>å¦‚æœtagä»¥â€fontâ€å¼€å§‹åˆ™åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…å­—ä½“çš„â€colorâ€å€¼ï¼Œç„¶åç”¨è¿™ä¸ªæ­£åˆ™å»æšä¸¾åŒ¹é…åˆ°çš„tagä¸­çš„â€colorâ€å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªåº”è¯¥æœ‰ä¸€ä¸ªåŒ¹é…åˆ°çš„é¢œè‰²å€¼ã€‚</li>
<li>å¦‚æœenumerateMatches(in:options:range:using:)å‡½æ•°è¿”å›æ ‡ç­¾çš„ä¸€ä¸ªæœ‰æ•ˆçš„matchå’Œä¸€ä¸ªæœ‰æ•ˆçš„rangeçš„è¯ï¼Œå°±å»æœç´¢å‡ºæŒ‡ç¤ºå€¼ï¼Œæ¥ç€ç”¨è¿™ä¸ªé¢œè‰²å€¼ç”Ÿæˆä¸€ä¸ªUIColorçš„selectorã€‚æ‰§è¡Œè¿™ä¸ªselectoræ‰€è¿”å›å¾—åˆ°çš„color(å¦‚æœå­˜åœ¨çš„è¯)ä¼šèµ‹å€¼åˆ°ä½ çš„ç±»çš„colorå±æ€§ä¸Šï¼Œå¦‚æœè¿”å›çš„colorä¸å­˜åœ¨çš„è¯ï¼Œcolorå±æ€§ä¼šè¢«èµ‹å€¼ä¸ºblackã€‚</li>
<li>åŒæ ·çš„ï¼Œåˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å»å¤„ç†æ–‡æœ¬ä¸­å­—ä½“çš„â€faceâ€å€¼ã€‚å¦‚æœåŒ¹é…åˆ°ä¸€ä¸ªâ€faceâ€å€¼ï¼Œåˆ™å°†ç±»çš„fontNameå±æ€§è®¾ç½®ä¸ºåŒ¹é…çš„â€faceâ€å€¼ã€‚</li>
</ol>
<p>å¹²å¾—æ¼‚äº®ï¼ç°åœ¨parseMarkup(_:)å‡½æ•°å·²ç»å¯ä»¥è·å–æ–‡æœ¬ä¸­çš„æ ‡è®°å¹¶ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„NSAttributedStringäº†ã€‚</p>
<p>ç°åœ¨ä¹Ÿæ˜¯æ—¶å€™æŠŠä½ çš„appå–‚ç»™ä¸€äº›åƒµå°¸äº†ï¼æˆ‘çš„æ„æ€æ˜¯ï¼Œå–‚ä¸€äº›åƒµå°¸ç»™ä½ çš„appâ€¦ ä¹Ÿå°±æ˜¯è¯´ï¼Œ(å¼€å§‹å¤„ç†)zombies.txtã€‚</p>
<p>äº‹å®ä¸Šï¼Œæ˜¾ç¤ºå‡ºè¢«èµ‹äºˆçš„å†…å®¹æ‰æ˜¯UIViewçš„èŒè´£æ‰€åœ¨ï¼Œè€Œä¸æ˜¯å»åŠ è½½å†…å®¹ã€‚æ‰“å¼€CTView.swiftç„¶åå°†ä¸‹é¢ä»£ç æ·»åŠ åˆ°draw(_:)æ–¹æ³•ä¹‹å‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// MARK: - Properties</div><div class="line">var attrString: NSAttributedString!</div><div class="line"></div><div class="line">// MARK: - Internal</div><div class="line">func importAttrString(_ attrString: NSAttributedString) &#123;</div><div class="line">  self.attrString = attrString</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œå°† <figure class="highlight plain"><figcaption><span>attrString = NSAttributedString(string: "Hello World") ``` ä»draw(_:)å‡½æ•°ä¸­åˆ é™¤ã€‚</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">è¿™æ®µä»£ç ä¸­ä½ åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹å˜é‡æŒæœ‰å±æ€§å­—ç¬¦ä¸²å’Œä¸€ä¸ªå‡½æ•°ä»¥ä¾¿appçš„å…¶ä»–åœ°æ–¹å¯ä»¥è®¾ç½®è¿™ä¸ªå±æ€§å­—ç¬¦ä¸²ã€‚</div><div class="line"></div><div class="line">ç„¶åï¼Œæ‰“å¼€ViewController.swiftå¹¶å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°viewDidLoad()ä¸­ï¼š</div><div class="line">```Objective-C</div><div class="line">// 1</div><div class="line">guard let file = Bundle.main.path(forResource: &quot;zombies&quot;, ofType: &quot;txt&quot;) else &#123; return &#125;</div><div class="line">  </div><div class="line">do &#123;</div><div class="line">  let text = try String(contentsOfFile: file, encoding: .utf8)</div><div class="line">  // 2</div><div class="line">  let parser = MarkupParser()</div><div class="line">  parser.parseMarkup(text)</div><div class="line">  (view as? CTView)?.importAttrString(parser.attrString)</div><div class="line">&#125; catch _ &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶åä¸€æ­¥æ­¥çš„è¿‡ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p>
<ol>
<li>ä»zombie.txtæ–‡ä»¶ä¸­åŠ è½½æ–‡æœ¬ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„è§£æå™¨ï¼Œä¼ å…¥æ–‡æœ¬ä½œä¸ºå‚æ•°ï¼Œç„¶åå°†è¿”å›çš„å±æ€§å­—ç¬¦ä¸²èµ‹ç»™ViewControllerçš„CTViewã€‚</li>
</ol>
<p>Buildå¹¶ä¸”è¿è¡Œè¿™ä¸ªappï¼<br><img src="http://upload-images.jianshu.io/upload_images/698554-a816139b2aed7b2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>ç®€ç›´å¤ªæ£’äº†ï¼å½’åŠŸäºè¿™50å¤šè¡Œè§£æä»£ç ä½ å¯ä»¥è½»æ¾çš„ç”¨æ–‡æœ¬æ–‡ä»¶æŒæœ‰ä½ æ‚å¿—appçš„å†…å®¹äº†ã€‚</p>
<h3 id="åŸºæœ¬çš„æ‚å¿—å¸ƒå±€"><a href="#åŸºæœ¬çš„æ‚å¿—å¸ƒå±€" class="headerlink" title="åŸºæœ¬çš„æ‚å¿—å¸ƒå±€"></a>åŸºæœ¬çš„æ‚å¿—å¸ƒå±€</h3><p>å¦‚æœä½ è®¤ä¸ºåƒµå°¸æ–°é—»çš„æ¯æœˆæ‚å¿—åªèƒ½å…¨å¡åœ¨ä¸€ä¸ªå¯æ€œçš„é¡µé¢ä¸­ï¼Œé‚£ä¹ˆä½ å°±é”™äº†ï¼å¹¸è¿çš„æ˜¯ï¼ŒCore Textåœ¨æ–‡æœ¬åˆ—å¸ƒå±€æ—¶ç›¸å½“æœ‰ç”¨ï¼Œå› ä¸ºCTFrameGetVisibleStringRangeå¯ä»¥å‘Šè¯‰ç»™å®šframeçš„æƒ…å†µä¸‹æ˜¾ç¤ºå¤šå°‘æ–‡æœ¬æ‰æ˜¯åˆé€‚çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€åˆ—æ–‡æœ¬ï¼Œå½“è¿™ä¸€åˆ—å¡æ»¡æ–‡æœ¬ä¹‹åï¼Œä½ å¯ä»¥çŸ¥é“å¹¶å¼€å§‹æ–°çš„ä¸€åˆ—ã€‚</p>
<p>å°±æœ¬appè€Œè¨€ï¼Œä½ éœ€è¦å…ˆæ‰“å°å‡ºåˆ—ï¼Œç„¶åé›†åˆ—æˆé¡µï¼Œå†é›†é¡µæˆæ–‡ã€‚æœªå…å†’çŠ¯è¿™äº›äº¡çµï¼Œæ‰€ä»¥ã€‚ã€‚ã€‚ä½ è¿˜æ˜¯å°½å¿«æŠŠæŠŠä½ çš„CTViewæ”¹æˆç»§æ‰¿äºUIScrollViewã€‚<br>æ‰“å¼€CTView.swiftç„¶åå°† <figure class="highlight plain"><figcaption><span>CTView ``` ä¸€è¡Œæ”¹æˆä»¥ä¸‹ä»£ç ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">class CTView: UIScrollView &#123;</div></pre></td></tr></table></figure></p>
<p>çœ‹åˆ°äº†å—ï¼Œåƒµå°¸è€çˆ·ï¼Ÿç°åœ¨è¿™ä¸ªappå·²ç»æ”¯æŒæ°¸æ’ä¸æ­»äº†ï¼å¯¹çš„ï¼Œè¡Œã€æ»šåŠ¨ä»¥åŠç¿»é¡µç°åœ¨éƒ½æ˜¯å¯ç”¨çš„äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-f7c0cd8d0f47a219.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œä½ å·²ç»åœ¨draw(_:)æ–¹æ³•é‡Œåˆ›å»ºäº†framesetterå’Œframeäº†ï¼Œä¸è¿‡ç”±äºä½ æœ‰å¾ˆå¤šä¸åŒæ ¼å¼çš„æ–‡æœ¬åˆ—ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹è¡¨å¾æ‰€è¿°çš„æ–‡æœ¬åˆ—ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºCTColumnViewçš„Cocoa Touch Class fileï¼Œç»§æ‰¿äºUIViewã€‚<br>æ‰“å¼€CTColumnView.swiftå¹¶æ·»åŠ ä¸‹åˆ—åˆå§‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import CoreText</div><div class="line"></div><div class="line">class CTColumnView: UIView &#123;</div><div class="line">  </div><div class="line">  // MARK: - Properties</div><div class="line">  var ctFrame: CTFrame!</div><div class="line">  </div><div class="line">  // MARK: - Initializers</div><div class="line">  required init(coder aDecoder: NSCoder) &#123;</div><div class="line">    super.init(coder: aDecoder)!</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  required init(frame: CGRect, ctframe: CTFrame) &#123;</div><div class="line">    super.init(frame: frame)</div><div class="line">    self.ctFrame = ctframe</div><div class="line">    backgroundColor = .white</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  // MARK: - Life Cycle</div><div class="line">  override func draw(_ rect: CGRect) &#123;</div><div class="line">    guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;</div><div class="line">      </div><div class="line">    context.textMatrix = .identity</div><div class="line">    context.translateBy(x: 0, y: bounds.size.height)</div><div class="line">    context.scaleBy(x: 1.0, y: -1.0)</div><div class="line">      </div><div class="line">    CTFrameDraw(ctFrame, context)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è·Ÿå¼€å§‹åœ¨CTViewé‡Œåšçš„å·¥ä½œä¸€æ ·ï¼Œè¿™æ®µä»£ç ç”Ÿæˆäº†ä¸€ä¸ªCTFrameã€‚è‡ªå®šä¹‰çš„åˆå§‹åŒ–å‡½æ•°init(frame:ctframe:)è®¾ç½®äº†ï¼š</p>
<ol>
<li>è¿™ä¸ªè§†å›¾çš„frameã€‚</li>
<li>åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ç»˜åˆ¶çš„CTFrameã€‚</li>
<li>ä»¥åŠå°†è¿™ä¸ªè§†å›¾çš„èƒŒæ™¯é¢œè‰²è®¾ç½®ä¸ºç™½è‰²ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„swiftæ–‡ä»¶å‘½åä¸ºCTSettings.swiftï¼Œç”¨æ¥æŒæœ‰ä½ çš„æ–‡æœ¬åˆ—çš„è®¾ç½®ã€‚<br>å°†CTSettings.swiftçš„å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import Foundation</div><div class="line"></div><div class="line">class CTSettings &#123;</div><div class="line">  //1</div><div class="line">  // MARK: - Properties</div><div class="line">  let margin: CGFloat = 20</div><div class="line">  var columnsPerPage: CGFloat!</div><div class="line">  var pageRect: CGRect!</div><div class="line">  var columnRect: CGRect!</div><div class="line">  </div><div class="line">  // MARK: - Initializers</div><div class="line">  init() &#123;</div><div class="line">    //2</div><div class="line">    columnsPerPage = UIDevice.current.userInterfaceIdiom == .phone ? 1 : 2</div><div class="line">    //3</div><div class="line">    pageRect = UIScreen.main.bounds.insetBy(dx: margin, dy: margin)</div><div class="line">    //4</div><div class="line">    columnRect = CGRect(x: 0,</div><div class="line">                        y: 0,</div><div class="line">                        width: pageRect.width / columnsPerPage,</div><div class="line">                        height: pageRect.height).insetBy(dx: margin, dy: margin)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>è¿™äº›å±æ€§å°†ç”¨æ¥ç¡®å®špageçš„çº¦æŸ(åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­çº¦æŸé»˜è®¤æ˜¯20)ã€åœ¨æ¯ä¸€ä¸ªé¡µä¸­æ–‡æœ¬åˆ—çš„æ•°é‡ã€åŒ…å«æ–‡æœ¬åˆ—çš„æ¯ä¸€é¡µçš„frameä»¥åŠæ¯ä¸€é¡µä¸­çš„æ¯ä¸€ä¸ªæ–‡æœ¬åˆ—çš„frameã€‚</li>
<li>ç”±äºè¿™æœ¬æ‚å¿—çš„æœåŠ¡å¯¹è±¡æ˜¯æ‹¿ç€iPhoneå’ŒiPadçš„åƒµå°¸ä»¬ï¼ŒiPadä¸Šæ˜¾ç¤ºä¸¤åˆ—ï¼ŒiPhoneä¸Šæ˜¾ç¤ºä¸€åˆ—ï¼Œè¿™æ ·çš„åˆ—æ•°å¯¹äºä»»æ„çš„å±å¹•å°ºå¯¸æ¥è¯´éƒ½æ˜¯é€‚å®œçš„ã€‚</li>
<li>ç”¨çº¦æŸçš„å¤§å°è®¡ç®—å‡ºæ¥çš„pageRectå»å¸ƒå±€é¡µé¢çš„è¾¹ç•Œã€‚</li>
<li>ç”¨æ¯ä¸€é¡µçš„æ–‡æœ¬åˆ—æ•°é‡åˆ’åˆ†pageRectçš„å®½åº¦å¹¶é…åˆçº¦æŸå»è®¡ç®—å‡ºcolumnRectã€‚</li>
</ol>
<p>æ‰“å¼€CTView.swiftï¼Œå°†æ–‡ä»¶ä¸­çš„å†…å®¹æ•´ä¸ªæ›¿æ¢æˆä¸‹åˆ—ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import CoreText</div><div class="line"></div><div class="line">class CTView: UIScrollView &#123;</div><div class="line"></div><div class="line">  //1</div><div class="line">  func buildFrames(withAttrString attrString: NSAttributedString,</div><div class="line">                   andImages images: [[String: Any]]) &#123;</div><div class="line">    //2</div><div class="line">    isPagingEnabled = true</div><div class="line">    //3</div><div class="line">    let framesetter = CTFramesetterCreateWithAttributedString(attrString as CFAttributedString)</div><div class="line">    //4</div><div class="line">    var pageView = UIView()</div><div class="line">    var textPos = 0</div><div class="line">    var columnIndex: CGFloat = 0</div><div class="line">    var pageIndex: CGFloat = 0</div><div class="line">    let settings = CTSettings()</div><div class="line">    //5</div><div class="line">    while textPos &lt; attrString.length &#123;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>buildFrames(withAttrString:andImages:)å‡½æ•°ä¼šåˆ›å»ºå¹¶æ·»åŠ CTColumnViewåˆ°æ»šåŠ¨è§†å›¾ã€‚</li>
<li>è¿è¡Œæ»šåŠ¨è§†å›¾çš„ç¿»é¡µè¡Œä¸ºï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ä¸ç®¡ä»€ä¹ˆæ—¶å€™åœæ­¢æ»šåŠ¨ï¼Œæ»šåŠ¨è§†å›¾éƒ½èƒ½å¡åˆ°ä½ç½®ä½¿å¾—åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢åœ¨æ˜¾ç¤ºã€‚</li>
<li>CTFramesetter framesetterä¼šä¸ºåˆ›å»ºçš„æ¯ä¸€åˆ—CTFrameæä¾›å±æ€§å­—ç¬¦ä¸²ã€‚</li>
<li>UIView pageViewä¼šä½œä¸ºæ¯ä¸ªé¡µé¢æ–‡æœ¬åˆ—å¯¹åº”çš„å­è§†å›¾çš„å®¹å™¨ï¼›textPosä¼šæŒç»­è·Ÿè¸ªæ¥ä¸‹æ¥çš„æ–‡å­—ï¼›columnIndexä¼šæŒç»­è·Ÿè¸ªå½“å‰åˆ—ï¼›pageIndexä¼šæŒç»­è·Ÿè¸ªå½“å‰é¡µï¼›åŒæ—¶settingsèƒ½è®©ä½ è®¿é—®appçš„çº¦æŸå°ºå¯¸ã€æ¯é¡µçš„åˆ—ã€é¡µçš„frameå’Œåˆ—frameçš„è®¾ç½®ç­‰ã€‚</li>
<li>ä½ å°†è¦éå†attrStringç„¶åé€åˆ—å¸ƒå±€æ–‡æœ¬ç›´åˆ°å½“å‰æ–‡æœ¬çš„ä½ç½®åˆ°äº†æœ€æœ«å°¾ã€‚</li>
</ol>
<p>æ˜¯æ—¶å€™å¼€å§‹éå†attrStringäº†ã€‚æŠŠä¸‹åˆ—ä»£ç åŠ è¿› <figure class="highlight plain"><figcaption><span>textPos < attrString.length &#123; ``` é‡Œé¢ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">//1</div><div class="line">if columnIndex.truncatingRemainder(dividingBy: settings.columnsPerPage) == 0 &#123;</div><div class="line">  columnIndex = 0</div><div class="line">  pageView = UIView(frame: settings.pageRect.offsetBy(dx: pageIndex * bounds.width, dy: 0))</div><div class="line">  addSubview(pageView)</div><div class="line">  //2</div><div class="line">  pageIndex += 1</div><div class="line">&#125;   </div><div class="line">//3</div><div class="line">let columnXOrigin = pageView.frame.size.width / settings.columnsPerPage</div><div class="line">let columnOffset = columnIndex * columnXOrigin</div><div class="line">let columnFrame = settings.columnRect.offsetBy(dx: columnOffset, dy: 0)</div></pre></td></tr></table></figure></p>
<ol>
<li>å¦‚æœç”¨æ¯é¡µåˆ—æ•°åˆ’åˆ†çš„åˆ—ç´¢å¼•ç­‰äº0ï¼Œä¹Ÿå°±èƒ½è¯´æ˜è¿™æ˜¯æ‰€åœ¨é¡µçš„ç¬¬ä¸€åˆ—ï¼Œé‚£ä¹ˆå°±åˆ›å»ºæ–°é¡µè§†å›¾æŒæœ‰è¿™äº›åˆ—ã€‚ä¸ºäº†è®¾ç½®è¿™äº›åˆ—çš„frameï¼Œéœ€è¦è·å–ç®—å¥½çº¦æŸçš„setting. pageRectæŒ‰ç…§å½“å‰é¡µé¢ç´¢å¼•ä¹˜ä»¥å±å¹•å®½åº¦æ¥å¯¹å…¶åŸç‚¹è®¡ç®—åç§»é‡ã€‚è¿™æ ·æ‰èƒ½åœ¨ç¿»é¡µæ»šåŠ¨è§†å›¾å†…éƒ¨ä¿è¯æ‚å¿—æ¯ä¸€é¡µéƒ½åœ¨å‰ä¸€é¡µçš„å³è¾¹ã€‚</li>
<li>è‡ªå¢pageIndexã€‚</li>
<li>é€šè¿‡settings.columnsPerPageå°†pageViewçš„å®½åº¦é™¤ä»¥ç¬¬ä¸€åˆ—çš„xåŸç‚¹ï¼Œå°†è¯¥åˆ—ä¹˜ä»¥åˆ—ç´¢å¼•ä»¥è·å¾—åˆ—åç§»é‡ï¼›ç„¶åé€šè¿‡é‡‡ç”¨æ ‡å‡†columnRectå¹¶é€šè¿‡columnOffsetå°†å…¶xåŸç‚¹åç§»æ¥åˆ›å»ºå½“å‰åˆ—çš„frameã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥æŠŠä¸‹åˆ—ä»£ç åŠ åˆ°columnFrameåˆå§‹åŒ–æ–¹æ³•çš„ä¸‹é¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//1   </div><div class="line">let path = CGMutablePath()</div><div class="line">path.addRect(CGRect(origin: .zero, size: columnFrame.size))</div><div class="line">let ctframe = CTFramesetterCreateFrame(framesetter, CFRangeMake(textPos, 0), path, nil)</div><div class="line">//2</div><div class="line">let column = CTColumnView(frame: columnFrame, ctframe: ctframe)</div><div class="line">pageView.addSubview(column)</div><div class="line">//3</div><div class="line">let frameRange = CTFrameGetVisibleStringRange(ctframe)</div><div class="line">textPos += frameRange.length</div><div class="line">//4</div><div class="line">columnIndex += 1</div></pre></td></tr></table></figure></p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªCGMutablePathå¤§å°çš„åˆ—ï¼Œç„¶åä»textPoså¼€å§‹åœ¨åˆé€‚çš„èŒƒå›´å†…æ¸²æŸ“è¶³å¤Ÿå¤šçš„æ–‡æœ¬åˆ°CTFrameä¸­ã€‚</li>
<li>ç”¨CGRectç±»å‹çš„columnFrameå’ŒCTFrameç±»å‹çš„ctframeåˆ›å»ºä¸€ä¸ªCTColumnViewå¹¶å°†è¿™ä¸€åˆ—åŠ åˆ°pageViewä¸Šã€‚</li>
<li>ç”¨CTFrameGetVisibleStringRange(_:)å‡½æ•°è®¡ç®—ç”¨åˆ—é™åˆ¶çš„æ–‡æœ¬çš„èŒƒå›´ï¼Œç„¶åç”¨è¿™ä¸ªè®¡ç®—å‡ºæ¥çš„èŒƒå›´è‡ªå¢textPosçš„å€¼ã€‚</li>
<li>åœ¨éå†åˆ°ä¸‹ä¸€åˆ—ä¹‹å‰å°†columnçš„ç´¢å¼•å€¼åŠ 1ã€‚</li>
</ol>
<p>æœ€ååœ¨éå†å®Œæˆä¹‹åè®¾ç½®å¥½æ»šåŠ¨è§†å›¾çš„sizeï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">contentSize = CGSize(width: CGFloat(pageIndex) * bounds.size.width,</div><div class="line">                     height: bounds.size.height)</div></pre></td></tr></table></figure></p>
<p>é€šè¿‡å°†å†…å®¹å¤§å°è®¾ç½®ä¸ºå±å¹•å®½åº¦ä¹˜ä»¥é¡µæ•°ï¼Œåƒµå°¸å…ˆç”Ÿç°åœ¨å¯ä»¥æ»šåŠ¨æ‚å¿—åˆ°æœ€åäº†ã€‚</p>
<p>æ‰“å¼€ViewController.swiftï¼Œå°†åŸå…ˆçš„ä¸‹åˆ—ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(view as? CTView)?.importAttrString(parser.attrString)</div></pre></td></tr></table></figure></p>
<p>æ›¿æ¢ä¸ºä¸‹åˆ—ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(view as? CTView)?.buildFrames(withAttrString: parser.attrString, andImages: parser.images)</div></pre></td></tr></table></figure></p>
<p>Buildå¹¶åœ¨iPadä¸Šè¿è¡Œåº”ç”¨ã€‚æ£€æŸ¥ä¸€ä¸‹åŒåˆ—å¸ƒå±€ï¼åœ¨é¡µé¢é—´å·¦å³æ‹–åŠ¨è¯•è¯•ã€‚çœ‹èµ·æ¥æ£’æäº†ï¼<br><img src="http://upload-images.jianshu.io/upload_images/698554-b14a1b1e5fe27a9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>ä½ å·²ç»æœ‰äº†æŒ‰åˆ—æ’åˆ—ä¸”æ ¼å¼åŒ–å¥½çš„æ–‡æœ¬äº†ï¼Œä½†æ˜¯ä½ è¿˜å¿˜äº†å›¾ç‰‡å‘¢ã€‚ç”¨Core Textç»˜åˆ¶å›¾ç‰‡å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼ŒCore Textæ¯•ç«Ÿæ˜¯ä¸€ä¸ªæ–‡æœ¬å¤„ç†æ¡†æ¶ï¼Œä½†æ˜¯å‘¢åœ¨ä½ åˆšåˆšåˆ›å»ºçš„æ ‡è®°è§£æå™¨çš„å¸®åŠ©ä¹‹ä¸‹ï¼Œæ·»åŠ å›¾ç‰‡ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ã€‚</p>
<h3 id="ç”¨Core-Textç»˜åˆ¶å›¾ç‰‡"><a href="#ç”¨Core-Textç»˜åˆ¶å›¾ç‰‡" class="headerlink" title="ç”¨Core Textç»˜åˆ¶å›¾ç‰‡"></a>ç”¨Core Textç»˜åˆ¶å›¾ç‰‡</h3><p>è™½ç„¶Core Textä¸èƒ½ç›´æ¥ç»˜åˆ¶å›¾ç‰‡ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªå¸ƒå±€å¼•æ“ï¼Œå®ƒå¯ä»¥ä¸ºå›¾ç‰‡ç•™å¼€ç©ºé—´ã€‚é€šè¿‡è®¾ç½®ä¸ºCTRunçš„delegateï¼Œä½ å¯ä»¥ç¡®å®šCTRunçš„ascentç©ºé—´ã€decentç©ºé—´å’Œå®½åº¦ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-2f22c94e5dde428a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“Core Texté‡åˆ°ä¸€ä¸ªè®¾ç½®äº†CTRunDelegateçš„CTRunï¼Œå®ƒå°±ä¼šè¯¢é—®delegateï¼šâ€œæˆ‘éœ€è¦ç•™å¤šå°‘ç©ºé—´ç»™è¿™å—çš„æ•°æ®â€ã€‚é€šè¿‡åœ¨CTRunDelegateä¸­è®¾ç½®è¿™äº›å±æ€§ï¼Œæ‚¨å¯ä»¥åœ¨æ–‡æœ¬ä¸­ç»™å›¾ç‰‡ç•™å¼€ç©ºä½ã€‚</p>
<p>é¦–å…ˆè®©(è§£æå™¨)æ”¯æŒâ€imgâ€æ ‡ç­¾ã€‚æ‰“å¼€MarkupParser.swiftç„¶åæ‰¾åˆ°â€} //end of font parsingâ€è¯­å¥ã€‚å¹¶å°†ä¸‹é¢ä»£ç åŠ åˆ°åé¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//1</div><div class="line">else if tag.hasPrefix(&quot;img&quot;) &#123; </div><div class="line">      </div><div class="line">  var filename:String = &quot;&quot;</div><div class="line">  let imageRegex = try NSRegularExpression(pattern: &quot;(?&lt;=src=\&quot;)[^\&quot;]+&quot;,</div><div class="line">                                           options: NSRegularExpression.Options(rawValue: 0))</div><div class="line">  imageRegex.enumerateMatches(in: tag, </div><div class="line">    options: NSRegularExpression.MatchingOptions(rawValue: 0), </div><div class="line">    range: NSMakeRange(0, tag.characters.count)) &#123; (match, _, _) in</div><div class="line"></div><div class="line">    if let match = match,</div><div class="line">      let range = tag.range(from: match.range) &#123;</div><div class="line">        filename = tag.substring(with: range)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  //2</div><div class="line">  let settings = CTSettings()</div><div class="line">  var width: CGFloat = settings.columnRect.width</div><div class="line">  var height: CGFloat = 0</div><div class="line"></div><div class="line">  if let image = UIImage(named: filename) &#123;</div><div class="line">    height = width * (image.size.height / image.size.width)</div><div class="line">    // 3</div><div class="line">    if height &gt; settings.columnRect.height - font.lineHeight &#123;</div><div class="line">      height = settings.columnRect.height - font.lineHeight</div><div class="line">      width = height * (image.size.width / image.size.height)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>å¦‚æœtagæ˜¯ä»¥â€imgâ€å¼€å¤´çš„è¯å°±ç”¨æ­£åˆ™å»æŸ¥æ‰¾å›¾ç‰‡çš„â€srcâ€å€¼ï¼Œæ¯”å¦‚å›¾ç‰‡çš„filenameã€‚</li>
<li>è®¾ç½®å›¾ç‰‡å®½åº¦ä¸ºåˆ—çš„å®½åº¦åŒæ—¶åœ¨ä¿è¯å›¾ç‰‡å®½é«˜æ¯”çš„æƒ…å†µä¸‹è®¾ç½®å›¾ç‰‡é«˜åº¦ã€‚</li>
<li>å¦‚æœå›¾ç‰‡çš„é«˜åº¦é«˜è¿‡äº†åˆ—çš„é«˜åº¦å°±å°†åˆ—çš„é«˜åº¦è®¾ç½®ä¸ºå›¾ç‰‡é«˜åº¦å¹¶å‡å°‘å›¾ç‰‡çš„å®½åº¦ä»¥ç»´æŒå›¾ç‰‡çš„å®½é«˜æ¯”ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œå°†ä¸‹é¢ä»£ç åŠ åˆ°ç´§éš <figure class="highlight plain"><figcaption><span>let image ``` è¯­å¥å—åé¢çš„åœ°æ–¹ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">//1</div><div class="line">images += [[&quot;width&quot;: NSNumber(value: Float(width)),</div><div class="line">            &quot;height&quot;: NSNumber(value: Float(height)),</div><div class="line">            &quot;filename&quot;: filename,</div><div class="line">            &quot;location&quot;: NSNumber(value: attrString.length)]]</div><div class="line">//2</div><div class="line">struct RunStruct &#123;</div><div class="line">  let ascent: CGFloat</div><div class="line">  let descent: CGFloat</div><div class="line">  let width: CGFloat</div><div class="line">&#125;</div><div class="line"></div><div class="line">let extentBuffer = UnsafeMutablePointer&lt;RunStruct&gt;.allocate(capacity: 1)</div><div class="line">extentBuffer.initialize(to: RunStruct(ascent: height, descent: 0, width: width))</div><div class="line">//3</div><div class="line">var callbacks = CTRunDelegateCallbacks(version: kCTRunDelegateVersion1, dealloc: &#123; (pointer) in</div><div class="line">&#125;, getAscent: &#123; (pointer) -&gt; CGFloat in</div><div class="line">  let d = pointer.assumingMemoryBound(to: RunStruct.self)</div><div class="line">  return d.pointee.ascent</div><div class="line">&#125;, getDescent: &#123; (pointer) -&gt; CGFloat in</div><div class="line">  let d = pointer.assumingMemoryBound(to: RunStruct.self)</div><div class="line">  return d.pointee.descent</div><div class="line">&#125;, getWidth: &#123; (pointer) -&gt; CGFloat in</div><div class="line">  let d = pointer.assumingMemoryBound(to: RunStruct.self)</div><div class="line">  return d.pointee.width</div><div class="line">&#125;)</div><div class="line">//4</div><div class="line">let delegate = CTRunDelegateCreate(&amp;callbacks, extentBuffer)</div><div class="line">//5</div><div class="line">let attrDictionaryDelegate = [(kCTRunDelegateAttributeName as NSAttributedStringKey): (delegate as Any)]              </div><div class="line">attrString.append(NSAttributedString(string: &quot; &quot;, attributes: attrDictionaryDelegate))</div></pre></td></tr></table></figure></p>
<ol>
<li>æ·»åŠ åŒ…å«å›¾ç‰‡å°ºå¯¸ã€æ–‡ä»¶åå’Œæ–‡æœ¬ä½ç½®çš„å­—å…¸åˆ°imagesæ•°ç»„ä¸­ã€‚</li>
<li>å®šä¹‰RunStructç»“æ„å›¾å»æŒæœ‰ç”¨æ¥æè¿°ç©ºæ ¼çš„å±æ€§ã€‚ç„¶ååˆå§‹åŒ–ä¸€ä¸ªåŒ…å«RunStructçš„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä½“çš„ascentç­‰äºå›¾ç‰‡çš„é«˜åº¦ï¼Œå®½åº¦ç­‰äºå›¾ç‰‡çš„å®½åº¦ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªCTRunDelegateCallbacksè¿”å›ascentã€decentå’Œå®½åº¦ã€‚</li>
<li>ç”¨CTRunDelegateCreateç”Ÿæˆä¸€ä¸ªç»‘å®šäº†callbackså’Œæ•°æ®çš„å§”æ‰˜å®ä¾‹ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªåŒ…å«å§”æ‰˜å®ä¾‹çš„å±æ€§å­—å…¸ï¼Œç„¶åæ·»åŠ å•ä¸ªç©ºæ ¼åˆ°attrStringæœ«å°¾ï¼Œå±æ€§å­—å…¸å…¶å®å°±æ˜¯ç”¨æ¥æŒæœ‰è¿™äº›å ä½ç©ºæ ¼çš„ä½ç½®å’Œå¤§å°ä¿¡æ¯çš„ã€‚</li>
</ol>
<p>ç°åœ¨MarkupParserå¯ä»¥å¤„ç†â€imgâ€æ ‡ç­¾äº†ï¼Œä½ éœ€è¦è°ƒæ•´CTColumnViewå’ŒCTViewå»æ¸²æŸ“å›¾ç‰‡ã€‚</p>
<p>æ‰“å¼€CTColumnView.swiftã€‚æŠŠä¸‹åˆ—ç”¨æ¥æŒæœ‰åˆ—çš„å›¾ç‰‡å’Œå›¾ç‰‡çš„frameçš„ä»£ç åŠ åˆ° <figure class="highlight plain"><figcaption><span>ctFrame:CTFrame! ```  è¯­å¥åé¢ï¼š</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">```Objective-C</div><div class="line">var images: [(image: UIImage, frame: CGRect)] = []</div></pre></td></tr></table></figure></p>
<p>å†ç„¶åå°±æ˜¯æŠŠä¸‹åˆ—ä»£ç åŠ åˆ°draw(_:)å‡½æ•°çš„åé¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">for imageData in images &#123;</div><div class="line">  if let image = imageData.image.cgImage &#123;</div><div class="line">    let imgBounds = imageData.frame</div><div class="line">    context.draw(image, in: imgBounds)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™æ®µä»£ç ä¸­ä½ éå†äº†æ¯ä¸€å¼ å›¾ç‰‡ç„¶åæŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°ä¸Šä¸‹æ–‡å®ƒæ­£ç¡®çš„frameå†…ã€‚</p>
<p>ç„¶åæ‰“å¼€CTView.swiftå¹¶æ·»åŠ ä¸‹é¢è¿™ä¸ªå±æ€§åˆ°ç±»çš„é¡¶éƒ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// MARK: - Properties</div><div class="line">var imageIndex: Int!</div></pre></td></tr></table></figure></p>
<p>imageIndexä¼šæŒç»­è¿½è¸ªå½“å‰çš„å›¾ç‰‡ç´¢å¼•åœ¨ä½ ç»˜åˆ¶CTColumnViewæ—¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼ŒæŠŠä¸‹é¢ä¸€è¡Œä»£ç æ·»åŠ åˆ°buildFrames(withAttrString:andImages:)å‡½æ•°ä¸Šæ–¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">imageIndex = 0</div></pre></td></tr></table></figure></p>
<p>è¿™æ ‡å¿—ç€imagesæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>ç„¶åæ·»åŠ ä¸‹è¿°attachImagesWithFrame(_:ctframe:margin:columnView)å‡½æ•°åˆ°buildFrames(withAttrString:andImages:)å‡½æ•°åé¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">func attachImagesWithFrame(_ images: [[String: Any]],</div><div class="line">                           ctframe: CTFrame,</div><div class="line">                           margin: CGFloat,</div><div class="line">                           columnView: CTColumnView) &#123;</div><div class="line">  //1</div><div class="line">  let lines = CTFrameGetLines(ctframe) as NSArray</div><div class="line">  //2</div><div class="line">  var origins = [CGPoint](repeating: .zero, count: lines.count)</div><div class="line">  CTFrameGetLineOrigins(ctframe, CFRangeMake(0, 0), &amp;origins)</div><div class="line">  //3</div><div class="line">  var nextImage = images[imageIndex]</div><div class="line">  guard var imgLocation = nextImage[&quot;location&quot;] as? Int else &#123;</div><div class="line">    return</div><div class="line">  &#125;</div><div class="line">  //4</div><div class="line">  for lineIndex in 0..&lt;lines.count &#123;</div><div class="line">    let line = lines[lineIndex] as! CTLine</div><div class="line">    //5</div><div class="line">    if let glyphRuns = CTLineGetGlyphRuns(line) as? [CTRun], </div><div class="line">      let imageFilename = nextImage[&quot;filename&quot;] as? String, </div><div class="line">      let img = UIImage(named: imageFilename)  &#123; </div><div class="line">        for run in glyphRuns &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>è·å–ä¸€ä¸ªctframeçš„CTLineå¯¹è±¡çš„æ•°ç»„ã€‚</li>
<li>ç”¨CTFrameGetOriginså»å¤åˆ¶ctframeçš„è¡Œåˆå§‹ç‚¹åæ ‡åˆ°originsæ•°ç»„ä¸­ã€‚é€šè¿‡è®¾ç½®é•¿åº¦ä¸º0çš„rangeï¼ŒCTFrameGetOriginså°†çŸ¥é“è¦éå†æ•´ä¸ªCTFrameã€‚</li>
<li>è®¾ç½®nextImageä»¥åŒ…å«å½“å‰å›¾åƒçš„å±æ€§æ•°æ®ã€‚å¦‚æœnextImageåŒ…å«å›¾åƒçš„ä½ç½®ï¼Œè¯·å°†å…¶å±•å¼€å¹¶ç»§ç»­ï¼›å¦åˆ™ï¼Œæ—©ç‚¹è¿”å›å‡½æ•°ã€‚</li>
<li>éå†ä¸‹ä¸€è¡Œæ–‡æœ¬ã€‚</li>
<li>å¦‚æœè¿™ä¸€è¡Œçš„å­—å½¢ã€æ–‡ä»¶åå’Œå›¾ç‰‡æ–‡ä»¶åéƒ½å­˜åœ¨çš„è¯ï¼Œåˆ™éå†è¿™ä¸€è¡Œçš„å­—å½¢ã€‚</li>
</ol>
<p>ç„¶åå‘¢ï¼Œæ·»åŠ ä¸‹åˆ—ä»£ç åˆ°å­—å½¢çš„for-loopè¯­å¥å—ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// 1</div><div class="line">let runRange = CTRunGetStringRange(run)    </div><div class="line">if runRange.location &gt; imgLocation || runRange.location + runRange.length &lt;= imgLocation &#123;</div><div class="line">  continue</div><div class="line">&#125;</div><div class="line">//2</div><div class="line">var imgBounds: CGRect = .zero</div><div class="line">var ascent: CGFloat = 0       </div><div class="line">imgBounds.size.width = CGFloat(CTRunGetTypographicBounds(run, CFRangeMake(0, 0), &amp;ascent, nil, nil))</div><div class="line">imgBounds.size.height = ascent</div><div class="line">//3</div><div class="line">let xOffset = CTLineGetOffsetForStringIndex(line, CTRunGetStringRange(run).location, nil)</div><div class="line">imgBounds.origin.x = origins[lineIndex].x + xOffset </div><div class="line">imgBounds.origin.y = origins[lineIndex].y</div><div class="line">//4</div><div class="line">columnView.images += [(image: img, frame: imgBounds)]</div><div class="line">//5</div><div class="line">imageIndex! += 1</div><div class="line">if imageIndex &lt; images.count &#123;</div><div class="line">  nextImage = images[imageIndex]</div><div class="line">  imgLocation = (nextImage[&quot;location&quot;] as AnyObject).intValue</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>å¦‚æœå½“å‰å­—å½¢çš„èŒƒå›´ä¸åŒ…å«ä¸‹ä¸€ä¸ªå›¾åƒï¼Œåˆ™è·³è¿‡å¾ªç¯çš„å…¶ä½™éƒ¨åˆ†ã€‚å¦åˆ™ï¼Œåœ¨æ­¤æ¸²æŸ“å›¾åƒã€‚</li>
<li>ä½¿ç”¨CTRunGetTypographicBoundsè®¡ç®—å›¾åƒå®½åº¦ï¼Œå¹¶å°†é«˜åº¦è®¾ç½®ä¸ºascentã€‚</li>
<li>ç”¨CTLineGetOffsetForStringIndexè·å–çº¿çš„xåç§»ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°imgBoundsçš„èµ·ç‚¹åæ ‡ã€‚</li>
<li>å°†å›¾åƒåŠå…¶frameæ·»åŠ åˆ°å½“å‰çš„CTColumnViewã€‚</li>
<li>å¢åŠ å›¾åƒç´¢å¼•ã€‚å¦‚æœimages[imageIndex]æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œåˆ™æ›´æ–°nextImageå’ŒimgLocationï¼Œä»¥ä¾¿å®ƒä»¬å¼•ç”¨ä¸‹ä¸€ä¸ªå›¾åƒã€‚<br><img src="http://upload-images.jianshu.io/upload_images/698554-b00481e7f05f0bce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
</ol>
<p>å¥½äº†ï¼å¹²å¾—æ¼‚äº®ï¼åŸºæœ¬å®Œæˆï¼Œè¿˜å‰©ä¸‹æœ€åä¸€æ­¥ã€‚</p>
<p>åœ¨buildFrames(withAttrString:andImages:)å†…éƒ¨çš„pageView.addSubview(column)ä¸Šé¢æ·»åŠ ä»¥ä¸‹ä»£ç ç”¨ä»¥é™„åŠ å›¾åƒ(å¦‚æœå›¾åƒå­˜åœ¨çš„è¯)ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if images.count &gt; imageIndex &#123;</div><div class="line">  attachImagesWithFrame(images, ctframe: ctframe, margin: settings.margin, columnView: column)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Buildå¹¶ä¸”è¿è¡Œåˆ°iPhoneå’ŒiPadä¸Šï¼š<br><img src="http://upload-images.jianshu.io/upload_images/698554-9a01dbec1c6ea94d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>æ­å–œä½ ï¼å› ä¸ºæ„Ÿæ¿€ä½ æ‰€åšçš„è¿™äº›è¾›è‹¦çš„å·¥ä½œï¼Œåƒµå°¸å…ˆç”Ÿå†³å®šä¸åƒä½ çš„å¤§è„‘äº†ï¼</p>
<h3 id="ä½•å»ä½•ä»"><a href="#ä½•å»ä½•ä»" class="headerlink" title="ä½•å»ä½•ä»"></a>ä½•å»ä½•ä»</h3><p>åœ¨<a href="https://koenig-media.raywenderlich.com/uploads/2017/06/CoreTextMagazine-2.zip" target="_blank" rel="external">è¿™é‡Œ</a>æŸ¥çœ‹å®Œæ•´çš„é¡¹ç›®ã€‚</p>
<p>æ­£å¦‚ä»‹ç»ä¸­æ‰€è¿°ï¼ŒText Kité€šå¸¸å¯ä»¥æ›¿ä»£Core Textï¼›æ‰€ä»¥å°è¯•ç”¨Text Kitç¼–å†™åŒä¸€ä¸ªæ•™ç¨‹å§ï¼Œæ¯”è¾ƒä¸€ä¸‹ä¸¤è€…æœ‰ä»€ä¹ˆä¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å ‚Core Textè¯¾ç¨‹ä¸ä¼šç™½å­¦ï¼<br>Text Kitæä¾›å…è´¹æ¡¥æ¥(toll free bridging)åˆ°Core Textï¼Œå› æ­¤ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦è½»æ¾åœ°åœ¨æ¡†æ¶ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<p>æœ‰ä»»ä½•é—®é¢˜ï¼Œæ„è§æˆ–å»ºè®®ï¼ŸåŠ å…¥è®ºå›è®¨è®ºå§ï¼</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/25/ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/25/ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­/" itemprop="url">
                  ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-25T19:12:44+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-åˆå‰å›çš„æ—¥å¸¸/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa&åˆå‰å›çš„æ—¥å¸¸</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/25/ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/25/ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/05/25/ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­/" class="leancloud_visitors" data-flag-title="ruanpapaå’Œåˆå‰å›çš„æ—¥å¸¸ä¹‹å…­">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p> <strong>ä»è‹å·å›æ¥ä¹‹åï¼Œè¿æ¥äº†ç¬¬ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ—¥å­ã€‚</strong></p>
<p> <strong>papaçªç„¶è·Ÿæˆ‘è¯´ï¼ï¼ï¼</strong></p>
<p> <strong>â€œæˆ‘æ˜ŸæœŸå…­è¯·ä½ åƒå¤§é¤å•Šï¼ï¼ï¼â€</strong></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5431890-01164f67324236ec.jpg" alt="å®Œå…¨ååº”ä¸è¿‡æ¥çš„åˆå‰å›"></p><p align="center"><font color="9E9E9E"><u>å®Œå…¨ååº”ä¸è¿‡æ¥çš„åˆå‰å›</u></font></p><p></p>
<p><br></p>
<h3 id="å°±æ˜¯ï¼ï¼ï¼5-20ï¼ï¼ï¼"><a href="#å°±æ˜¯ï¼ï¼ï¼5-20ï¼ï¼ï¼" class="headerlink" title="å°±æ˜¯ï¼ï¼ï¼5.20ï¼ï¼ï¼"></a>å°±æ˜¯ï¼ï¼ï¼5.20ï¼ï¼ï¼</h3><p>ç„¶è€Œæˆ‘è¿˜æ˜¯ä¸€è„¸ç³Šæ¶‚ï¼š</p>
<p>ä¸€ç›´éƒ½æ²¡åœ¨æ„è¿‡çš„èŠ‚æ—¥â€¦.çªç„¶å¼€å§‹è¿˜çœŸåƒé‚£ä¹ˆå›äº‹ï¼ä¸»è¦æ˜¯ï¼š</p>
<h4 id="æœ‰ï¼å¾—ï¼åƒï¼"><a href="#æœ‰ï¼å¾—ï¼åƒï¼" class="headerlink" title="æœ‰ï¼å¾—ï¼åƒï¼"></a>æœ‰ï¼å¾—ï¼åƒï¼</h4><p><img src="http://upload-images.jianshu.io/upload_images/5431890-4aa1d67479db5d07.jpg" alt="å˜¿å˜¿å˜¿å˜¿"></p>
 <p align="center"><font color="9E9E9E"><u>å˜¿å˜¿å˜¿å˜¿</u></font></p>

<p><br></p>
<blockquote>
<p>äºæ˜¯çº¢åŒ…é›¨ä¸€ä¸‹ï¼ï¼papaå’Œæˆ‘éƒ½æœ‰å¾—åƒäº†ï¼ï¼ï¼</p>
<p><strong>ä½†æ˜¯</strong> ï¼ï¼</p>
<p>papaç«Ÿç„¶å’Œèˆèˆè¿‡äºŒäººä¸–ç•Œå»äº†ï¼åˆé¥­è¿˜æ˜¯èˆèˆè¯·ä»–åƒçš„ï¼ï¼ï¼ï¼ï¼</p>
<p>å—¯ï¼æˆ‘çš„papaå¯èƒ½ä¸€ç›´æ˜¯ä¸ª ğŸ¤</p>
<p>sadï¼<em>(â”ã€ŒÎµ:)</em></p>
</blockquote>
<h3 id="æ‚²ä¼¤çš„æˆ‘è„‘æ´ä¸€å¼€ï¼Œå†³å®šå®æ–½ç§€æ©çˆ±è®¡åˆ’"><a href="#æ‚²ä¼¤çš„æˆ‘è„‘æ´ä¸€å¼€ï¼Œå†³å®šå®æ–½ç§€æ©çˆ±è®¡åˆ’" class="headerlink" title="æ‚²ä¼¤çš„æˆ‘è„‘æ´ä¸€å¼€ï¼Œå†³å®šå®æ–½ç§€æ©çˆ±è®¡åˆ’"></a>æ‚²ä¼¤çš„æˆ‘è„‘æ´ä¸€å¼€ï¼Œå†³å®šå®æ–½ç§€æ©çˆ±è®¡åˆ’</h3><ul>
<li>å¼‚åœ°æ‹ä¸€å®šè¦ç§€ä¸€ç§€çš„ï¼ï¼ˆå¯æƒœpapaä¸çˆ±ç§€ï¼‰</li>
<li>äºæ˜¯â€¦â€¦.</li>
<li>åƒçš„ä¸œè¥¿ç»è¿‡æˆ‘çš„æ‰‹éƒ½å˜æˆè¿™æ ·äº†ï¼ï¼ï¼</li>
</ul>
<p>â€‹</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5431890-408407567043ba5b.jpg" alt="å¾å·çš„è™¾+å¹¿å·çš„éº»è¾£é¦™é”…"></p><p align="center"><font color="9E9E9E"><u>å¾å·çš„è™¾+å¹¿å·çš„éº»è¾£é¦™é”…</u></font></p><p></p>
<p><br></p>
<p><img src="http://upload-images.jianshu.io/upload_images/5431890-8aee97c7c90ead14.jpg" alt="é…¸å¥¶é…ª+å¥¶èŒ¶"></p><p align="center"><font color="9E9E9E"><u>é…¸å¥¶é…ª+å¥¶èŒ¶</u></font></p><p></p>
<p><br><br> <img src="http://upload-images.jianshu.io/upload_images/5431890-f7569fcfbe04f772.jpg" alt="ç»¿å¥å¥¶ä¸š+èœœé›ªå†°åŸ"></p><p align="center"><font color="9E9E9E"><u>ç»¿å¥å¥¶ä¸š+èœœé›ªå†°åŸ</u></font></p><p></p>
<p><br></p>
<blockquote>
<p>papaå‘€ï¼ï¼è¶…çº§è°¢è°¢ä½ å™¢ï¼ï¼ä½ è¦ä¸€ç›´è¿™æ ·ï¼ï¼ï¼</p>
<h3 id="ä¸è·Ÿæˆ‘ä¸€èµ·åƒè‡³å°‘ä¹Ÿè¦è®©æˆ‘åƒï¼ï¼ï¼"><a href="#ä¸è·Ÿæˆ‘ä¸€èµ·åƒè‡³å°‘ä¹Ÿè¦è®©æˆ‘åƒï¼ï¼ï¼" class="headerlink" title="ä¸è·Ÿæˆ‘ä¸€èµ·åƒè‡³å°‘ä¹Ÿè¦è®©æˆ‘åƒï¼ï¼ï¼"></a>ä¸è·Ÿæˆ‘ä¸€èµ·åƒè‡³å°‘ä¹Ÿè¦è®©æˆ‘åƒï¼ï¼ï¼</h3><h2 id="åƒï¼ï¼"><a href="#åƒï¼ï¼" class="headerlink" title="åƒï¼ï¼"></a>åƒï¼ï¼</h2><h1 id="åƒï¼"><a href="#åƒï¼" class="headerlink" title="åƒï¼"></a>åƒï¼</h1></blockquote>
<ul>
<li><p>èº«ä½“å’Œçµé­‚å¿…é¡»æœ‰ä¸€ä¸ªåœ¨è·¯ä¸Šï¼ï¼</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>è¦ä¹ˆæ—…è¡Œï¼è¦ä¹ˆè¾¹æ—…è¡Œè¾¹åƒï¼ï¼</p>
</li>
</ul>
<p><br><br><br></p>
<p align="right">byï¼šåˆå‰å›</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/15/çŸ­æš‚è€Œå¿«ä¹-è‹å·è¡Œ/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ruanpapa & åˆå‰å›">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/15/çŸ­æš‚è€Œå¿«ä¹-è‹å·è¡Œ/" itemprop="url">
                  çŸ­æš‚è€Œå¿«ä¹--è‹å·è¡Œ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-15T09:26:50+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ruanpapa-åˆå‰å›çš„æ—¥å¸¸/" itemprop="url" rel="index">
                    <span itemprop="name">ruanpapa&åˆå‰å›çš„æ—¥å¸¸</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/15/çŸ­æš‚è€Œå¿«ä¹-è‹å·è¡Œ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/15/çŸ­æš‚è€Œå¿«ä¹-è‹å·è¡Œ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/05/15/çŸ­æš‚è€Œå¿«ä¹-è‹å·è¡Œ/" class="leancloud_visitors" data-flag-title="çŸ­æš‚è€Œå¿«ä¹--è‹å·è¡Œ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>å€’è®¡æ—¶45å¤©â€¦..ä¼¼ä¹è¿˜æ˜¯é¥ä¸å¯åŠçš„äº‹æƒ…ï¼Œæ—¥å¸¸æŒ‘é€—æˆ‘çš„åˆå‰å®å®(ã¥ï¿£3ï¿£)ã¥â•­â¤ï½<br>å€’è®¡æ—¶30å¤©â€¦â€¦è¿˜ä¸€ä¸ªæœˆå‘O__O â€œâ€¦è¯¥å†™ä»£ç å†™ä»£ç ï¼Œè¯¥åƒé¥­åƒé¥­<br>å€’è®¡æ—¶14å¤©â€¦â€¦å®Œå…¨æ²¡åŠæ³•å‹æŠ‘è‡ªå·±çš„æ¿€åŠ¨äº†ï¼Œæ¯å¤©å’Œåˆå‰å®å®æ†§æ†¬ç€åˆ°äº†è‹å·è¦ç©ä»€ä¹ˆåƒä»€ä¹ˆï¼Œå„ç§å®å˜±å¯¹æ–¹å¸¦è¿™ä¸ªå¸¦é‚£ä¸ªçš„ï¼Œè¿åˆ°æ—¶å€™ä¸€èµ·çœ‹ã€Šè™«å¸ˆã€‹éƒ½å†³å®šå¥½äº†<br>å€’è®¡æ—¶7å¤©â€¦â€¦åè€Œå†·é™äº†ä¸‹æ¥ï¼Œä¸¤ä¸ªäººéƒ½å°‘äº†æåŠè‹å·æ—…æ¸¸çš„è¯é¢˜ï¼Œçº¦å®šå¥½è¿™æ˜ŸæœŸè¦ä¸€èµ·è®¤çœŸå­¦ä¹ è®¤çœŸå·¥ä½œï¼Œå†…å¿ƒå´ä¸ºå³å°†åˆ°æ¥çš„è§é¢è€Œç¿»è…¾<br>å€’è®¡æ—¶1å¤©â€¦â€¦è¿˜å†™ä¸ªæ¯›çš„ä»£ç å•Šï¼Œä¸€å¤©éƒ½æ²¡å†™å¤Ÿ10è¡Œä»£ç ï¼Œå¯æƒœåˆå‰å®å®æ•´æ•´ä¸€å¤©çš„è¯¾ï¼Œæˆ‘è¿™æ»¡è…”çš„å…´å¥‹æ²¡åœ°æ–¹è¯‰è¯´/(ã„’oã„’)/~~</p>
</blockquote>
<p>ç»ˆäºç†¬åˆ°äº†ä¸‹ç­äº†ï¼ï¼ï¼ä¸‰æ­¥å¹¶ä½œä¸¤æ­¥å†²å›å®¿èˆèƒŒä¸Šæˆ‘çš„å°ä¹¦åŒ…ï¼Œå¥”ç€æœºåœºå°±å»äº†ã€‚ä¸€è·¯ä¸Šï¼Œæ— è§†å› ä¸ºæ”¾å‡å µå¡çš„åœ°é“ç«™ï¼Œæ— è§†é—·çƒ­çš„å¤©æ°”ï¼Œæ— è§†è‡ªå·±çš„ç¬¬ä¸€æ¬¡åé£æœºã€‚è‹å·ï¼Œæˆ‘æ¥å•¦ï¼ï¼ï¼</p>
<p><strong>è¡Œç¨‹ä¸€è§ˆï¼šå¤©æ²³â€“&gt;ç™½äº‘æœºåœºâ€“&gt;ç¡•æ”¾æœºåœºâ€“&gt;æ— é”¡ç«è½¦ç«™â€“&gt;è‹å·ç«è½¦ç«™</strong> </p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-3da74167361aa6cb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¶…çº§æ¬¢è„±"></p>
<p align="center"><font color="9E9E9E"><u>è¶…çº§æ¬¢è„±</u></font></p>

<p><br></p>
<p>æ— é”¡ç«è½¦ç«™å¤–å·¦ç­‰å³ç­‰ï¼Œç»ˆäºç­‰æ¥äº†è½½ç€æˆ‘æœæ€æš®æƒ³çš„åˆå‰å®å®çš„ç«è½¦ã€‚è¸ä¸Šç¬¬4èŠ‚è½¦å¢ä¸€çœ¼å°±çœ‹åˆ°åº§ä½ä¸Šæ¢å¤´æ¢è„‘å¯»æ‰¾ç€æˆ‘çš„å°åˆå‰ï¼Œèµ¶å¿«æˆ´ä¸Šå¸½å­å‹ä½å¤´é™„èº«è·Ÿç€å‰é¢çš„äººèµ°å‘é‚£ä¸ªæœæ€æš®æƒ³äº†å‡ ä¸ªæœˆçš„é‚£ä¸ªå®¶ä¼™ã€‚ä¸€å±è‚¡åä¸‹åˆå‰å®å®æ—è¾¹ï¼Œè¿™å°å‚»ç“œç«Ÿç„¶ç¬¬ä¸€å¥è¯æ˜¯é—®æˆ‘è¦ä¸è¦åƒå¥¹å¸¦çš„æ£ç³•(å–µå–µå–µï¼Ÿï¼Ÿï¼Ÿæ±ªæ±ªæ±ªï¼Ÿï¼Ÿï¼Ÿä½ å°±è¿™å¼€åœºç™½å—ï¼Ÿï¼Ÿï¼Ÿ) è¿™è´§ç«Ÿç„¶æ•¢å¯¹æˆ‘é‚£ä¹ˆå†·æ·¡ï¼Œä¸€æŠŠæ¡ä½å¥¹çš„æ‰‹ï¼Œä¸ç”±åˆ†è¯´ç‰µçš„æ­»æ­»çš„ï¼šè¿™æ‰åƒè¯å˜›ï¼ŒåŠ³èµ„å±±é•¿æ°´è¿œçš„é£å¥”è€Œæ¥ï¼Œå¯ä¸å¾—å¥½å¥½ç‰µç‰µå°æ‰‹å•Šå¼ï¼<br>ä½†æ˜¯ï¼Œè¿˜æ²¡åå‡ åˆ†é’Ÿï¼Œä½ç½®çš„ä¸»äººå°±æ¥äº†ï¼Œåªå¥½èµ·èº«ç«™åœ¨äº†èµ°é“ä¸Šï¼Œå¥¹å‘¢ï¼Œèº«å­ä¸€ä¾§åˆç¡äº†ï¼ï¼ï¼æˆ‘è¿™ä¸ªæš´è„¾æ°”å•Šï¼šä½ å°±è¿™ä¹ˆå†·æ·¡å—ï¼Œçœ‹ä¸åˆ°æˆ‘æœ‰ä½ç½®éƒ½ä¸å›å»åï¼Œç«™åœ¨è¿™å„¿ä¸å°±æ˜¯ä¸ºäº†çœ‹ä½ å—ï¼Ÿä½ è¿˜è¿™ä¹ˆå¿ƒå¤§ï¼Ÿå¾…ä¼šå„¿ä¸‹è½¦ä½ å°±çŸ¥é“é”™äº†ï¼å£äº¨ï¼ï¼ï¼</p>
<p><img src="http://upload-images.jianshu.io/upload_images/698554-857da72b6b770c92.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ°”æ­»æˆ‘å•¦"></p>
<p align="center"><font color="9E9E9E"><u>æ°”æ­»æˆ‘å•¦</u></font></p>

<p><br></p>
<p>28åˆ†é’Ÿçš„ç«è½¦æˆ‘å°±è·Ÿç«™äº†28å°æ—¶ä¸€æ ·ï¼Œæ˜æ˜ä¸¤æ­¥å¤–åç€è‡ªå·±å¿ƒçˆ±çš„å¥³äºº(è™½ç„¶ç¡å¾—ğŸ–ä¸€æ ·)ï¼Œè‡ªå·±å´æ²¡åŠæ³•è§¦ç¢°åˆ°å¥¹ã€‚/(ã„’oã„’)/~æ€»ç®—æ±åˆ°äº†ä¸‹è½¦ï¼Œå‘ç°æˆ‘å‡ºçœè¿ç½‘éƒ½æ²¡å¾—ä¸Šäº†ï¼Œäºæ˜¯æˆ‘å…¨ç¨‹åƒä¸ªè€ƒæ‹‰ä¸€æ ·è´´åœ¨äº†å®å®èº«ä¸Šï¼Œåˆå‰å®å®æ‰¾è‚¯å¾·åŸºå‡†å¤‡å¾…åˆ°å¤©äº®ï¼Œè€Œæˆ‘çš„å…³æ³¨ç‚¹å°±å…¨åœ¨ç‰µç€åˆå‰å®å®çš„æ‰‹ä¸Š~æ‘¸æ‘¸æ‰‹~æ­æ­è‚©è†€~ææè„¸~ç®¡å¥¹å»å“ªå„¿å‘¢ï¼Œçˆ±å»å“ªå»å“ªï¼</p>
<p>æ¸…æ™¨çš„è‹å·çœŸçš„æ˜¯å¾ˆèˆ’é€‚å®œå±…ï¼Œçˆ±äººåœ¨æ—ï¼Œæ¸…é£æ‹‚é¢ï¼Œç»¿æ ‘ç›¸ä¼´ï¼Œå¤©ç©ºè“è“çš„ï¼Œç©ºæ°”å‡‰å‡‰çš„ï¼Œå¥½å¥‡çš„ç›¯ç€è¿™æ±Ÿå—æ¯ä¸€å¤„å»ºç­‘ï¼Œæ¯ä¸€ä¸ªè¿‡å»çš„äººï¼Œé€šå®µæ²¡ç¡çš„å€¦æ„ä¹Ÿä¸€æ‰«è€Œå…‰ï¼Œè´ªå©ªçš„äº«å—è¿™é—²é€‚çš„ä¸€åˆ‡ã€‚æ­¥è¡Œæ¥åˆ°æ—©å·²è®¡åˆ’å¥½çš„å¹³æ±Ÿè·¯ï¼ŒæœçœŸåä¸è™šä¼ ï¼Œä¿©äººéƒ½èµä¸ç»å£ï¼ŒèƒŒé˜´åƒéš”å¼€äº†æ—­æ—¥åˆå‡çš„çƒ­æ°”ï¼Œä¸¤æ—çš„åº—é¢éƒ½æ»¡æ»¡çš„æ±Ÿå—æ°´ä¹¡é£æ ¼ã€‚ä¿©äººåœ¨æ²¿æ²³çš„çŸ³é˜¶ä¸Šä¸Šåäº†å¥½ä¹…å¥½ä¹…ï¼Œå®Œå…¨æ²¡æœ‰ç¬¬ä¸€æ¬¡è§çš„é™Œç”Ÿæ„Ÿï¼ŒèŠèŠå¹³æ±Ÿè·¯ï¼ŒèŠèŠå¾…ä¼šå„¿çš„è¡Œç¨‹ï¼ŒèŠèŠå–èŒ¶ï¼ŒèŠèŠåé£æœºåè½¦çš„äº‹æƒ…ï¼Œä¸€ç‚¹éƒ½ä¸æƒ³èµ°äº†ã€‚æ¥ç€å»äº†é—»åéè¿©çš„æ‹™æ”¿å›­ï¼ŒçœŸçš„æ˜¯äººå±±äººæµ·å•Šï¼Œæ¸¸å®Œä¸€éä¿©äººä¸€è‡´è®¤ä¸ºè¿™é‡Œè¨€è¿‡å…¶å®äº†â€¦..</p>
<p>æ¥åˆ°é…’åº—é¡ºåˆ©åŠäº†å…¥ä½ï¼Œè¿›å…¥æˆ¿é—´çš„æ—¶å€™ç»ˆäºèƒ½æ¾ä¸€å£æ°”äº†ï¼Œé¡¾ä¸ä¸Šæ”¾ä¸‹è¡Œæï¼Œç´§ç´§æŠ±ä½äº†çœ¼å‰è¿™ä¸ªäººï¼Œæƒ…ä¸è‡ªç¦çš„äº²å»å¥¹ã€‚ç®€å•çš„æ´—æ¼±è¿‡åç»ˆäºèƒ½èººä¸‹äº†ï¼Œç¬é—´å€¦æ„è¢­æ¥ï¼ŒæŠ±ç€è½¯è½¯çš„åˆå‰å®å®ç¡äº†è¿‡å»ï¼Œå°±åƒæŠ±ä½äº†å…¨ä¸–ç•Œï¼Œä¿©äººç›¸æ‹¥è€Œçœ ï¼Œç„¶åâ€¦â€¦å°±ç¡æ­»è¿‡å»å•¦:-D</p>
<h3 id="å®‡å®™ç¬¬ä¸€å¯çˆ±çš„åˆå‰å®å®"><a href="#å®‡å®™ç¬¬ä¸€å¯çˆ±çš„åˆå‰å®å®" class="headerlink" title="å®‡å®™ç¬¬ä¸€å¯çˆ±çš„åˆå‰å®å®"></a>å®‡å®™ç¬¬ä¸€å¯çˆ±çš„åˆå‰å®å®</h3><p>é†’æ¥çš„ç¬¬ä¸€çœ¼å°±èƒ½çœ‹åˆ°å¿ƒçˆ±çš„äººï¼Œçœ‹ç€ç†Ÿç¡çš„å¥¹ï¼Œè½»è½»çš„åç€æ°”å‘¼å¸ï¼Œé•¿é•¿çš„çœ¼ç«æ¯›ä¸€åŠ¨ä¸€åŠ¨çš„ï¼Œåƒåªä¹–å·§çš„å°çŒ«å’ªï¼Œæˆ‘æƒ…ä¸è‡ªç¦å¿ƒä¸Šåƒå¼€äº†ä¸€æœµèŠ±ï¼Œè½»è½»çš„äº²äº†å¥¹ç³–æœå‘³çš„å˜´å”‡ä»¿ä½›æ‹¥æœ‰äº†å…¨ä¸–ç•Œï¼Œ å‡‘è¿‡å»æŠ±ä½äº†å¥¹åˆç¡äº†è¿‡å»â€¦â€¦è®¢äº†å–œæ¬¢åƒçš„æµ·é²œå¤–å–ï¼Œæ€»æ˜¯å¿ä¸ä½çœ‹ç€å¥¹åƒä¸œè¥¿ï¼Œå¿ƒéƒ½è¦èŒåŒ–äº†å¥½å—ï¼Ÿæ€ä¹ˆæœ‰è¿™ä¹ˆå¯çˆ±çš„äººï¼ï¼</p>
<h3 id="å¿ƒçµæ‰‹å·§çš„åˆå‰å®å®-æ’å™"><a href="#å¿ƒçµæ‰‹å·§çš„åˆå‰å®å®-æ’å™" class="headerlink" title="å¿ƒçµæ‰‹å·§çš„åˆå‰å®å®(æ’å™)"></a>å¿ƒçµæ‰‹å·§çš„åˆå‰å®å®(æ’å™)</h3><p>å‰ï¼šâ€œpapapapapa~ä½ çœ‹ä½ çœ‹ï¼Œè¿™ä¸ªæ—¥æœ¬çš„ç¾Šæ¯›æ¯¡ç‹—ç³»åˆ—å¥½èŒå•Šå•Šå•Šå•Šå•Šï¼ï¼ï¼ï¼â€<br>paï¼šâ€œä¹°ä¹°ä¹°ï¼å–œæ¬¢å°±ä¹°ï¼ï¼ï¼â€<br>ä¿©äººä¸€é€šæ‰¾ï¼Œå‘ç°æ­£ç‰ˆä¸€ä¸ªç«Ÿç„¶è¦å‡ ç™¾å—é’±ã€‚å›§ï¼Œä¹°ä¸ªé¬¼å•Šä¹°ï¼Œæ ¹æœ¬ä¹°ä¸èµ·å¥½å—ï¼Ÿ(è¯è¯´ä¸å°±ä¸€ä¸ªæ‰‹å·¥ç¾Šæ¯›æ¯¡åˆ¶å“å—ï¼Œå–é‚£ä¹ˆè´µå¹²å˜›å“¦ï¼)<br>å‰ï¼šâ€œå¯æˆ‘çœŸçš„å–œæ¬¢å˜›â€¦â€¦è¯¶ä¸å¦‚æˆ‘è‡ªå·±æ¥åšå§â€ï¼Ÿ<br>paï¼šâ€œå‘ƒâ€¦â€¦ä½ è¡Œå—â€ï¼Ÿ(æ‰‹æ®‹æ˜Ÿäººè¡¨ç¤ºä¸å¯æ€è®®)<br>ç„¶åæˆ‘å°±åä¸½ä¸½çš„å¿˜äº†è¿™ä¸€èŒ¬äº†(ï½€ãƒ»Ï‰ãƒ»Â´)<br>æ²¡æƒ³åˆ°å¥¹ç«Ÿç„¶çœŸçš„ä¹°äº†ææ–™ï¼ŒèŠ±äº†ä¸€ä¸ªä¸‹åˆåŠ æ™šä¸Šç»™æˆ‘æ‰äº†ä¸€ä¸ªç¾Šæ¯›æ¯¡å‡ºæ¥ï¼Œè¿˜å¸¦åˆ°è‹å·æ¥é€ç»™æˆ‘(æ„ŸåŠ¨cry)<br>å®Œå…¨ä¸è¾“ç»™æ­£ç‰ˆçš„å¥½å—ï¼ï¼ï¼çœ‹è¿™èƒ–ä¹ä¹çš„èº«ä½“ï¼Œçœ‹è¿™è ¢èŒçš„è„¸ï¼Œçœ‹è¿™å‚²å¨‡çš„â€¦â€¦å±è‚¡ï¼Œå“ˆå“ˆå“ˆå“ˆå•Šå“ˆå“ˆ<br><img src="http://upload-images.jianshu.io/upload_images/698554-956dd5f4addca414.jpg" alt="ç¾Šæ¯›æ¯¡å°ç‹—ç‹—"></p>
<p align="center"><font color="9E9E9E"><u>ç¾Šæ¯›æ¯¡å°ç‹—ç‹—</u></font></p>

<p><br></p>
<h3 id="å°æ‹–å»¶çš„åˆå‰å®å®"><a href="#å°æ‹–å»¶çš„åˆå‰å®å®" class="headerlink" title="å°æ‹–å»¶çš„åˆå‰å®å®"></a>å°æ‹–å»¶çš„åˆå‰å®å®</h3><p>ä¸‰å‚¬å››è¯·è®©å¥¹å»æ´—æ¾¡éƒ½ä¸å¬è¯ï¼Œæˆ‘èµ°è¿‡å»ä¸€æŠŠç†ŠæŠ±èµ·æ¥ï¼Œæ‰”åˆ°åºŠä¸Šï¼šâ€œç«‹åˆ»é©¬ä¸Šæ‰¾ä½ æ¢æ´—çš„è¡£æœâ€ï¼ç„¶åä¸€æŠŠæŠ±èµ·ä¸¢åˆ°æµ´å®¤ï¼šâ€œä½ ï¼ç«‹åˆ»æ´—æ¾¡ï¼ï¼ åˆ«åºŸè¯ï¼ï¼ï¼â€  å¥¹æ‚»æ‚»åœ°å…³ä¸Šé—¨æ´—æ¾¡ï¼Œä¸€è„¸ä¸ç”˜æ„¿çš„è¡¨æƒ…æˆ‘å°±çŸ¥é“å¥¹è‚¯å®šè¿˜æƒ³å†ç©ä¼šå„¿ã€‚æ²¡é—¨ï¼å°æ ·å„¿ï¼Œè¿˜æ²»ä¸äº†ä½ äº†ï¼(â•¬ï¿£çš¿ï¿£)=</p>
<h3 id="æ¯«ä¸å®¢æ°”çš„åˆå‰å®å®"><a href="#æ¯«ä¸å®¢æ°”çš„åˆå‰å®å®" class="headerlink" title="æ¯«ä¸å®¢æ°”çš„åˆå‰å®å®"></a>æ¯«ä¸å®¢æ°”çš„åˆå‰å®å®</h3><p>å‰ï¼šâ€œpapaï¼Œæˆ‘è¿™è„šå¥½ç—›å™¢(à²¥_à²¥)ä½ å¸®æˆ‘æ‰ä¸€ä¸‹~â€ æˆ‘è¿˜åœ¨æƒ³å¼€å£é—®ä¸ºä»€ä¹ˆè„šç—›å‘¢ã€‚å•ªï¼ä¸€åªå¤§ç™½è…¿å°±æ¶åœ¨äº†æˆ‘è‚šçš®ä¸Šï¼Œè„šè¶¾éƒ½å¿«ç¢°åˆ°æˆ‘å˜´äº†ã€‚å¥½æ°”åˆå¥½ç¬‘Ù©(à¹‘â›á´—â›à¹‘)Û¶ æ‰æ‰æ‰ï¼Œè¿™ä¸‰å¤©å°½ç»™å¥¹æ‰è„šäº†(à¹‘Â¯âˆ€Â¯à¹‘)</p>
<p><br></p>
<p><br></p>
<p>æ¬¢ä¹çš„æ—¶å…‰æ€»æ˜¯ç‰¹åˆ«çŸ­æš‚ï¼Œè½¬çœ¼åˆ°äº†è¯¥åˆ†åˆ«çš„æ—¶å€™(;Â´à¼àº¶Ğ”à¼àº¶`) æµ‘æµ‘å™©å™©çš„å›åˆ°äº†å¹¿å·ï¼Œæ»¡æ»¡çš„ä¸èˆå¾—â€¦â€¦ä¸è¿‡å‘¢ï¼Œä¸‹ä¸€æ¬¡çš„è¡Œç¨‹ä¹Ÿå®‰æ’å¥½äº†ï¼Œæˆ‘åˆå¯ä»¥å¼€å§‹å€’æ•°å•¦~(â‰§â‰¦)/~å•¦å•¦å•¦</p>
<p><br><br><br></p>
<p align="right">byï¼šåˆå‰å›çš„ruanpapa</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="ruanpapa & åˆå‰å›" />
          <p class="site-author-name" itemprop="name">ruanpapa & åˆå‰å›</p>
          <p class="site-description motion-element" itemprop="description">ruanpapaå’Œåˆå‰å›å†™å­—çš„åœ°æ–¹</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/VernonVan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruanpapa & åˆå‰å›</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"vernonvan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("fRSRDUvIyCVcsgLOHArGl58q-gzGzoHsz", "0mGpmjuTsGuu9JEKGaU6YX9j");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
